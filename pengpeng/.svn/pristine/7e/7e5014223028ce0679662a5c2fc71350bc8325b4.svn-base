STK.register("kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b){var c=[].splice.call(arguments,1,arguments.length),d=[b,$LANG].concat(c),e=a.core.util.language.apply(this,d);return e}});
STK.register("kit.extra.reuse",function(a){return function(b,c){var d,e,f;d=a.parseParam({},c);f=[];var g=function(){var a=b();f.push({store:a,used:!0});return a},h=function(b){a.foreach(f,function(a,c){if(b===a.store){a.used=!0;return!1}})},i=function(b){a.foreach(f,function(a,c){if(b===a.store){a.used=!1;return!1}})},j=function(){for(var a=0,b=f.length;a<b;a+=1)if(f[a].used===!1){f[a].used=!0;return f[a].store}return g()};e={};e.setUsed=h;e.setUnused=i;e.getOne=j;e.getLength=function(){return f.length};return e}});
STK.register("ui.mod.layer",function(a){var b=function(a){var b={};if(a.style.display=="none"){a.style.visibility="hidden";a.style.display="";b.w=a.offsetWidth;b.h=a.offsetHeight;a.style.display="none";a.style.visibility="visible"}else{b.w=a.offsetWidth;b.h=a.offsetHeight}return b},c=function(c,d){d=d||"topleft";var e=null;if(c.style.display=="none"){c.style.visibility="hidden";c.style.display="";e=a.core.dom.position(c);c.style.display="none";c.style.visibility="visible"}else e=a.core.dom.position(c);if(d!=="topleft"){var f=b(c);if(d==="topright")e.l=e.l+f.w;else if(d==="bottomleft")e.t=e.t+f.h;else if(d==="bottomright"){e.l=e.l+f.w;e.t=e.t+f.h}}return e};return function(d){var e=a.core.dom.builder(d),f=e.list.outer[0],g=e.list.inner[0],h=a.core.dom.uniqueID(f),i={},j=a.core.evt.custEvent.define(i,"show");a.core.evt.custEvent.define(j,"hide");var k=null;i.show=function(){f.style.display="";a.core.evt.custEvent.fire(j,"show");return i};i.hide=function(){f.style.display="none";a.custEvent.fire(j,"hide");return i};i.getPosition=function(a){return c(f,a)};i.getSize=function(a){if(a||!k)k=b.apply(i,[f]);return k};i.html=function(a){a!==undefined&&(g.innerHTML=a);return g.innerHTML};i.text=function(b){b!==undefined&&(g.innerHTML=a.core.str.encodeHTML(b));return a.core.str.decodeHTML(g.innerHTML)};i.appendChild=function(a){g.appendChild(a);return i};i.getUniqueID=function(){return h};i.getOuter=function(){return f};i.getInner=function(){return g};i.getParentNode=function(){return f.parentNode};i.getDomList=function(){return e.list};i.getDomListByKey=function(a){return e.list[a]};i.getDom=function(a,b){return e.list[a]?e.list[a][b||0]:!1};i.getCascadeDom=function(b,c){return e.list[b]?a.core.dom.cascadeNode(e.list[b][c||0]):!1};return i}});
STK.register("ui.mod.dialog",function(a){return function(b,c){if(!b)throw"ui.mod.dialog need template as first parameter";var d,e,f,g,h,i,j,k,l,m,n,o;l=!0;var p=function(){l!==!1&&e.hide()},q=function(){d=a.parseParam({t:null,l:null,width:null,height:null},c);e=a.ui.mod.layer(b,d);g=e.getOuter();h=e.getDom("title");k=e.getDom("title_content");i=e.getDom("inner");j=e.getDom("close");a.addEvent(j,"click",function(b){a.preventDefault(b);n();return!1});a.custEvent.add(e,"show",function(){a.hotKey.add(document.documentElement,["esc"],p,{type:"keyup",disableInInput:!0})});a.custEvent.add(e,"hide",function(){a.hotKey.remove(document.documentElement,["esc"],p,{type:"keyup"});l=!0})};q();o=a.objSup(e,["show","hide"]);n=function(b){if(typeof m=="function"&&!b&&m()===!1)return!1;o.hide();a.contains(document.body,e.getOuter())&&document.body.removeChild(e.getOuter());return f};f=e;f.show=function(){a.contains(document.body,e.getOuter())||document.body.appendChild(e.getOuter());o.show();return f};f.hide=n;f.setPosition=function(a){g.style.top=a.t+"px";g.style.left=a.l+"px";return f};f.setMiddle=function(){var b=a.core.util.winSize(),c=e.getSize(!0),d=a.core.util.scrollPos().top+(b.height-c.h)/2;g.style.top=(d>0?d:0)+"px";g.style.left=(b.width-c.w)/2+"px";return f};f.setTitle=function(a){k.innerHTML=a;return f};f.setContent=function(a){typeof a=="string"?i.innerHTML=a:i.appendChild(a);return f};f.clearContent=function(){while(i.children.length)a.removeNode(i.children[0]);return f};f.setAlign=function(){};f.setBeforeHideFn=function(a){m=a};f.clearBeforeHideFn=function(){m=null};f.unsupportEsc=function(){l=!1};f.supportEsc=function(){l=!0};return f}});
STK.register("kit.dom.fix",function(a){function f(c,e,f){if(!!d(c)){var g="fixed",h,i,j,k,l=c.offsetWidth,m=c.offsetHeight,n=a.core.util.winSize(),o=0,p=0,q=a.core.dom.cssText(c.style.cssText);if(!b){g="absolute";var r=a.core.util.scrollPos();o=h=r.top;p=i=r.left;switch(e){case"lt":h+=f[1];i+=f[0];break;case"lb":h+=n.height-m-f[1];i+=f[0];break;case"rt":h+=f[1];i+=n.width-l-f[0];break;case"rb":h+=n.height-m-f[1];i+=n.width-l-f[0];break;case"c":default:h+=(n.height-m)/2+f[1];i+=(n.width-l)/2+f[0]}j=k=""}else{h=k=f[1];i=j=f[0];switch(e){case"lt":k=j="";break;case"lb":h=j="";break;case"rt":i=k="";break;case"rb":h=i="";break;case"c":default:h=(n.height-m)/2+f[1];i=(n.width-l)/2+f[0];k=j=""}}if(e=="c"){h<o&&(h=o);i<p&&(i=p)}q.push("position",g).push("top",h+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");c.style.cssText=q.getCss()}}function e(b){b=a.core.arr.isArray(b)?b:[0,0];for(var c=0;c<2;c++)typeof b[c]!="number"&&(b[c]=0);return b}function d(b){return a.core.dom.getStyle(b,"display")!="none"}var b=!(a.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),c=/^(c)|(lt)|(lb)|(rt)|(rb)$/;return function(d,g,h){var i,j,k=!0,l;if(a.core.dom.isNode(d)&&c.test(g)){var m={getNode:function(){return d},isFixed:function(){return k},setFixed:function(a){(k=!!a)&&f(d,i,j);return this},setAlign:function(a,b){if(c.test(a)){i=a;j=e(b);k&&f(d,i,j)}return this},destroy:function(){b||b&&a.core.evt.removeEvent(window,"scroll",n);a.core.evt.removeEvent(window,"resize",n);a.core.evt.custEvent.undefine(l)}};l=a.core.evt.custEvent.define(m,"beforeFix");m.setAlign(g,h);function n(c){c=c||window.event;a.core.evt.custEvent.fire(l,"beforeFix",c.type);k&&(!b||i=="c")&&f(d,i,j)}b||a.core.evt.addEvent(window,"scroll",n);a.core.evt.addEvent(window,"resize",n);return m}}});
STK.register("ui.mask",function(a){function k(b){var c;(c=b.getAttribute(f))||b.setAttribute(f,c=a.getUniqueKey());return">"+b.tagName.toLowerCase()+"["+f+'="'+c+'"]'}function j(){b=a.C("div");var c='<div node-type="outer">';a.core.util.browser.IE6&&(c+='<div style="position:absolute;width:100%;height:100%;"></div>');c+="</div>";b=a.builder(c).list.outer[0];document.body.appendChild(b);e=!0;d=a.kit.dom.fix(b,"lt");var f=function(){var c=a.core.util.winSize();b.style.cssText=a.core.dom.cssText(b.style.cssText).push("width",c.width+"px").push("height",c.height+"px").getCss()};i.add(d,"beforeFix",f);f()}var b,c=[],d,e=!1,f="STK-Mask-Key",g=a.core.dom.setStyle,h=a.core.dom.getStyle,i=a.core.evt.custEvent,l={getNode:function(){return b},show:function(c,f){if(e){c=a.core.obj.parseParam({opacity:.3,background:"#000000"},c);b.style.background=c.background;g(b,"opacity",c.opacity);b.style.display="";d.setAlign("lt");f&&f()}else{j();l.show(c,f)}return l},hide:function(){b.style.display="none";c=[];return l},showUnderNode:function(d,e){a.isNode(d)&&l.show(e,function(){g(b,"zIndex",h(d,"zIndex"));var e=k(d),f=a.core.arr.indexOf(c,e);f!=-1&&c.splice(f,1);c.push(e);a.core.dom.insertElement(d,b,"beforebegin")});return l},back:function(){if(c.length<1)return l;var d,e;c.pop();if(c.length<1)l.hide();else if((e=c[c.length-1])&&(d=a.sizzle(e,document.body)[0])){g(b,"zIndex",h(d,"zIndex"));a.core.dom.insertElement(d,b,"beforebegin")}else l.back();return l},destroy:function(){i.remove(d);b.style.display="none"}};return l});
STK.register("kit.dom.drag",function(a){return function(b,c){var d,e,f,g,h,i,j,k,l=function(){m();n()},m=function(){d=a.parseParam({moveDom:b,perchStyle:"border:solid #999999 2px;",dragtype:"perch",actObj:{},pagePadding:5},c);f=d.moveDom;e={};g={};h=a.drag(b,{actObj:d.actObj});if(d.dragtype==="perch"){i=a.C("div");j=!1;k=!1;f=i}b.style.cursor="move"},n=function(){a.custEvent.add(d.actObj,"dragStart",o);a.custEvent.add(d.actObj,"dragEnd",p);a.custEvent.add(d.actObj,"draging",q)},o=function(c,e){document.body.style.cursor="move";var f=a.core.util.pageSize().page;g=a.core.dom.position(d.moveDom);g.pageX=e.pageX;g.pageY=e.pageY;g.height=d.moveDom.offsetHeight;g.width=d.moveDom.offsetWidth;g.pageHeight=f.height;g.pageWidth=f.width;if(d.dragtype==="perch"){var h=[];h.push(d.perchStyle);h.push("position:absolute");h.push("z-index:"+(d.moveDom.style.zIndex+10));h.push("width:"+d.moveDom.offsetWidth+"px");h.push("height:"+d.moveDom.offsetHeight+"px");h.push("left:"+g.l+"px");h.push("top:"+g.t+"px");i.style.cssText=h.join(";");k=!0;setTimeout(function(){if(k){document.body.appendChild(i);j=!0}},100)}b.setCapture!==undefined&&b.setCapture()},p=function(a,c){document.body.style.cursor="auto";b.setCapture!==undefined&&b.releaseCapture();if(d.dragtype==="perch"){k=!1;d.moveDom.style.top=i.style.top;d.moveDom.style.left=i.style.left;if(j){document.body.removeChild(i);j=!1}}},q=function(a,b){var c=g.t+(b.pageY-g.pageY),e=g.l+(b.pageX-g.pageX),h=c+g.height,i=e+g.width,j=g.pageHeight-d.pagePadding,k=g.pageWidth-d.pagePadding;if(h<j&&c>0)f.style.top=c+"px";else{var l;h>=j&&(l=j-g.height);if(c<0||l<0)l=0;f.style.top=l+"px"}if(i<k&&e>0)f.style.left=e+"px";else{e<0&&(f.style.left="0px");i>=k&&(f.style.left=k-g.width+"px")}};l();e.destroy=function(){document.body.style.cursor="auto";typeof f.setCapture=="function"&&f.releaseCapture();if(d.dragtype==="perch"){k=!1;if(j){document.body.removeChild(i);j=!1}}a.custEvent.remove(d.actObj,"dragStart",o);a.custEvent.remove(d.actObj,"dragEnd",p);a.custEvent.remove(d.actObj,"draging",q);h.destroy&&h.destroy();d=null;f=null;g=null;h=null;i=null;j=null;k=null};e.getActObj=function(){return d.actObj};return e}});
STK.register("ui.dialog",function(a){var b='<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:10001"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content" node-type="layoutContent"><div class="title" node-type="title"><span node-type="title_content"></span></div><a href="javascript:void(0);" class="W_close" title="#L{关闭}" node-type="close"></a><div node-type="inner"></div></div></td></tr></table></div></div>',c=a.kit.extra.language,d=null,e,f=function(){var b=a.ui.mod.dialog(c(e.template));a.custEvent.add(b,"show",function(){a.ui.mask.showUnderNode(b.getOuter())});a.custEvent.add(b,"hide",function(){a.ui.mask.back();b.setMiddle()});a.kit.dom.drag(b.getDom("title"),{actObj:b,moveDom:b.getOuter()});b.destroy=function(){g(b);try{b.hide(!0)}catch(a){}};return b},g=function(a){a.setTitle("").clearContent();d.setUnused(a)};return function(c){e=a.parseParam({template:b,isHold:!1},c);var h=e.isHold;e=a.core.obj.cut(e,["isHold"]);d||(d=a.kit.extra.reuse(f));var i=d.getOne();h||a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);g(i)});return i}});
STK.register("ui.alert",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl><div class="btn"><a href="javascript:void(0)" class="W_btn_d" node-type="OK"></a></div></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.kit.extra.language,e=null,f=function(a,b){a.getDom("icon").className=b.icon;a.getDom("textLarge").innerHTML=b.textLarge;a.getDom("textSmall").innerHTML=b.textSmall;a.getDom("OK").innerHTML="<span>"+b.OKText+"</span>"};return function(g,h){var i,j,k,l,m;i=a.parseParam({title:d("#L{提示}"),icon:"warn",textLarge:g,textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),timeout:0},h);i.icon=c[i.icon];j={};e||(e=a.kit.extra.reuse(function(){var c=a.ui.mod.layer(d(b));return c}));k=e.getOne();l=a.ui.dialog();l.setContent(k.getOuter());l.setTitle(i.title);f(k,i);var n=function(b){a.preventDefault(b);l.hide()};a.addEvent(k.getDom("OK"),"click",n);a.custEvent.add(l,"hide",function(){a.custEvent.remove(l,"hide",arguments.callee);a.removeEvent(k.getDom("OK"),"click",n);e.setUnused(k);clearTimeout(m);i.OK()});i.timeout&&(m=setTimeout(l.hide,i.timeout));l.show().setMiddle();k.getDom("OK").focus();j.alt=k;j.dia=l;return j}});
STK.register("ui.confirm",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt2" node-type="textComplex"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl><div class="btn"><a href="javascript:void(0)" class="W_btn_d" node-type="OK"></a><a href="javascript:void(0)" class="W_btn_b" node-type="cancel"></a></div></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.kit.extra.language,e=null;return function(f,g){var h,i,j,k,l,m;h=a.parseParam({title:d("#L{提示}"),icon:"question",textLarge:f,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),cancel:a.funcEmpty,cancelText:d("#L{取消}"),hideCallback:a.funcEmpty},g);h.icon=c[h.icon];i={};e||(e=a.kit.extra.reuse(function(){var c=a.ui.mod.layer(b);return c}));j=e.getOne();k=a.ui.dialog();k.setContent(j.getOuter());j.getDom("icon").className=h.icon;j.getDom("textLarge").innerHTML=h.textLarge;j.getDom("textComplex").innerHTML=h.textComplex;j.getDom("textSmall").innerHTML=h.textSmall;j.getDom("OK").innerHTML="<span>"+h.OKText+"</span>";j.getDom("cancel").innerHTML="<span>"+h.cancelText+"</span>";k.setTitle(h.title);var n=function(){l=!0;m=a.htmlToJson(j.getDom("textComplex"));k.hide()};a.addEvent(j.getDom("OK"),"click",n);a.addEvent(j.getDom("cancel"),"click",k.hide);a.custEvent.add(k,"hide",function(){a.custEvent.remove(k,"hide",arguments.callee);a.removeEvent(j.getDom("OK"),"click",n);a.removeEvent(j.getDom("cancel"),"click",k.hide);e.setUnused(j);l?h.OK(m):h.cancel(m);g.hideCallback()});k.show().setMiddle();j.getDom("OK").focus();i.cfm=j;i.dia=k;return i}});
STK.register("ui.timerNotice",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.kit.extra.language,e=[],f=function(){var c=a.ui.mod.layer(d(b));e.push({alt:c,used:!0});return c},g=function(a){for(var b=0,c=e.length;b<c;b+=1)if(a===e[b].dia){e[b].used=!0;return}},h=function(a){for(var b=0,c=e.length;b<c;b+=1)if(a===e[b].dia){e[b].used=!1;return}},i=function(b){var c,d,g,i;d={};for(var j=0,k=e.length;j<k;j+=1)if(!e[j].used){e[j].used=!0;g=e[j].dia;break}g=g||f();i=a.ui.dialog();i.appendChild(g.getOuter());g.getDom("icon").className=b.icon;g.getDom("textLarge").innerHTML=b.textLarge;g.getDom("textSmall").innerHTML=b.textSmall;i.setTitle(b.title);a.custEvent.add(i,"hide",function(){b.OK();a.custEvent.remove(i,"hide",arguments.callee);a.custEvent.remove(i,"show",l);h(g)});var l=function(){setTimeout(i.hide,b.timer)};a.custEvent.add(i,"show",l);d.alt=g;d.dia=i;return d};return function(b,e){e=e||{};var f,g,h;f=a.parseParam({title:d("#L{提示}"),icon:"warn",textLarge:b,textSmall:"",OK:function(){},timer:3e3},e);f.icon=c[f.icon];g=i(f);g.dia.show().setMiddle();return g}});
STK.register("kit.dom.parseDOM",function(a){return function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}});
STK.register("kit.io.ajax",function(a){var b=function(b,c,d){c=c|0||1;d=d||"fail";var e=b.args;e.__rnd&&delete e.__rnd;(new Image).src="http://weibolog.sinaapp.com/?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d};return function(c){var d={},e=[],f=null,g=!1,h=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},c);h.onComplete=function(a){g=!1;c.onComplete(a,h.args);setTimeout(i,0)};h.onFail=function(a){g=!1;if(typeof c.onFail=="function")try{c.onFail(a,h.args)}catch(d){}setTimeout(i,0);try{b(h)}catch(d){}};h.onTimeout=function(a){try{b(h);c.onTimeout(a)}catch(d){}};var i=function(){if(!!e.length){if(g===!0)return;g=!0;h.args=e.shift();if(h.method.toLowerCase()=="post"){var b=a.core.util.URL(h.url);b.setParam("__rnd",+(new Date));h.url=b.toString()}f=a.ajax(h)}},j=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d.request=function(a){a||(a={});c.noQueue&&j();if(!c.uniqueRequest||!f){e.push(a);a._t=0;i()}};d.abort=j;return d}});
STK.register("kit.io.jsonp",function(a){return function(b){var c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b),d=[],e={},f=!1,g=function(){if(!!d.length){if(f===!0)return;f=!0;e.args=d.shift();e.onComplete=function(a){f=!1;c.onComplete(a,e.args);setTimeout(g,0)};e.onFail=function(a){f=!1;c.onFail(a);setTimeout(g,0)};a.jsonp(a.core.json.merge(c,{args:e.args,onComplete:function(a){e.onComplete(a)},onFail:function(a){try{e.onFail(a)}catch(b){}}}))}},h={};h.request=function(a){a||(a={});d.push(a);a._t=1;g()};h.abort=function(a){while(d.length)d.shift();f=!1;e=null};return h}});
STK.register("kit.io.ijax",function(a){return function(b){var c=a.parseParam({url:"",timeout:3e4,isEncode:!0,abaurl:null,responseName:null,varkey:"callback",abakey:"callback"},b),d=[],e=null,f=!1;c.onComplete=function(a,d){f=!1;b.onComplete(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};c.onFail=function(a,d){f=!1;b.onFail(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};var g=function(){var b;if(!!d.length){if(f===!0)return;f=!0;b=d.shift();c.args=b.args;c.form=b.form;e=a.ijax(c)}},h=function(a){while(d.length)d.shift();f=!1;if(e)try{e.abort()}catch(b){}e=null},i={};i.request=function(c,e){if(!a.isNode(c))throw"[kit.io.ijax.request] need a form as first parameter";e||(e={});b.noQueue&&h();d.push({form:c,args:e});g()};i.abort=h;return i}});
STK.register("kit.io.inter",function(a){var b=a.core.json.merge;return function(){var c={},d={},e={},f=function(a,b){return function(c,d){try{b.onComplete(c,d)}catch(f){}try{if(c.code==="100000")b.onSuccess(c,d);else{if(c.code==="100002"){location.href=c.data;return}b.onError(c,d)}}catch(f){}for(var g in e[a])try{e[a][g](c,d)}catch(f){}}};c.register=function(a,b){if(typeof d[a]!="undefined")throw a+" registered";d[a]=b;e[a]={}};c.addHook=function(b,c){var d=a.core.util.getUniqueKey();e[b][d]=c;return d};c.rmHook=function(a,b){e[a]&&e[a][b]&&delete e[a][b]};c.getTrans=function(c,e){var g=b(d[c],e);g.onComplete=f(c,e);var h=d[c].requestMode,i="ajax";if(h==="jsonp"||h==="ijax")i=h;return a.kit.io[i](g)};c.request=function(c,e,g){var h=b(d[c],e);h.onComplete=f(c,e);h=a.core.obj.cut(h,["noqueue"]);h.args=g;var i=d[c].requestMode;return i==="jsonp"?a.jsonp(h):i==="ijax"?a.ijax(h):a.ajax(h)};return c}});
STK.register("common.trans.relation",function(a){var b=a.kit.io.inter(),c=b.register;c("recommendfollow",{url:"/aj/f/recomafterfollow?_wv=5",method:"get"});c("closerecommend",{url:"/aj/f/closerecommend?_wv=5",method:"get"});c("newuserguide",{url:"/aj/user/interest/newuserguide?_wv=5",method:"get"});c("mayinterested",{url:"/aj/user/interest/list?_wv=5",method:"get"});c("uninterested",{url:"/aj/user/interest/uninterested?_wv=5",method:"post"});c("userCard",{url:"/aj/user/cardv5?_wv=5",method:"get"});c("follow",{url:"/aj/f/followed?_wv=5",method:"post"});c("unFollow",{url:"/aj/f/unfollow?_wv=5",method:"post"});c("follow_register",{url:"/nguide/aj/relation/followed?_wv=5",method:"post"});c("unfollow_register",{url:"/nguide/aj/relation/unfollow?_wv=5",method:"post"});c("block",{url:"/aj/f/addblack?_wv=5",method:"post"});c("unBlock",{url:"/aj/f/delblack?_wv=5",method:"post"});c("removeFans",{url:"/aj/f/remove?_wv=5",method:"post"});c("requestFollow",{url:"/ajax/relation/requestfollow?_wv=5",method:"post"});c("questions",{url:"/aj/invite/attlimit?_wv=5",method:"get"});c("answer",{url:"/aj/invite/att?_wv=5",method:"post"});c("setRemark",{url:"/aj/f/remarkname?_wv=5",method:"post"});c("recommendusers",{url:"/aj/f/recommendusers?_wv=5",method:"get"});c("recommendAttUsers",{url:"/aj/f/worthfollowusers?_wv=5",method:"get"});c("recommendPopularUsers",{url:"/aj/user/interest/recommendpopularusers?_wv=5",method:"get"});c("mayinterestedweiqun",{url:"/aj/weiqun/getinterestedlist?_wv=5",method:"get"});c("moreData",{url:"/aj/f/listuserdetail?_wv=5",method:"get"});c("getInvite",{url:"/aj/invite/unread?_wv=5",method:"get"});c("quiet_addUser",{url:"/aj/f/addwhisper?_wv=5",method:"post"});c("quiet_removeUser",{url:"/aj/f/delwhisper?_wv=5",method:"post"});c("quiet_know",{url:"/aj/tipsbar/closetipsbar?_wv=5",method:"post"});c("groupUserList",{url:"/aj/f/group/getgroupmembers?_wv=5",method:"get"});c("smart_sort",{url:"/aj/mblog/mblogcard?_wv=5",method:"post"});c("groupSubmit",{url:"/aj/f/group/list?_wv=5",method:"get"});c("wqList",{url:"/aj/proxy?api=http://recom.i.t.sina.com.cn/1/weiqun/weiqun_may_interest.php",method:"get"});c("uninterestedWq",{url:"/aj/proxy?api=http://recom.i.t.sina.com.cn/1/weiqun/weiqun_uninterest.php",method:"get"});c("inviteNeglect",{url:"/aj/invite/handleinvite?_wv=5",method:"post"});c("checkNeglect",{url:"/aj/invite/shieldedlist?_wv=5",method:"post"});c("inviteLift",{url:"/aj/invite/lift?_wv=5",method:"post"});c("inviteAccept",{url:"/aj/invite/handleinvite?_wv=5",method:"post"});c("searchByTel",{url:"/aj/relation/getuserbymobile?_wv=5",method:"post"});c("inviteCloseTips",{url:"/aj/invite/closetips?_wv=5",method:"post"});c("checkrelation",{url:"/aj/f/checkrelation?_wv=5",method:"post"});c("addCloseFriend",{url:"/aj/f/createclosefriend?_wv=5",method:"post"});c("removeClsFrd",{url:"/aj/f/removeclosefriend?_wv=5",method:"post"});c("cfInviteUnread",{url:"/aj/invite/unread?_wv=5",method:"get"});c("recommendCf",{url:"/aj/user/closefriend/recommend?_wv=5",method:"get"});c("clearInvalidUsers",{url:"/aj/f/clearinvalidfriends?_wv=5",method:"post"});c("unIstCf",{url:"/aj/user/closefriend/deny?_wv=5",method:"post"});c("checkcloserelation",{url:"/aj/f/checkcloserelation?_wv=5",method:"post"});c("closeunfollow",{url:"/aj/profile/closeunfollow?_wv=5",method:"post"});c("fanslikemore",{url:"/aj/relation/fanslikemore?_wv=5",method:"get"});c("getProfileInfo",{url:"/aj/relation/getprofileinfo?_wv=5",method:"get"});c("interestlist",{url:"/aj/user/interest/profileinfo?_wv=5",method:"get"});c("recommendGroupMember",{url:"/aj/user/group/recommend?_wv=5",method:"get"});return b});
STK.register("ui.tipPrototype",function(a){var b=10003;return function(c){var d,e,f,g,h,i='<div node-type="outer" style="position: absolute; clear: both; display:none;overflow:hidden;z-index:10003;" ><div node-type="inner" ></div></div>';d=a.parseParam({direct:"up",showCallback:a.core.func.empty,hideCallback:a.core.func.empty},c);e=a.ui.mod.layer(i,d);f=e.getOuter();g=e.getInner();e.setTipWH=function(){h=this.getSize(!0);this.tipWidth=h.w;this.tipHeight=h.h;return this};e.setTipWH();e.setContent=function(a){typeof a=="string"?g.innerHTML=a:g.appendChild(a);this.setTipWH();return this};e.setLayerXY=function(c){if(!c)throw"ui.tipPrototype need pNode as first parameter to set tip position";var e=STK.core.dom.position(c),g=e.l,h=c.offsetWidth,i=c.offsetHeight,j=Math.min(Math.max(g+(h-this.tipWidth)/2,a.scrollPos().left),a.scrollPos().left+STK.winSize().width-this.tipWidth),k=e.t;d.direct==="down"&&(k+=i);var l=[";"];l.push("z-index:",b++,";");l.push("height:",this.tipHeight,"px;");l.push("top:",k,"px;");l.push("left:",j,"px;");f.style.cssText+=l.join("")};e.aniShow=function(){var b=this.getOuter();b.style.height="0px";b.style.display="";var c=a.core.ani.tween(b,{end:d.showCallback,duration:250,animationType:"easeoutcubic"});if(d.direct==="down")c.play({height:this.tipHeight},{staticStyle:"overflow:hidden;position:absolute;"});else{var e=parseInt(b.style.top,10)-this.tipHeight;c.play({height:this.tipHeight,top:Math.max(e,a.scrollPos().top)},{staticStyle:"overflow:hidden;position:absolute;"})}};e.anihide=function(){var b=this.getOuter(),c=this,e=a.core.ani.tween(b,{end:function(){b.style.display="none";b.style.height=c.tipHeight+"px";d.hideCallback()},duration:300,animationType:"easeoutcubic"});if(d.direct==="down")e.play({height:0},{staticStyle:"overflow:hidden;position:absolute;"});else{var f=parseInt(b.style.top,10)+this.tipHeight;e.play({height:0,top:f},{staticStyle:"overflow:hidden;position:absolute;"})}};document.body.appendChild(f);e.destroy=function(){document.body.removeChild(f);e=null};return e}});
STK.register("ui.tipConfirm",function(a){return function(b){b=b||{};var c=a.kit.extra.language,d=a.ui.tipPrototype(b),e=d.getInner(),f=d.getOuter();f.className="W_layer";e.className="bg";b.info=b.info||c("#L{确认要删除这条微博吗？}");b.icon=b.icon||"icon_ask";var g=b.template||c('<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div class="content layer_mini_info"><p class="clearfix" node-type="info"><span node-type="icon" class="'+b.icon+'"></span>'+b.info+"</p>"+'<p class="btn"><a node-type="ok" class="W_btn_d" href="javascript:void(0)"><span>#L{确定}</span></a><a class="W_btn_b" node-type="cancel" href="javascript:void(0)"><span>#L{取消}</span></a></p>'+"</div>"+"</td></tr></tbody>"+"</table>"),h=a.builder(g);d.setContent(h.box);if(!h.list.ok)return d;var i=h.list.ok[0],j=h.list.cancel[0];d.setIcon=function(a){h.list.info.className=a;d.setTipWH()};d.setInfo=function(a){h.list.info[0].innerHTML='<span node-type="icon" class="'+b.icon+'"></span>'+a;d.setTipWH()};d.cancelCallback=function(){a.getType(b.cancelCallback)=="function"&&b.cancelCallback()};d.okCallback=function(){a.getType(b.okCallback)=="function"&&b.okCallback()};var k=function(){d.anihide();d.cancelCallback()},l=function(){d.anihide();d.okCallback()};a.addEvent(j,"click",k);a.addEvent(i,"click",l);var m=d.destroy;d.destroy=function(){a.removeEvent(j,"click",k);a.removeEvent(i,"click",l);m();d=null};return d}});
STK.register("ui.litePrompt",function(a){var b=a.kit.extra.language,c=a.core.util.easyTemplate;return function(b,d){var e,f,g,h,i,d=a.parseParam({hideCallback:a.core.func.empty,type:"succM",msg:"",timeout:""},d),j=d.template||'<#et temp data><div class="W_layer" node-type="outer"><div class="bg"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info_big" node-type="inner"><p class="clearfix"><span class="icon_${data.type}"></span>${data.msg}&nbsp; &nbsp; &nbsp;</p></div></td></tr></tbody></table></div></div></#et>',k=c(j,{type:d.type,msg:b}).toString();f={};g=a.ui.mod.layer(k);i=g.getOuter();a.custEvent.add(g,"hide",function(){a.ui.mask.back();d.hideCallback&&d.hideCallback();a.custEvent.remove(g,"hide",arguments.callee);clearTimeout(h)});a.custEvent.add(g,"show",function(){document.body.appendChild(i);a.ui.mask.showUnderNode(i);a.ui.mask.getNode().style.zIndex=10002});g.show();d.timeout&&(h=setTimeout(g.hide,d.timeout));var l=a.core.util.winSize(),m=g.getSize(!0);i.style.top=a.core.util.scrollPos().top+(l.height-m.h)/2+"px";i.style.left=(l.width-m.w)/2+"px";i.style.zIndex=10002;f.layer=g;return f}});
STK.register("kit.dom.textSelection",function(a){return function(b,c){var d,e;d={};e=a.parseParam({},c);var f=function(c){return a.core.dom.selectText(b,c)},g=function(){b.__areaQuery=a.jsonToQuery(a.core.dom.textSelectArea(b))},h=function(){b.__areaQuery=!1};a.addEvent(b,"beforedeactivate",g);a.addEvent(b,"active",h);var i=function(){var c=null;try{c=a.core.dom.textSelectArea(b)}catch(d){c=a.queryToJson(b.__areaQuery)}c.start===0&&c.len===0&&b.__areaQuery&&(c=a.queryToJson(b.__areaQuery));c.start=parseInt(c.start,10);c.len=parseInt(c.len,10);return c},j=function(a,c){var d=b.value,e=c.start,f=c.len||0,g=d.slice(0,e),h=d.slice(e+f,d.length);b.value=g+a+h;d=null;g=null;h=null;var e=null,f=null};d.setCursor=function(a){f(a)};d.getCursor=function(){return i()};d.insertCursor=function(a){var b=i();j(a,b);b.len=a.length;f(b)};d.TempletCursor=function(c){var d,e,g;d=i();d.len>0?e=b.value.substr(d.start,d.len):e="";g=a.templet(c,{origin:e});j(g,d);d.start=d.start+c.indexOf("#{origin");d.len=g.length-c.replace(/#\{[origin].+?\}/,"").length;f(d)};d.insertText=j;d.destroy=function(){a.removeEvent(b,"beforedeactivate",g);a.removeEvent(b,"active",h);b=null};return d}});
STK.register("kit.dom.smartInput",function(a){return function(b,c){var d,e,f,g,h,i,j,k,l,m="stop",n,o,p,q,r;d=a.parseParam({notice:"",currentClass:null,noticeClass:null,noticeStyle:null,maxLength:null,needLazyInput:!1,LazyInputDelay:200},c);e=a.cascadeNode(b);h=a.kit.dom.textSelection(b);a.custEvent.define(e,"enter");a.custEvent.define(e,"ctrlEnter");a.custEvent.define(e,"lazyInput");f=function(){d.maxLength&&a.bLength(b.value)>d.maxLength&&(b.value=a.leftB(b.value,d.maxLength))};o=function(){if(b.value===d.notice){b.value="";d.noticeClass!=null&&a.removeClassName(b,d.noticeClass)}d.currentClass!=null&&a.addClassName(b.parentNode,d.currentClass)};p=function(){if(b.value===""){b.value=d.notice;d.noticeClass!=null&&a.addClassName(b,d.noticeClass)}d.currentClass!=null&&a.removeClassName(b.parentNode,d.currentClass)};g=function(){f();return b.value===d.notice?"":b.value};q=function(b){b.keyCode===13&&a.custEvent.fire(e,"enter",g())};r=function(b){(b.keyCode===13||b.keyCode===10)&&b.ctrlKey&&a.custEvent.fire(e,"ctrlEnter",g())};i=function(){if(m==="stop"){l=setInterval(k,d.LazyInputDelay);m="sleep"}};j=function(){clearInterval(l);m="stop"};k=function(){if(n===b.value)if(m==="weakup"){a.custEvent.fire(e,"lazyInput",b.value);m="sleep"}else m==="waiting"&&(m="weakup");else m="waiting";n=b.value};if(d.needLazyInput){a.addEvent(b,"focus",i);a.addEvent(b,"blur",j)}a.addEvent(b,"focus",o);a.addEvent(b,"blur",p);a.addEvent(b,"keyup",f);a.addEvent(b,"keydown",q);a.addEvent(b,"keydown",r);e.getValue=g;e.setValue=function(a){b.value=a;f();return e};e.setNotice=function(a){d.notice=a;return e};e.setNoticeClass=function(a){d.noticeClass=a;return e};e.setNoticeStyle=function(a){d.noticeStyle=a;return e};e.setMaxLength=function(a){d.maxLength=a;return e};e.restart=function(){p()};e.startLazyInput=i;e.stopLazyInput=j;e.setCursor=h.setCursor;e.getCursor=h.getCursor;e.insertCursor=h.insertCursor;e.insertText=h.insertText;e.destroy=function(){if(d.needLazyInput){a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p)}j();a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p);a.removeEvent(b,"keyup",f);a.removeEvent(b,"keydown",q);a.removeEvent(b,"keydown",r);a.custEvent.undefine(e,"enter");a.custEvent.undefine(e,"ctrlEnter");a.custEvent.undefine(e,"lazyInput");h.destroy();e=null};return e}});
STK.register("kit.dom.parentAttr",function(a){return function(a,b,c){var d;if(a&&b){c=c||document.body;while(a&&a!=c&&!(d=a.getAttribute(b)))a=a.parentNode}return d}});
STK.register("kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}});
STK.register("common.getDiss",function(a){return function(){var b={},c=0,d={location:$CONFIG.location};arguments[0]&&!a.core.dom.isNode(arguments[0])&&(b=arguments[c++]);b=a.kit.extra.merge(b,d);if(!arguments[c])return b;b=a.kit.extra.merge(b,a.core.json.queryToJson(a.kit.dom.parentAttr(arguments[c++],"diss-data",arguments[c])||""));return b}});
STK.register("common.dialog.inviteFollow",function(a){var b='<#et begFollow data><div class="layer_invite_question" node-type="begFollowPanel"><input type="hidden" name="fuid" value="${data.uid}"><#if (data.questionList&&data.questionList.length)><div class="inqueBg"><p class="question_title">#L{答对&nbsp;%s &nbsp;的问题，即可发送邀请：}</p><dl class="clearfix"><dt>#L{提问：}</dt><dd><select name="qid" class="htc_select" node-type="questionList"><#list data.questionList as list><option value="${list.question}">${list.question_text}</option></#list></select></dd><dt><span class="S_spetxt">*</span>#L{回答：}</dt><dd class="form_table_single"><input node-type="answer" type="text" value="#L{在这里填写答案}" class="W_input" name="answer"><div class="M_notice_del" node-type="answer_error" style="display:none;"></div></dd></dl></div></#if><dl class="inqueBgNo clearfix"><dt><span class="S_spetxt">*</span>#L{说点什么吧：}</dt><dd class="additional form_table_single"><textarea node-type="content" class="W_input" cols="" rows="" name="content">#L{介绍一下自己吧}</textarea><div class="M_notice_del" style="display:none;" node-type="content_error"></div></dd></dl><div class="btn"><a href="javascript:;" node-type="submit" class="W_btn_a"><span>#L{发送邀请}</span></a><a node-type="cancel" href="javascript:;" class="W_btn_b"><span>#L{取消}</span></a></div></div></#et>',c=a.kit.extra.language,d='<span class="icon_del"></span><span class="txt">{error}</span>';return function(e){e=e||{};var f,g,h=a.parseParam({answer:"#L{在这里填写答案}",content:"#L{介绍一下自己吧}",success:"#L{邀请发送成功！}",ans_error:"#L{请输入答案哦。}",con_error:"#L{请输入你想说的话。}",title:"#L{邀请%s关注我}",defMsg:"",callback:a.core.func.empty,succCallback:a.core.func.empty},e||{}),i=e.trans||"answer",j=e.successCb||function(){a.ui.litePrompt(c(h.success),{type:"succM",timeout:"500"})},k=e.errorCb||function(b,c){b&&b.msg&&a.ui.alert(b.msg)},l=function(b,e,f,h){var i=g[b+"_error"];if(i){i.innerHTML=d.replace(/\{error\}/,e);i.style.display=""}else f&&f==="100060"?e&&a.ui.confirm(e,{icon:"warn",OKText:c("#L{立刻绑定}"),OK:function(){window.location.href="http://account.weibo.com/settings/mobile"}}):typeof h=="function"?h():e&&a.ui.alert(e)},m=function(a){var b=g[a+"_error"];b.style.display="none"},n=a.common.trans.relation.getTrans(i,{onSuccess:function(a,b){f.hide();j(a,b);h.succCallback()},onError:function(a,b){var c=a.data||{},d=c.key;l(d,a.msg,a.code,function(){k(a,b)})}}),o=function(b,d){b=a.trim(b||"");b===c(d)&&(b="");return b},p={submit:function(){var b=a.parseParam({uid:"",name:"",inviteid:""},e||{});e.tarEl&&(b=a.common.getDiss(b,e.tarEl));i=="answer"&&(b.fuid=e.uid);if(g.answer){b.answer=o(g.answer.value,h.answer);if(!b.answer){l("answer",c(h.ans_error));return}}if(g.content){b.content=o(g.content.value,h.content);if(!b.content){l("content",c(h.con_error));return}}g.questionList&&(b.qid=g.questionList.value);n.request(b);a.preventDefault()},cancel:function(a){f.hide()},focus:function(a){return function(){m(a)}}},q=function(){a.core.evt.hotKey.add(g.content,["ctrl+enter","enter"],function(){p.submit()});a.addEvent(g.answer,"focus",p.focus("answer"));a.addEvent(g.content,"focus",p.focus("content"));a.addEvent(g.submit,"click",p.submit);a.addEvent(g.cancel,"click",p.cancel)},r=function(){g.answer&&a.kit.dom.smartInput(g.answer,{notice:c(h.answer),noticeStyle:"color:#E0E0E0",maxLength:20});a.kit.dom.smartInput(g.content,{notice:c(h.content),noticeStyle:"color:#E0E0E0",maxLength:280})},s=function(){var d=a.core.util.easyTemplate(c(b,e.name),e).toString(),i=a.core.dom.builder(d);g=a.kit.dom.parseDOM(i.list);f=a.ui.dialog();f.setTitle(c(h.title,e.titleName||e.name||e.fnick));h.defMsg&&(g.content.value=c(h.defMsg));f.appendChild(g.begFollowPanel);e.callback&&a.custEvent.add(f,"hide",e.callback)},t=function(){s();q();r();f.show().setMiddle()};t()}});
STK.register("common.dialog.userInfoDialog",function(a){return function(b){var c=a.kit.extra.language,d='<div node-type="outer" class="detail"><div node-type="inner"></div><div node-type="btnBox" class="btn"><a node-type="submit" href="javascript:;" class="W_btn_d"><span>#L{确认}</span></a><a node-type="cancel" href="javascript:;" class="W_btn_b"><span>#L{取消}</span></a></div></div>',e={},f=a.ui.dialog({isHold:!0}),g=a.core.dom.builder(c(d)),h=a.kit.dom.parseDOM(g.list),i,j,k,l,m,n;f.appendChild(h.outer);var o={},p={submit:function(a){typeof m=="function"&&m();r()},cancel:function(a){typeof n=="function"&&n();r()}};a.addEvent(h.submit,"click",p.submit);a.addEvent(h.cancel,"click",p.cancel);var q=function(a){a=a||{};m=a.OK;n=a.cancel;h.inner.innerHTML=a.content;f.setTitle(a.title);f.show().setMiddle()},r=function(){f.hide()},s=function(){a.removeEvent(h.submit,"click",p.submit);a.removeEvent(h.cancel,"click",p.cancel)};e.show=q;e.hide=r;e.destroy=s;return e}});
STK.register("common.dialog.cfUserInfo",function(a){return function(b){var c=a.kit.extra.language,d='<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:10001"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content" node-type="layoutContent"><a href="javascript:void(0);" class="W_close" title="#L{关闭}" node-type="close"></a><div class="detail"><div class="confirm_closefriend clearfix"><div class="tit_cf" node-type="title"><span node-type="title_content"></span></div><div  node-type="inner"></div></div></div></div></td></tr></table></div></div>',e='<div node-type="outer"><div class="block_cf" node-type="inner"></div><div node-type="btnBox" class="btn"><a node-type="submit" href="javascript:;" class="W_btn_d"><span>#L{确认}</span></a><a node-type="cancel" href="javascript:;" class="W_btn_b"><span>#L{取消}</span></a></div></div>',f={},g=a.ui.dialog({template:d,isHold:!0}),h=a.core.dom.builder(c(e)),i=a.kit.dom.parseDOM(h.list),j,k,l,m,n,o;g.appendChild(i.outer);var p={},q={submit:function(a){typeof n=="function"&&n();s()},cancel:function(a){typeof o=="function"&&o();s()}};a.addEvent(i.submit,"click",q.submit);a.addEvent(i.cancel,"click",q.cancel);var r=function(a){a=a||{};n=a.OK;o=a.cancel;i.inner.innerHTML=a.content;g.setTitle(a.title);g.show().setMiddle()},s=function(){g.hide()},t=function(){a.removeEvent(i.submit,"click",q.submit);a.removeEvent(i.cancel,"click",q.cancel)};f.show=r;f.hide=s;f.destroy=t;return f}});
STK.register("common.relation.closeFriend",function(a){var b={},c,d,e,f,g,h,i,j,k=a.common.trans.relation,l=a.kit.extra.language,m,n={unfollow:l("#L{加密友之后也会同时关注对方哦}"),cfSuc_1:l("#L{密友邀请已经发送，请等待对方接受}"),cfSuc_2:l("#L{你已经成功添加对方为密友，你们彼此已经是密友啦}"),cfSucTit_1:l("#L{需要对方通过邀请才能加为密友}"),she:l("#L{她}"),he:l("#L{他}")},o=l('<div class="confirm_closefriend clearfix" node-type="userinfo"><div class="head"><a target="_blank" href="/#{domain}"><img title="#{screen_name}" alt="" width="50" height="50" src="#{profile_image_url}"></a></div><div class="info"><p class="mb"><a target="_blank" href="/#{domain}" class="W_f14">#{screen_name}</a> <span class="addr">#{location}</span></p><p class="mb W_textb">#{description}</p><p>#L{关注} <a target="_blank" href="/#{id}/follow">#{friends_count}</a><span class="W_vline">|</span>#L{粉丝} <a target="_blank" href="/#{id}/fans">#{followers_count}</a><span class="W_vline">|</span>#L{微博} <a target="_blank" href="/#{domain}">#{statuses_count}</a></p></div></div>'),p=l('<#et tip data><div class="head"><a target="_blank" href="/${data.domain}"><img title="${data.screen_name}" alt="" width="50" height="50" src="${data.profile_image_url}"></a></div><div class="info"><p class="mb"><a target="_blank" href="/${data.domain}" class="W_f14">${data.screen_name}</a><#if (data.verified && data.verified_type == 0)><a target="_blank" href="http://verified.weibo.com/verify"><i title="${data.verified_reason}" class="W_ico16 approve"></i></a></#if><#if (!data.verified && data.verified_type == 220)><a target="_blank" href="http://club.weibo.com/intro"><i title="微博达人" class="W_ico16 ico_club" node-type="daren"></i></a></#if></p><p class="mb"><i class="W_ico16 male"></i><span class="addr">${data.location}</span></p><p>#L{关注} <a target="_blank" href="/${data.id}/follow">${data.friends_count}</a><span class="W_vline">|</span>#L{粉丝}<a target="_blank" href="/${data.id}/fans">${data.followers_count}</a><span class="W_vline">|</span>#L{微博}<a target="_blank" href="/${data.domain}">${data.statuses_count}</a></p></div><#if (data.description)><p>#L{简介：}${data.description}</p></#if></#et>'),q=l('<label><input type="checkbox" value="1" name="unfollow">#L{同时取消关注}</label>'),r=function(b,c){var d=b.data||{},e=n.cfSuc_2,f;if(d.cftype==2){e=n.cfSuc_1;f=n.cfSucTit_1}a.ui.timerNotice(e,{title:f,icon:"success",timer:2e3})},s=function(b,c){var d=b.data||{};d.overtop==1?a.ui.alert(l("#L{您的密友数量已经达到140上限啦~~}"),{icon:"warn",OKText:l("#L{知道了}")}):b.code=="100091"?window.location.href="http://meyou.weibo.com":b&&b.msg&&a.ui.alert(b.msg)},t=function(){var b;if(i==3){b=a.parseParam({successCb:r,errorCb:s},h||{});var c={uid:h.uid,inviteid:h.inviteid,name:h.name};h.tarEl&&(c=a.common.getDiss(c,h.tarEl));k.request("addCloseFriend",{onSuccess:b.successCb,onError:b.errorCb},c)}else if(i==1)a.ui.alert(l("#L{你们彼此已经是密友啦}"));else{b=a.parseParam({trans:"addCloseFriend",name:"",fnick:"",uid:"",inviteid:"",questionList:j,title:"#L{邀请%s成为密友}",successCb:r,errorCb:s,callback:function(){},tarEl:null},h||{});a.common.dialog.inviteFollow(b)}},u=a.ui.tipConfirm({icon:"icon_warn",info:n.unfollow,okCallback:function(){setTimeout(function(){t()},300)}}),v={followConfirm:function(a){u.setLayerXY(a);u.aniShow()}},w=k.getTrans("checkrelation",{onSuccess:function(b,c){var e=b.data||{},f=e.relation||{};i=f.cftype;j=e.questionList;if(c.type=="input")y(e.userinfo);else{if(f.following==1)return t();d?v.followConfirm(d):a.ui.confirm(n.unfollow,{OK:function(){t()}})}},onError:s}),x=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},y=function(b){var c=b.screen_name;c=a.bLength(c)>18?a.leftB(c,18)+"…":c;b.screen_name=c;b.description=x(b.description);m=m||a.common.dialog.cfUserInfo();b.description&&a.core.str.bLength(b.description)>100&&(b.description=a.core.str.leftB(b.description,100)+"...");m.show({content:a.core.util.easyTemplate(p,b).toString(),title:l("#L{确认%s是你要邀请的密友么？}",'<a target="_blank" href="/'+b.domain+'">@'+b.screen_name+"</a>"),OK:function(){t()}})},z=k.getTrans("removeClsFrd",{onSuccess:function(a,b){typeof h.successCb=="function"&&h.successCb(a,b)},onError:function(b,c){typeof h.errorCb=="function"?h.errorCb(b,c):b&&b.msg&&a.ui.alert(b.msg)}}),A=function(b){h=b||{};c=a.parseParam({name:"",uid:"",type:"",callback:function(){}},b);d=b.node;w.request(c)},B=function(b){h=b||{};h.uid=h.uid.join(",");d=h.node;var c=a.parseParam({trans:"addCloseFriend",titleName:l("#L{他们}"),uid:"",sex:"m",inviteid:"",title:"#L{邀请%s成为密友}",successCb:r,errorCb:s,callback:function(){},tarEl:null},h||{});h.nick&&(c.defMsg="@"+h.nick+(b.sex=="f"?" #L{想成为你的微博密友，快来回应她吧~！}":" #L{想成为你的微博密友，快来回应他吧~！}"));a.common.dialog.inviteFollow(c)},C=function(b){var c=b&&b.uid;if(a.isArray(c))return B(b);A(b)},D=function(b){h=b||{};c=a.parseParam({name:"",uid:""},b);d=b.node;a.ui.confirm(l("#L{确认将%s移出密友？}",b.sex=="f"?n.she:n.he),{textComplex:q,OK:function(a){a.unfollow&&(c.unfollow="1");z.request(c)}})},E=function(){c=null;d=null;callback=null;l.destroy()};b.add=C;b.destroy=E;b.remove=D;return b});
STK.register("common.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"common.listener.define: 频道已被占用";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"common.listener.define: 频道未定义";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: 频道未定义";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("common.channel.closeFriend",function(a){var b=["changeTab"];return a.common.listener.define("common.channel.closeFriend",b)});
STK.register("ui.prompt",function(a){var b='<div class="layer_prompt" node-type="outer"><p class="son_title" node-type="inner"></p><dl class="clearfix"><dt node-type="label"></dt><dd><input type="text" class="W_input W_input_default" value="" node-type="input" /><p class="S_error" node-type="errorBox"><span class="icon_del"></span><span node-type="errorTxt"></span></p></dd></dl><div class="btn"><a class="W_btn_d" href="javascript:void(0);" node-type="OK"></a><a class="W_btn_b" href="javascript:void(0);" node-type="cancel"></a></div></div>',c=a.kit.extra.language,d=null,e=function(a,b){a.getDom("inner").innerHTML=b.info;a.getDom("label").innerHTML=b.label;a.getDom("OK").innerHTML="<span>"+b.OKText+"</span>";a.getDom("cancel").innerHTML="<span>"+b.cancelText+"</span>";a.getDom("errorBox").style.visibility="hidden";a.getDom("errorTxt").innerHTML="";a.input.setValue(b.value);a.input.setNotice(b.notice);a.input.restart()},f=function(f){var g,h,i,j,k,l,m;d||(d=a.kit.extra.reuse(function(){var d=a.ui.mod.layer(c(b));d.input=a.kit.dom.smartInput(d.getDom("input"));return d}));h=d.getOne();i=a.ui.dialog();i.appendChild(h.getOuter());i.setTitle(f.title);e(h,f);j=function(){var a=f.check(h.getDom("input").value);a.status?m():l(a.msg);return a.status};k=function(){j()&&f.OK(h.getDom("input").value)};l=function(a){h.getDom("errorBox").style.visibility="visible";h.getDom("errorTxt").innerHTML=a};m=function(){h.getDom("errorBox").style.visibility="hidden"};a.custEvent.add(h.input,"enter",k);a.addEvent(h.getDom("OK"),"click",k);a.addEvent(h.getDom("cancel"),"click",i.hide);a.addEvent(h.getDom("input"),"blur",j);a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);a.custEvent.remove(h.input,"enter",k);a.removeEvent(h.getDom("OK"),"click",k);a.removeEvent(h.getDom("cancel"),"click",i.hide);a.removeEvent(h.getDom("input"),"blur",j);d.setUnused(h);f.cancel();h=null;i=null});g={};g.pmt=h;g.dia=i;g.hide=i.hide;g.showError=l;g.hideError=m;return g};return function(b){var d,e;d=a.parseParam({title:c("#L{提示}"),notice:"",value:"",info:"",label:"",OK:a.funcEmpty,cancel:a.funcEmpty,check:function(){return{status:!0}},OKText:c("#L{确定}"),cancelText:c("#L{取消}")},b);e=f(d);e.dia.show().setMiddle();return e}});
STK.register("kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)try{return a.selectionStart}catch(b){return 0}var d=c.createRange(),e,f,g=0,h=document.body.createTextRange();try{h.moveToElementText(a)}catch(b){}for(g;h.compareEndPoints("StartToStart",d)<0;g++)h.moveStart("character",1);return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStartIE=e.text.length-d.text.length;a.selectionEndIE=a.selectionStartIE+d.text.length;b=a.selectionStartIE}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("common.dialog.setRemark",function(a){return function(b){b=b||{};var c=b.uid;if(b.uid!=null){var d=a.trim(b.remark||""),e=b.callback,f=a.kit.extra.language,g="",h=a.ui.prompt({title:f("#L{设置备注名}"),notice:f("#L{请输入备注名}"),value:d||"",info:"",label:f("#L{备注名：}"),OK:function(a){if(d!=""&&a==d){e&&e(d);h.hide()}else i.request({touid:c,remark:g})},cancel:a.funcEmpty,check:function(b){var c;if(a.trim(b)==""||b==f("#L{请输入备注名}")){c={status:!0,msg:f("#L{备注名不能为空}")};g=""}else{c={status:!0};g=b}return c},OKText:f("#L{确定}"),cancelText:f("#L{取消}")});h.pmt.input.setMaxLength(30);setTimeout(function(){var b=h.pmt.getDom("input");b.focus();a.kit.extra.textareaUtils.setCursor(b)},0);var i=a.common.trans.relation;i=i.getTrans("setRemark",{onSuccess:function(a,b){e&&e(g);h.hide()}||a.funcEmpty,onError:function(a,b){h.showError(a.msg)},onFail:function(a,b){h.showError(a.msg||f("#L{系统繁忙，请稍后再试}"))}})}}});
STK.register("common.trans.group",function(a){var b=a.kit.io.inter(),c=b.register;c("add",{url:"/aj/f/group/add?_wv=5",method:"post"});c("modify",{url:"/aj/relation/rename?_wv=5",method:"post"});c("del",{url:"/aj/relation/delete?_wv=5",method:"post"});c("info",{url:"/aj/f/group/getgroupinfo?_wv=5",method:"get"});c("set",{url:"/aj3/attention/aj_group_update_v4.php",method:"post"});c("batchSet",{url:"/aj3/attention/aj_group_batchupdate_v4.php",method:"post"});c("list",{url:"/aj/f/group/list?_wv=5",method:"get"});c("order",{url:"/aj/f/group/order?_wv=5",method:"post"});c("listbygroup",{url:"/aj/f/attchoose?_wv=5",method:"post"});c("infolist",{url:"/aj/f/attfilterlist?_wv=5",method:"get"});c("orientGroup",{url:"/aj/f/group/groupmembers?_wv=5",method:"get"});c("recommendfollow",{url:"/aj3/recommend/aj_addrecommend.php",method:"post"});c("groupupdate",{url:"/aj/relation/groupupdate?_wv=5",method:"post"});c("unInterest",{url:"/aj/f/group/notinterest?_wv=5",method:"post"});c("editdesc",{url:"/aj/f/group/editdesc?_wv=5",method:"post"});c("update",{url:"/aj/f/group/update?_wv=5",method:"post"});c("followgroup",{url:"/aj/f/group/followgroup?_wv=5",method:"post"});c("getGroupDesc",{url:"/aj/f/group/getdesc?_wv=5",method:"get"});c("closebubble",{url:"/aj/bubble/closebubble?_wv=5",method:"get"});return b});
STK.register("kit.extra.parseURL",function(a){return function(){return STK.historyM&&STK.historyM.parseURL?STK.historyM.parseURL():a.core.str.parseURL(location.href)}});
STK.register("common.group.groupListPanel",function(a){var b=$CONFIG.miyou=="1";return function(c){var d={},e=a.kit.extra.language,f=a.C("div"),g={},h={},i,j=a.delegatedEvent(f),k=$CONFIG.imgPath+"style/images/common/transparent.gif",l=[{mode:"private",className:"W_ico16 i_conn_private",title:e("#L{仅自己可见}")},{mode:"friend",className:"W_ico16 i_conn_list",title:e("#L{组内成员可见}")},{mode:"public",className:"W_ico16 i_conn_public",title:e("#L{所有人可见}")}],m=function(a,b,c){if(!!a){c&&(c=c.toUpperCase());var d=a[b];while(d){if(d.nodeType==1&&(c?d.nodeName==c:!0))break;d=d[b]}return d}},n=c.multi?'style="display:none;"':'<#if (item.belong==1)><#else>style="display:none;"</#if>',o='<h4 class="lsfl_visibility" style="display:none;"><img class="#{className}" alt="" src="'+k+'">#{title}</h4><div class="lsfl_listsBox"><ul node-type="#{mode}" class="lsfl_listsBox_ul"></ul></div>',p=a.core.util.easyTemplate('<#et listItem gList><#list gList as item><li <#if (item.recom_join)> class="S_bg1"</#if>><label for="${item.gid}"><input action-type="select" id="${item.gid}" type="checkbox"<#if (item.recom_join)> recom_join="1" </#if> <#if (item.belong==1)>checked="checked"</#if> class="W_checkbox" value="${item.gid}"><span >${item.gname}</span></label><#if (item.recom_join)><span class="S_bg1 S_txt2">('+e("#L{建议加为这个分组}")+")</span>"+"</#if>"+"</li>"+"</#list>"+"</#et>"),q="",r=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},s=function(){var b="";for(var d=0;d<l.length;d++)b+=a.templet(o,l[d]);f.innerHTML=b;i=a.kit.dom.parseDOM(a.core.dom.builder(f).list);c.data&&C(c.data)},t=function(){for(var d=0;d<l.length;d++){var e=l[d].mode;!c.multi&&e==="private"&&(i[e].innerHTML=q);if(g[e]){for(var h=g[e].length;h--;)g[e][h].desc&&(g[e][h].desc=g[e][h].desc);var j=p(g[e]).toString();i[e].innerHTML+=j}else(!b||e!=="private")&&z(i[e],!0)}var k=a.sizzle('input[node-type="cfSelect"]',f)[0]||{},m=(c.cftype||0)>0;setTimeout(function(){k.checked=m},0)};lengthLimit=function(b){var c=a.fixEvent(b).target;a.bLength(c.value)>16&&(c.value=a.leftB(c.value,16))},onEnter=function(b){if(b.keyCode===13){var c=a.fixEvent(b).target;a.fireEvent(c,"blur")}};var u=function(b){var c=m(b,"parentNode","li");if(!!c){var d=a.sizzle('input[action-type="select"]',c)[0];h[d.id]||(h[d.id]={});return h[d.id]}},v={addCloseFriend:function(a){var b=a.el;!b.checked},miyouHelp:function(b){a.preventDefault();var c=a.kit.extra.parseURL();c="http://"+c.host+"/mymeyou?ismiyou=1";var d=a.C("form");d.setAttribute("action",c);d.setAttribute("method","POST");var e=a.C("input");e.setAttribute("name","step");e.setAttribute("value","1");var f=a.C("input");f.setAttribute("name","ismiyou");f.setAttribute("value","1");var g=a.C("input");g.setAttribute("name","type");g.setAttribute("value","1");var h=a.C("input");h.setAttribute("name","guidetype");h.setAttribute("value","miyou");var i=a.C("input");i.setAttribute("name","method");i.setAttribute("value","POST");d.appendChild(e);d.appendChild(f);d.appendChild(g);d.appendChild(h);d.appendChild(i);document.body.appendChild(d);d.submit()}},w=function(){j.add("select","click",v.select);j.add("miyouHelp","click",v.miyouHelp)},x=function(){},y=function(){s();w();x()},z=function(b,c){var d=a.domPrev(b.parentNode);if(d.style.display===(c?"":"none")){d.style.display=c?"none":"";b.parentNode.style.display=c?"none":""}},A=function(){return f},B=function(b){var c=b.mode||"private";g[c]=g[c]||[];g[c].push(b);var d=p([b]).toString();a.insertHTML(i[c],d,"beforeend");z(i[c],!0)},C=function(b){g={};if(a.isArray(b))for(var c=0,d=b.length;c<d;c++){var e=b[c].mode||"private";g[e]=g[e]||[];g[e].push(b[c])}t()},D=function(){var b=[],d={suda:[],diss:{allGroup:0,autoSelect:0,gid:[],uid:$CONFIG.uid}},e=a.sizzle('input[action-type="select"]',f),g=a.sizzle('input[node-type="cfSelect"]',f)[0]||{},h,i;d.diss.allGroup=e.length;for(var j=e.length;j--;){var k={};h=i=!1;if(e[j].checked){h=!0;var l=u(e[j]);if(l){k.gid=e[j].value;b.push(k)}}if(e[j].getAttribute("recom_join")){i=!0;d.diss.autoSelect++;d.diss.gid.push(e[j].value)}(i||h)&&d.suda.push(e[j].value+(i?"_a":"_b")+(h?"_1":"_0"))}var m=(c.cftype||0)>0;g.checked!==m&&(b.isCfInvite=g.checked?"add":"delete");b.suda_diss=d;return b},E=function(){t()},F=function(){g={};t()},G=function(){j.destroy();h=null;g=null;i=null;f=null},H=function(){var b=a.sizzle('input[action-type="select"]',f);return b.length};y();d.getOuter=A;d.length=H;d.add=B;d.setData=C;d.getData=D;d.reset=E;d.clear=F;d.destroy=G;return d}});
STK.register("ui.vipConfirm",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt2" node-type="textComplex"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl><div class="btn"><a href="javascript:void(0)" class="W_btn_a" node-type="toBeVip"></a><a href="javascript:void(0)" class="W_btn_b" node-type="OK"></a></div></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.kit.extra.language,e=null;return function(f,g){var h,i,j,k,l,m,n;h=a.parseParam({title:d("#L{提示}"),icon:"question",textLarge:f,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),cancel:a.funcEmpty,cancelText:d("#L{取消}"),toBeVip:a.funcEmpty,toBeVipText:""},g);h.icon=c[h.icon];i={};e||(e=a.kit.extra.reuse(function(){var c=a.ui.mod.layer(b);return c}));j=e.getOne();k=a.ui.dialog();k.setContent(j.getOuter());j.getDom("icon").className=h.icon;j.getDom("textLarge").innerHTML=h.textLarge;j.getDom("textComplex").innerHTML=h.textComplex;j.getDom("textSmall").innerHTML=h.textSmall;j.getDom("OK").innerHTML="<span>"+h.OKText+"</span>";j.getDom("toBeVip").innerHTML='<span><em class="W_ico16 ico_member"></em>'+h.toBeVipText+"</span>";k.setTitle(h.title);var o=function(){l=!0;m=a.htmlToJson(j.getDom("textComplex"));k.hide()},p=function(){n=!0;k.hide()};a.addEvent(j.getDom("OK"),"click",o);a.addEvent(j.getDom("toBeVip"),"click",p);a.custEvent.add(k,"hide",function(){a.custEvent.remove(k,"hide",arguments.callee);a.removeEvent(j.getDom("OK"),"click",o);a.removeEvent(j.getDom("toBeVip"),"click",p);e.setUnused(j);l?h.OK(m):h.cancel(m);n&&h.toBeVip()});k.show().setMiddle();i.cfm=j;i.dia=k;return i}});
STK.register("kit.io.cssLoader",function(a){var b="",c="http://img.t.sinajs.cn/t4/",d="http://timg.sjs.sinajs.cn/t4/";if(typeof $CONFIG!="undefined"){c=$CONFIG.cssPath||c;b=$CONFIG.version||""}var e={};return function(f,g,h,i,j){i=i||b;h=h||function(){};var k=function(a,b){var c=e[a]||(e[a]={loaded:!1,list:[]});if(c.loaded){b(a);return!1}c.list.push(b);return c.list.length>1?!1:!0},l=function(a){var b=e[a].list;for(var c=0;c<b.length;c++)b[c](a);e[a].loaded=!0;delete e[a].list};if(!!k(f,h)){var m;j?m=d+f:m=c+f+"?version="+i;var n=a.C("link");n.setAttribute("rel","Stylesheet");n.setAttribute("type","text/css");n.setAttribute("charset","utf-8");n.setAttribute("href",m);document.getElementsByTagName("head")[0].appendChild(n);var o=a.C("div");o.id=g;a.core.util.hideContainer.appendChild(o);var p=3e3,q=function(){if(parseInt(a.core.dom.getStyle(o,"height"))==42){a.core.util.hideContainer.removeChild(o);l(f)}else if(--p>0)setTimeout(q,10);else{a.log(f+"timeout!");a.core.util.hideContainer.removeChild(o);delete e[f]}};setTimeout(q,50)}}});
STK.register("common.dialog.authentication",function(a){return function(b){var c=a.kit.extra.language,d=a.core.util.browser;b=a.parseParam({src:"http://weibo.com/a/verify/realname?stage=home_verification",icon:"warn",isHold:!0,width:"380px",height:"240px",title:c("#L{帐号验证}")},b||{});var e={},f,g,h=!1,i="tblog_checkfailed_reform",j={init:function(){!d.IE6&&!d.IE7&&(window.document.domain="weibo.com");f=a.ui.dialog(b);var c=[];c.push('<iframe id="account_authentication" name="account_authentication" node-type="frame" width="'+b.width+'" height="'+b.height+'" allowtransparency="true" scrolling="no" frameborder="0" src=""></iframe>');var e=a.builder(c.join(""));f.setTitle(b.title);f.setContent(e.box);var g=f.getDomList();a.addEvent(g.close[0],"click",function(){history.go(0)})},show:function(){try{SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_box")}catch(c){}h||a.kit.io.cssLoader("style/css/module/layer/layer_check_identity.css","js_style_css_module_layer_check_identity",function(){h=!0});f.show().setMiddle();g=a.E("account_authentication");var d=decodeURIComponent(b.src)+"&rnd=";g.attachEvent?g.attachEvent("onload",function(){g.height=b.height;f.setMiddle()}):g.onload=function(){g.height=b.height;f.setMiddle()};g.src=d+a.core.util.getUniqueKey()},destroy:function(){},hook:function(a,b){try{a=="100000"?j.verifySucc():j.verifyFail()}catch(c){}},verifySucc:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_success");f.hide();var b={title:c("#L{提示}"),icon:"success",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_play");history.go(0)},OKText:c("#L{进入首页}"),msg:c("#L{恭喜，您的身份已验证成功，马上进入新浪微博。}")},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})},verifyFail:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_twotimes");f.hide();var b={title:c("#L{提示}"),icon:"warn",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_triple");j.show()},OKText:c("#L{再次验证}"),msg:c("#L{抱歉，您的身份信息不准确，请再次验证。<br/>}")+'<a class="S_spetxt" suda-data="key=tblog_checkfailed_reform&value=checkfailed_havealook" href="http://weibo.com">'+c("#L{您也可以先体验微博，随后再验证身份信息>>}")+"</a>"},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})}};j.init();e.destroy=j.destory;e.show=j.show;window.App=window.App||{};window.App.checkRealName=j.hook;return e}});
STK.register("common.dialog.memberDialog",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt1" node-type="textComplex"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl><div class="btn"><a class="W_btn_b" node-type="OK"></a><a class="W_btn_d" node-type="cancel"></a><a href="http://vip.weibo.com/paycenter?pageid=byebank" class="W_btn_v" node-type="member"><span><em class="W_ico16 ico_member"></em>#L{立即开通会员}</span></a></div></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.kit.extra.language,e=function(e,f){var g,h,i,j,k,l;g=a.parseParam({title:d("#L{提示}"),icon:"warn",textLarge:e,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),cancel:a.funcEmpty,cancelText:d("#L{确认}")},f);g.icon=c[g.icon];h={};var i=a.ui.mod.layer(d(b));j=a.ui.dialog();j.setContent(i.getOuter());i.getDom("icon").className=g.icon;i.getDom("textLarge").innerHTML=g.textLarge;i.getDom("textComplex").innerHTML=g.textComplex;i.getDom("textSmall").innerHTML=g.textSmall;i.getDom("OK").innerHTML="<span>"+g.OKText+"</span>";i.getDom("cancel").innerHTML="<span>"+g.cancelText+"</span>";j.setTitle(g.title);var m=function(){k=!0;l=a.htmlToJson(i.getDom("textComplex"));j.hide()};a.addEvent(i.getDom("OK"),"click",m);a.addEvent(i.getDom("cancel"),"click",j.hide);a.custEvent.add(j,"hide",function(){a.custEvent.remove(j,"hide",arguments.callee);a.removeEvent(i.getDom("OK"),"click",m);a.removeEvent(i.getDom("cancel"),"click",j.hide);k?g.OK(l):g.cancel(l)});j.show().setMiddle();h.cfm=i;h.dia=j;return h};return function(b){b=a.parseParam({type:"follow",errortype:"1"},b);var c,f,g={textLarge:d("#L{您已达到悄悄关注上限！}"),textComplex:d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{悄悄关注上限立即提高}'),textSmall:d('#L{可}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{开通会员}</a>#L{或先将悄悄关注减少至10人以下，再添加}'),OKText:d("#L{管理我的悄悄关注}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/whisper"}},h={textLarge:d("#L{您已达到关注上限！}"),textComplex:d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{关注上限立即提高}'),textSmall:d('#L{可}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{开通会员}</a>#L{或先将关注减少至2000人以下，再添加}'),OKText:d("#L{管理我的关注}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/follow"}};if(b.type=="quiet"){switch(parseInt(b.errortype,10)){case 2:g.textLarge=d("#L{您当前已达会员等级悄悄关注上限啦！}");g.textSmall="";g.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{了解更多会员特权信息»}</a>');break;case 1:g.textLarge=d("#L{您已达到悄悄关注上限！}");g.textSmall="";g.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{悄悄关注上限立即提高}');break;case 3:g.textLarge=d("#L{您已达到悄悄关注上限！}");g.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{悄悄关注上限立即提高}');g.textSmall=d('#L{可}<a href="http://vip.weibo.com/paycenter">#L{开通会员}</a>#L{或将悄悄关注减少至10人以下，再添加}')}c=g}else{switch(parseInt(b.errortype,10)){case 2:h.textLarge=d("#L{您当前已达会员等级关注上限啦！}");h.textSmall="";h.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{了解更多会员特权信息»}</a>');break;case 1:h.textLarge=d("#L{您已达到关注上限！}");h.textSmall="";h.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{关注上限立即提高}');break;case 3:h.textLarge=d("#L{您已达到关注上限！}");h.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{关注上限立即提高}');h.textSmall=d('#L{可}<a href="http://vip.weibo.com/paycenter">#L{开通会员}</a>#L{或将关注减少至2000人以下，再添加}')}c=h}f=e("",c);parseInt(b.errortype,10)==2?f.cfm.getDom("member").style.display="none":f.cfm.getDom("cancel").style.display="none"}});
STK.register("common.layer.ioError",function(a){var b=a.kit.extra.language,c;return function(d,e,f){var g={},h,i,j=function(){},k={title:b("#L{发布失败}"),warnMsg:b("#L{该组成员已达上限，不能对该组发布定向微博。}"),OKText:b("#L{知道了}"),textComplex:b('#L{微博会员可以提高分组上限} <a href="http://vip.weibo.com/prividesc?priv=1110">#L{了解更多}»</a>'),vip:b("#L{开通会员}")},l={init:function(){l.data()},data:function(){i=a.parseParam({auto:!0,call:j,ok:j,cancel:j},f);h=a.parseParam({location:"",icon:"warn",title:b("#L{提示}"),OKText:b("#L{确 定}"),cancelText:b("#L{取 消}"),suda:""},e.data);h.msg=e.msg||b("#L{系统繁忙}");h.OK=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.ok||{};SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.ok();h.location&&(window.location.href=h.location)};h.cancel=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.cancel||{};SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.cancel()}},run:function(){var a=m[e.code]||m[100001];return a()||i.call(h,e)},destroy:function(){c&&c.destroy()}},m={100001:function(){a.ui.alert(h.msg,h)},100002:function(){window.location.reload()},100003:function(){a.ui.confirm(h.msg,h)},100004:function(){c||(c=a.common.dialog.authentication());c.show()},100005:function(){h.type=e.data&&(e.data.type?e.data.type:"follow");h.errortype=e.data&&(e.data.errortype||"1");return a.common.dialog.memberDialog(h||{})},100006:function(){a.ui.alert(k.warnMsg,{title:k.title,OKText:k.OKText})},100007:function(){a.ui.vipConfirm(k.warnMsg,{icon:"warn",title:k.title,toBeVipText:k.vip,textComplex:k.textComplex,OKText:k.OKText,toBeVip:function(){a.preventDefault();window.location.href="http://vip.weibo.com/paycenter?refer=publish"}})}};l.init();g.getdata=function(){return h};g.getAction=function(a){return a?m[a]:m};g.getCode=function(){return e.code||""};g.run=l.run;i.auto&&l.run();return g}});
STK.register("common.layer.vipError",function(a){var b='<#et temp data><div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="${data.icon}" node-type="icon"></span></dt><dd node-type="inner">${data.info}</dd></dl><div class="btn"><a href="###" <#if (data.lbtnStyle == 1)>class="W_btn_a"<#else if (data.lbtn == 0)>class="W_btn_b"</#if> node-type="lbtn"><span><#if (data.lbtnIcon == 1)><i class="W_ico16 ico_member"></i></#if>${data.lbtnText}</span></a><a href="###" <#if (data.rbtnStyle == 1)>class="W_btn_a"<#else if (data.rbtn == 0)>class="W_btn_b"</#if> node-type="rbtn"><span><#if (data.rbtnIcon == 1)><i class="W_ico16 ico_member"></i></#if>${data.rbtnText}</span></a></div></div></#et>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.kit.extra.language,e=function(e){var f,g,h;f=a.parseParam({title:d("#L{提示}"),icon:"warn",info:"",lbtnFunc:a.funcEmpty,lbtnStyle:0,lbtnIcon:0,lbtnText:d("#L{立即开通会员}"),rbtnFunc:a.funcEmpty,rbtnStyle:0,rbtnIcon:0,rbtnText:d("#L{立即开通会员}")},e);f.icon=c[f.icon];var g=a.ui.mod.layer(a.core.util.easyTemplate(b,f).toString());h=a.ui.dialog();h.setContent(g.getOuter());h.setTitle(f.title);var i=function(){f.lbtnFunc();h.hide()},j=function(){f.rbtnFunc();h.hide()};a.addEvent(g.getDom("lbtn"),"click",i);a.addEvent(g.getDom("rbtn"),"click",j);a.custEvent.add(h,"hide",function(){a.custEvent.remove(h,"hide",arguments.callee);a.removeEvent(g.getDom("lbtn"),"click",i);a.removeEvent(g.getDom("rbtn"),"click",j)});h.show().setMiddle();return h};return function(a,b){if(a=="100096"||a=="100098"){b.lbtnStyle=0;b.lbtnIcon=0;b.lbtnText=d("#L{管理分组}");b.rbtnStyle=1;b.rbtnIcon=1;b.rbtnText=d("#L{开通会员}");b.rbtnFunc=function(){location.href="http://vip.weibo.com/paycenter?form=group"}}else if(a=="100097"){b.lbtnStyle=0;b.lbtnIcon=0;b.lbtnText=d("#L{管理分组}");b.rbtnStyle=0;b.rbtnIcon=0;b.rbtnText=d("#L{知道了}")}return e(b)}});
STK.register("ui.bubbleLayer",function(a){var b='<div class="W_layer" node-type="outer" style="display:none;"><div class="bg"><div class="effect"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content clearfix" node-type="inner"></div></td></tr></tbody></table><div node-type="arrow" class="#{arrow_type}"></div></div></div></div>';return function(c,d){var e,f,g,h,i,j,k=function(a){a=a?"arrow arrow_"+a:"";return a},l=function(a){f.style.top=a.t+"px";f.style.left=a.l+"px";return h},m=function(){var b=a.core.util.winSize(),c=e.getSize(!0);f.style.top=a.core.util.scrollPos().top+(b.height-c.h)/2+"px";f.style.left=(b.width-c.w)/2+"px";return h},n=function(a){typeof a=="string"?g.innerHTML=a:g.appendChild(a);return h},o=function(a,b){var c="";a==="t"||a==="b"?b==="right"?c="left:auto;right:30px;":b==="center"&&(c="left:auto;right:"+(f.offsetWidth/2-8)+"px;"):(a==="l"||a==="r")&&b==="bottom"&&(c="top:auto;bottom:20px;");i.className=k(a);i.style.cssText=c;return h},p=function(a){a=k(a);i.className=a;return h},q=function(){d=k(d);j=b.replace(/\#\{arrow_type\}/g,d);e=a.ui.mod.layer(j);f=e.getOuter();g=e.getDom("inner");i=e.getDom("arrow");h=e;c&&n(c);document.body.appendChild(f)};q();h.setPostion=l;h.setMiddle=m;h.setContent=n;h.setArrow=o;return h}});
STK.register("ui.popCard",function(a){var b=5,c=28,d=38,e=200,f=200,g=function(b,c,d){var e,f,g,h,i,j,k=a.core.util.scrollPos(),l=a.core.dom.position(b),m=a.core.util.winSize();i=b.offsetWidth;j=b.offsetHeight;g=l.t-k.top;e=l.l-k.left;f=m.width-e-i;h=m.height-g-j;return{t:g,l:e,r:f,b:h,w:i,h:j,x:l.l,y:l.t}},h=function(a){var c=a.nodeW,d=a.nodeH,e=a.dis,f=a.cardWidth,g=a.cardHeight,h=a.arrow,i=a.node,j=a.offsetH,k=a.offsetW,l=a.arPos,m={};switch(h){case"t":m.l=e.x-k+c/2;m.t=e.y-b-g;break;case"r":m.l=e.x+c+b;m.t=e.y-j+d/2;break;case"b":m.l=e.x-k+c/2;m.t=e.y+d+b;break;case"l":default:m.l=e.x-f-b;m.t=e.y-j+d/2}return m},i=function(b){var e=b.node,i=b.cardWidth,j=b.cardHeight,k=b.arrowPos||"auto",l=(b.order||"b,r,t,l").split(","),m=l[0],n=Math.max(j,f),o={l:i,b:n,t:n,r:i},p={l:"r",b:"t",t:"b",r:"l"},q=g(e),r=q.w,s=q.h,t=c,u=d,v=e.getClientRects?e.getClientRects():null,w=parseInt(a.getStyle(e,"lineHeight"),10),x=b.event;if(v&&v.length>1){var y;if(x.pageX-q.x>r/2){y=v[0];q.x=y.left;q.l+=y.left-v[1].left;s=y.bottom-y.top;r=y.right-y.left}else{y=v[1];q.y+=y.top-v[0].top;q.r+=v[0].right-y.right;s=y.bottom-y.top;r=y.right-y.left}}for(var z=0,A=l.length;z<A;z++){var B=l[z];if(q[B]>o[B]){m=B;break}}k==="auto"&&((m==="t"||m==="b")&&r/2+q.r<i-d?k="right":s/2+q.b<j-c&&(k="bottom"));k==="right"?u=i-d:k==="bottom"?t=j-c:k==="center"&&(u=i/2);var C=h({nodeW:r,nodeH:s,dis:q,cardWidth:i,cardHeight:j,arrow:m,node:e,offsetH:t,offsetW:u});return{dire:p[m],pos:C,arPos:k}},j=function(a,b){return function(){return a.apply(b,arguments)}},k=function(){this.bubLayer=a.ui.bubbleLayer();this.cardPanel=this.bubLayer.getOuter();this.initBind()};k.prototype={initBind:function(){var b=j(this.stopHide,this),c=j(this.hideCard,this);a.addEvent(this.cardPanel,"mouseover",b);a.addEvent(this.cardPanel,"mouseout",c);this.dEvent=a.core.evt.delegatedEvent(this.cardPanel)},stopShow:function(){this.showTimer&&clearTimeout(this.showTimer)},stopHide:function(){this.hideTimer&&clearTimeout(this.hideTimer)},showCard:function(a){var b=a.zIndex||9999;this.cardPanel.style.zIndex=b;this.bubLayer.setContent(a.content).show();this.node=a.node;this.arrowPos=a.arrowPos;this.order=a.order;this.direPos=i({node:this.node,cardWidth:this.cardPanel.offsetWidth,cardHeight:this.cardPanel.offsetHeight,arrowPos:this.arrowPos,order:this.order,event:a.event});this.bubLayer.setPostion(this.direPos.pos).setArrow(this.direPos.dire,this.direPos.arPos)},setContent:function(a){var b=this.cardPanel.offsetHeight;this.bubLayer.setContent(a);if(this.direPos.dire==="b"){var c=this.cardPanel.offsetHeight-b;this.bubLayer.setPostion({l:this.direPos.pos.l,t:this.direPos.pos.t-c})}},hideCard:function(){var a=this;this.hideTimer=setTimeout(function(){a.bubLayer.hide()},e)}};return function(){return new k}});
STK.register("common.channel.relation",function(a){var b=["follow","unFollow","removeFans","block","unBlock","addFriends","removeFriends","updateRemark"];return a.common.listener.define("common.channel.relation",b)});
STK.register("common.trans.validateCode",function(a){var b=a.kit.io.inter(),c=b.register;c("checkValidate",{url:"/aj/pincode/verified?_wv=5",method:"post"});return b});
STK.register("common.dialog.validateCode",function(a){var b=window.$LANG,c=a.kit.extra.language,d="/aj/pincode/pin?_wv=5&type=rule&lang="+$CONFIG.lang+"&ts=",e={dialog_html:'<div class="layer_veriyfycode"><div class="v_image"><img height="50" width="450" class="yzm_img" /></div><p class="v_chng"><a href="#" onclick="return false;" class="yzm_change" action-type="yzm_change">#L{换另一组题目}</a></p><p class="v_ans_t">#L{请输入上面问题的答案}：</p><p class="v_ans_i"><input type="text" class="W_inputStp v_inp yzm_input ontext" action-type="yzm_input"/><div class="M_notice_del yzm_error" style="display:none;"><span class="icon_del"></span><span class="txt"></span></div></p><p class="v_btn"><a class="W_btn_d yzm_submit" href="#" action-type="yzm_submit"><span>#L{确定}</span></a><a class="W_btn_b yzm_cancel" href="#" action-type="yzm_cancel" action-data="value=frombtn"><span>#L{取消}</span></a></p></div>'},f;return function(){if(f)return f;var b={},g={},h,i,j,k,l=function(){g.yzm_error.innerHTML="";g.yzm_error.parentNode.style.display="none"},m=function(a){g.yzm_error.innerHTML=a;g.yzm_error.parentNode.style.display=""},n=function(){a.kit.io.cssLoader("style/css/module/layer/layer_verifycode.css","js_style_css_module_layer_layer_verifycode",function(){h||o();l();h.show();t.changesrc();h.setMiddle();g.input_text.value="";a.hotKey.add(document.documentElement,["esc"],t.closeDialog,{type:"keyup",disableInInput:!0})})},o=function(){h=a.ui.dialog({isHold:!0});h.setTitle(c("#L{请输入验证码}"));h.setContent(c(e.dialog_html));var b=h.getOuter();s(b);u()},p=a.common.trans.validateCode.getTrans("checkValidate",{onError:function(){m(c("#L{验证码错误}"));t.changesrc();j=!1;g.input_text.value=""},onFail:function(){m(c("#L{验证码错误}"));t.changesrc();g.input_text.value="";j=!1},onSuccess:function(b,c){var d=b.data.retcode;l();g.input_text.value="";h.hide();var e=i.requestAjax,f=a.kit.extra.merge(i.param,{retcode:d});e.request(f);j=!1}}),q=function(){},r=function(){},s=function(b){g.vImg=a.core.dom.sizzle("img.yzm_img",b)[0];g.yzm_change=a.core.dom.sizzle("a.yzm_change",b)[0];g.yzm_submit=a.core.dom.sizzle("a.yzm_submit",b)[0];g.yzm_cancel=a.core.dom.sizzle("a.yzm_cancel",b)[0];g.input_text=a.core.dom.sizzle("input.yzm_input",b)[0];g.yzm_error=a.core.dom.sizzle("div.yzm_error span.txt",b)[0];g.close_icon=h.getDom("close")},t={enter:function(){a.fireEvent(g.yzm_submit,"click")},changesrc:function(){var b=d+a.getUniqueKey();g.vImg.setAttribute("src",b);try{g.yzm_change.blur()}catch(c){}},checkValidateCode:function(){l();var b=a.core.str.trim(g.input_text.value);if(!b)m(c("#L{请输入验证码}"));else if(!j){j=!0;p.request({secode:b,type:"rule"})}try{g.yzm_submit.blur()}catch(d){}},closeDialog:function(b){typeof b=="object"&&b.el&&h.hide();typeof i=="object"&&i.onRelease&&typeof i.onRelease=="function"&&i.onRelease();a.hotKey.remove(document.documentElement,["esc"],t.closeDialog,{type:"keyup"});try{a.preventDefault()}catch(c){}},onFocus:function(b){b=a.core.evt.getEvent();var c=b.target||b.srcElement,d=c.value;d||l()}},u=function(){var b=h.getOuter();k=a.core.evt.delegatedEvent(b);k.add("yzm_change","click",function(){t.changesrc();a.preventDefault()});k.add("yzm_submit","click",function(){t.checkValidateCode();a.preventDefault()});k.add("yzm_cancel","click",t.closeDialog);a.core.evt.addEvent(g.close_icon,"click",t.closeDialog);a.core.evt.addEvent(g.input_text,"focus",t.onFocus);a.core.evt.addEvent(g.input_text,"blur",t.onFocus);a.hotKey.add(g.input_text,["enter"],t.enter,{type:"keyup"})},v=function(){if(h){k.destroy();a.core.evt.removeEvent(g.close_icon,"click",t.closeDialog);a.core.evt.removeEvent(g.input_text,"focus",t.onFocus);a.core.evt.removeEvent(g.input_text,"blur",t.onFocus);h&&h.destroy&&h.destroy()}h=f=null},w=function(a,b,c){if(a.code=="100027"){i=c;n()}else if(a.code==="100000")try{var d=c.onSuccess;d&&d(a,b)}catch(e){}else try{if(a.code==="100002"){window.location.href=a.data;return}var d=c.onError;d&&d(a,b)}catch(e){}};r();r=null;b.destroy=v;b.validateIntercept=w;b.addUnloadEvent=function(){h&&a.core.evt.addEvent(window,"unload",v)};f=b;return b}});
STK.register("common.relation.followPrototype",function(a){var b={},c=a.common.trans.relation,d=a.common.channel.relation,e=a.kit.extra.merge,f=a.common.dialog.validateCode(),g=function(b,c){a.ui.alert(b.msg)},h=function(b,g){var h=a.kit.extra.merge({uid:"",f:0,extra:"",oid:$CONFIG.oid,nogroup:!1},g||{});if(b==="follow"){var i=c.getTrans(b,{onComplete:function(c,h){var j={onSuccess:function(a,c){var f=e(g,a.data);d.fire(b,f);var h=g.onSuccessCb;typeof h=="function"&&h(f)},onError:function(b,c){a.common.layer.ioError(b.code,b)},requestAjax:i,param:h,onRelease:function(){}};f.validateIntercept(c,h,j)}});i.request(h)}else a.common.trans.relation.request(b,{onSuccess:function(a,c){var f=e(g,a.data);d.fire(b,f);var h=g.onSuccessCb;typeof h=="function"&&h(f)},onError:function(b,c){a.common.layer.ioError(b.code,b)}},h)},i=function(a){h("follow",a)},j=function(a){h("unFollow",a)},k=function(a){h("block",a)},l=function(a){h("unBlock",a)},m=function(a){h("removeFans",a)};b.follow=i;b.unFollow=j;b.block=k;b.unBlock=l;b.removeFans=m;return b});
STK.register("common.relation.baseFollow",function(a){var b=window.$CONFIG||{},c=b.imgPath+"/style/images/common/transparent.gif";return function(b){var c={},d=a.common.channel.relation,e=a.core.evt.delegatedEvent(b),f=a.common.relation.followPrototype,g=a.kit.extra.merge,h=a.kit.extra.language,i=a.common.dialog.setGroup(),j={unFollowTips:h("#L{确认取消关注吗？}"),bothFollow:h("#L{互相关注}"),singleFollow:h("#L{已关注}")},k=a.ui.tipConfirm({info:j.unFollowTips}),l={follow:h('<div class="W_btn_c"><span><em class="W_ico12 icon_addone"></em>#L{已关注}<em class="W_vline S_txt2">|</em><a class="S_link2" action-type="{actionType}" action-data="uid={uid}&fnick={fnick}&f=1&nogroup={nogroup}" href="javascript:void(0);"><em>#L{取消}</em></a></span></div>'),unFollow:h('<a action-type="follow" action-data="uid={uid}&fnick={fnick}&f=1&nogroup={nogroup}" href="javascript:void(0);" class="W_btn_b"><span>{followMe}<em class="addicon">+</em>#L{关注}</span></a>'),block:h('<div class="W_addbtn_even">#L{已加入黑名单}<span class="W_vline">|</span><a action-type="unBlock" action-data="uid={uid}&fnick={fnick}&f=1" href="javascript:void(0);" class="S_link2"><em>#L{解除}</em></a></div>'),loading:h('<b class="loading"></b>#L{加关注}'),followMe:h('<em class="W_ico12 icon_addone"></em><em class="W_vline S_txt2">|</em>')},m=function(a,b){b=b||{};var c=a;for(var d in b)c=c.replace("{"+d+"}",b[d]);return c},n=function(c){var d=a.core.dom.sizzle("a[action-data*=uid="+c+"]",b)[0],e;if(!!d){do{var f=d.getAttribute("node-type");if(f==="followBtnBox"){e=d;break}d=d.parentNode}while(d&&d.tagName.toLowerCase()!=="body");return e}},o={followed:function(a){var b=n(a.uid);if(!!b){var c="addbtn_d",d=j.singleFollow,e="unFollow",f=a.relation||{};if(f.following&&f.follow_me){c="addbtn_c";d=j.bothFollow;e="unFollow"}var g=m(l.follow,{className:c,focDoc:d,actionType:e,uid:a.uid,fnick:a.fnick,nogroup:a.nogroup||""});b.innerHTML=g||""}},unFollow:function(a){var b=n(a.uid);if(!!b){var c=a.relation||{},d=m(l.unFollow,{followMe:c.follow_me?l.followMe:"",uid:a.uid,fnick:a.fnick});b.innerHTML=d}},blocked:function(a){var b=n(a.uid);if(!!b){var c=m(l.block,{uid:a.uid,fnick:a.fnick});b.innerHTML=c}}},p={followListener:function(a){o.followed(a)},unFollowListener:function(a){o.unFollow(a)},blockListener:function(a){o.blocked(a)},unBlockListener:function(a){o.unFollow(a)},removeFansListener:function(a){var b=a.relation||{};b.following?o.followed(a):o.unFollow(a)}},q={follow:function(b){var d=a.sizzle("span",b.el)[0];d.innerHTML=l.loading;var e=b.el.dataset&&b.el.dataset.mark||b.el.getAttribute("data-mark")||"",g={};e&&(g=a.queryToJson(e));var h=a.common.getDiss(a.kit.extra.merge(a.kit.extra.merge({onSuccessCb:function(b){var d={uid:b.uid,fnick:b.fnick,groupList:b.group,hasRemark:!0,nogroup:b.nogroup||"",fromFollow:!0};a.custEvent.fire(c,"followSucc",d);d.nogroup||i.show(d)}},b.data||{}),g),b.el);f.follow(h)},unFollow:function(b){if(!b.data.nogroup){var c=b.data.fnick||h("#L{该用户}");k.setInfo(h("#L{确定不再关注}")+c+"?");k.setLayerXY(b.el);k.aniShow();k.okCallback=function(){f.unFollow(a.common.getDiss(b.data,b.el))}}else f.unFollow(a.common.getDiss(b.data,b.el))},unBlock:function(b){a.ui.confirm(h("#L{确认将此用户从你的黑名单中解除吗？}"),{OK:function(){f.unBlock(b.data)}})}},r=function(){s();t()},s=function(){d.register("block",p.blockListener);d.register("follow",p.followListener);d.register("unBlock",p.unBlockListener);d.register("unFollow",p.unFollowListener);d.register("removeFans",p.removeFansListener)},t=function(){e.add("follow","click",q.follow);e.add("unBlock","click",q.unBlock);e.add("unFollow","click",q.unFollow);a.custEvent.define(c,["followSucc"])},u=function(b){if(!a.core.dom.isNode(b))throw"[STK.common.relation.baseFollow]:node is not a Node!"},v=function(){e.destroy();i.destroy();d.remove("block",p.blockListener);d.remove("follow",p.followListener);d.remove("unBlock",p.unBlockListener);d.remove("unFollow",p.unFollowListener);d.remove("removeFans",p.removeFansListener);p=null};r();c.destroy=v;return c}});
STK.register("common.layer.userCard",function(a){var b=3e5,c=500,d,e,f,g,h,i='<div style="width:360px;padding-top:15px;padding-bottom:15px;text-align:center"><span>#{msg}</span></div>';return function(e,f){var j={},k=a.kit.extra.language,l=a.common.channel.relation,m=a.templet,n=a.parseParam({order:"t,b,l,r",zIndex:9999,type:0,variety:"userCard",arrowPos:"auto",loadTemp:k('<div class="W_loading" style="width:360px;padding-top:15px;padding-bottom:15px;text-align:center"><span>#L{正在加载，请稍候}...</span></div>')},f||{}),o=a.common.trans.relation.getTrans(n.variety,{onComplete:function(b,c){if(b.code=="100000"){var e=c.id||c.name;p.setCache(e,b.data);d.setContent(b.data);(d.delayShow||a.funcEmpty)()}else{if(!b||!b.msg||typeof b.msg!="string")b={msg:k("#L{加载失败}")};d.setContent(m(i,b))}}}),p={data:[],getCache:function(a){var c=this.data[a],d="";if(c){var e=new Date;e-c.date<b?d=c.html:delete this.data[a]}return d},setCache:function(a,b){this.data[a]={date:new Date,html:b}},rmCache:function(a){delete this.data[a]}},q=function(b,e,f,g){d.stopHide();d.stopShow();f=a.fixEvent(f);var h=function(){d.delayShow=h;var c=a.queryToJson(e),i=c.id||c.name,j=p.getCache(i);d.showCard({content:j||n.loadTemp,node:b,order:n.order,arrowPos:n.arrowPos,zIndex:n.zIndex,event:f});j||o.request(a.kit.extra.merge({type:n.type,mark:g&&g.mark||""},c))};d.showTimer=setTimeout(h,c)},r=function(a,b,c){d.stopShow();d.hideCard()},s={rmCache:function(a){p.rmCache(a.uid);p.rmCache(a.fnick)}},t=function(b){g||(g=a.common.dialog.setGroup());g.show({uid:b.data.uid,fnick:b.data.fnick,hasRemark:!1,sex:b.data.sex||"m"})},u=function(b){var c=a.core.dom.firstChild(b.el).innerHTML,d=a.core.str.decodeHTML(c.substring(1,c.length-1)),e=b.data;d===k("#L{设置备注}")&&(d="");a.common.dialog.setRemark({uid:e.uid,remark:d,callback:function(a){p.rmCache(e.uid);p.rmCache(e.fnick)}})},v=function(b){var c=b.data;a.common.trans.relation.request("questions",{onSuccess:function(b,d){a.common.dialog.inviteFollow({name:c.fnick,uid:c.uid,questionList:b.data})},onError:function(b,c){b&&b.code==="100060"?b.msg&&a.ui.confirm(b.msg,{icon:"warn",OKText:k("#L{立刻绑定}"),OK:function(){window.location.href="http://account.weibo.com/settings/mobile";return a.preventDefault()}}):b.msg&&a.ui.alert(b.msg)}},{uid:c.uid})},w=function(){if(!d){d=a.ui.popCard();h=a.common.relation.baseFollow(d.cardPanel);a.custEvent.add(h,"followSucc",r);d.dEvent.add("setGroup","click",t);d.dEvent.add("setRemark","click",u);d.dEvent.add("inviteFollow","click",v)}x();y()},x=function(){if(!a.core.dom.isNode(e))throw"[STK.common.layer.userCard]: node is not a Node!"},y=function(){l.register("follow",s.rmCache);l.register("unFollow",s.rmCache)},z=function(){p.data.length=0;p=null};w();j.destroy=z;j.userCard=d;j.hideCard=r;j.showCard=q;return j}});
STK.register("common.dialog.setGroup",function(a){var b=30,c=!1,d="http://rs.sinajs.cn/sgmark.gif",e=a.kit.extra.language,f=e("<span>#L{等待对方接受邀请}</span>"),g={0:e('<span><em class="addicon">+</em>#L{加密友}</span>'),1:e("<span>#L{已为密友}</span>"),2:e("<span>#L{等待对方接受邀请}</span>")},h={enable:"W_btn_b",disable:"W_btn_c_disable"},i={f:e("#L{邀请她成为你的密友，进行更亲密互动}："),m:e("#L{邀请他成为你的密友，进行更亲密互动}：")};return function(){var f={},j=a.ui.dialog({isHold:!0}),k=a.ui.alert,l={groupBox:'<div class="layer_setup_followlists follow_success" node-type="group_panel" ><input type="hidden" node-type="uid" name="touid"><div class="lsfl_Tit form_table_single" node-type="remarkPanel">#L{备注名称：}<input node-type="remarkInput" type="text" value="#L{设置备注}" class="W_input" name="remark"><div class="M_notice_del" style="display:none;"><span class="icon_del"></span>#L{备注姓名是非法的}</div></div><div class="lsfl_Tit"><div class="W_fb" node-type="miyouText">#L{邀请他成为你的密友，进行更亲密互动}：</div><div node-type="miyouNotice" class="W_tips tips_error clearfix" style="display:none"><p class="icon"><span class="icon_errorS"></span></p><p class="txt" node-type="miyouNotice_text">#L{警告提示}<a href="#">#L{点击查看我的帐号安全度}»</a></p></div><div class="lsfl_gTit add_close_f clearfix">  <div class="left" node-type="miyouMessage"><label for="closefriend_grouplistpanel"><i class="W_ico16 i_conn_close_friend"></i><span node-type="cf_label" class="W_fb W_f_cf">#L{密友圈}</span></label><span class="S_txt3" node-type="miyou_count">(135/140人)</span></div><div class="right W_textb" ><a href="javascript:;" class="W_btn_b" node-type="closefriendBtn" action-type="closefriendBtn">  </a></div>  </div></div><div class="lsfl_gTit clearfix"><div class="left" node-type="message"></div><div class="right W_textb" action-type="tipsLayer"><span class="icon_askS"></span>#L{为什么要设置分组？}<div class="layer_tips" node-type="groupTips" style="display: none;"><ul><li>#L{可以在首页查看设定分组的微博} </li><li>#L{将已经关注的人设置分组，方便管理}</li><li>#L{分组信息是保密的，只有自己可见}</li></ul><span style="left:180px" class="arrow_up"></span></div></div></div><div><div class="W_loading" node-type="loading"><span>#L{正在加载，请稍候...}</span></div><div node-type="groupList"></div></div><div node-type="addGroupPanel"><div class="lsfl_addNew" node-type="showBtnBox"><a class="addnew" href="javascript:;" action-type="showBtn" suda-uatrack="key=group_aftermark&value=new"><span class="ico_addinv"></span><span class="txt">#L{创建新分组}</span></a></div><div class="lsfl_creaNew form_table_single" node-type="addGroupBox" style="display:none;"><input node-type="groupInput" type="text" value="#L{新分组}" class="W_input"><div style="display:none;" node-type="errorTips" class="M_notice_del"><span class="icon_del"></span></div><a href="javascript:;" class="W_btn_a btn_noloading" action-type="addGroup" node-type="addGroup"><span><b class="loading"></b><em node-type="createBtnTxt">#L{创建}</em></span></a><a href="javascript:;" action-type="hideBtn">#L{取消}</a></div></div><div class="btn"><a href="javascript:;" class="W_btn_a btn_noloading" action-type="submit" node-type="submit"><span><b class="loading"></b><em node-type="btnText">#L{保存}</em></span></a><a href="javascript:;" class="W_btn_b" action-type="cancel" suda-uatrack="key=group_aftermark&value=close"><span>#L{取消}</span></a></div></div>',checkBox:'<input type="checkbox" value="{value}" name="gid" class="W_checkbox" {checked} id="group_{groupId}"><label for="group_{groupId}">{name}</label>',recommend:'<div class="btn"><input type="checkbox" class="W_checkbox" id="id_all" node-type="nomore_appear"><label class="check_all" for="id_all"  >'+e("#L{7天内不再出现}")+"</label>"+'<a class="W_btn_a" href="javascript:void(0);" node-type="innerclose"><span>'+e("#L{关闭}")+"</span></a>"+"  </div>"},m={title:"#L{关注成功}",gEmpty:"#L{分组名不能为空}",rEmpty:"#L{备注名不能为空}",gMaxLen:"#L{请不要超过16个字符}",gDefVal:"#L{新分组}",okLabel:"#L{设置成功}",rDefVal:"#L{设置备注}",message:"#L{为 %s 选择分组}",repeat:"#L{此分组名已存在}"},n=!1,o=[],p=0,q=0,r,s,t,u,v,w,x,y,z,A,B,C={cfSuc_1:e("#L{密友邀请已经发送，请等待对方接受}"),cfSuc_2:e("#L{你已经成功添加对方为密友，你们彼此已经是密友啦}"),cfSucTit_1:e("#L{需要对方通过邀请才能加为密友}")},D=function(a){t.remarkInput.value=e(m.rDefVal);t.groupInput.value=e(m.gDefVal);t.loading.style.display="";t.groupList.innerHTML="";t.showBtnBox.style.display="";t.addGroupBox.style.display="none";t.closefriendBtn.className=h.enable;t.closefriendBtn.innerHTML=g[0];t.miyouText.innerHTML=i[a.sex]||i.m;t.closefriendBtn.setAttribute("action-data","type=add");t.miyouNotice.style.display="none"},E=function(){if(!c){c=!0;a.common.trans.relation.getTrans("recommendfollow",{onSuccess:function(b){if(!!b.data){var d=b.data+l.recommend,f=a.ui.dialog({isHold:!0}),g=f.getInner();window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("user_aftermark","close");var h=a.core.str.leftB(r.fnick,16);a.core.str.bLength(h)<a.core.str.bLength(r.fnick)&&(h+="...");g.className="layer_recommed clearfix";a.insertHTML(g,d,"afterbegin");var i=a.sizzle('[node-type="innerclose"]',g)[0];f.setTitle(e("#L{@%s的粉丝还对下面的人感兴趣哦，去看看他们吧~}",h||"TA"));f.show().setMiddle();var j=f.getOuter();j.setAttribute("ucardconf","type=1");var k,m=function(b){var c=a.fixEvent(b),d=c.target,e=d.getAttribute("usercard");if(!!e){k||(k=a.common.layer.userCard(d,{order:"t",zIndex:10002}));k.showCard(d,e,c)}},n=function(b){var c=a.fixEvent(b),d=c.target,e=d.getAttribute("usercard");if(!!e){k||(k=a.common.layer.userCard(d,{order:"t"}));k.hideCard(d,e,c)}};a.addEvent(j,"mouseover",m);a.addEvent(j,"mouseout",n);var o=function(){setTimeout(function(){c=!1},3e3);a.removeEvent(j,"mouseover",m);a.removeEvent(j,"mouseout",n);var b=a.sizzle('[node-type="nomore_appear"]',g)[0],d=0;if(b.checked){d=1;window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("user_aftermark","1")}a.custEvent.remove(f,"hide",o);a.common.trans.relation.getTrans("closerecommend",{onSuccess:function(a){},onFail:function(){},onError:function(){}}).request({recom_tip:d,cuid:$CONFIG.uid})};a.custEvent.add(f,"hide",o);a.addEvent(i,"click",function(){f.hide()})}},onFail:function(){},onError:function(){}}).request({cuid:$CONFIG.uid,fuid:r.uid})}},F=function(a,b){var c,d;if(a=="addGroup"){c=e("#L{创建}");d="createBtnTxt"}else{c=e("#L{保存}");d="btnText"}if(b=="normal"){t[a].className="W_btn_a btn_noloading";t[d].innerHTML=c}else{t[a].className="W_btn_a_disable";t[d].innerHTML=e("#L{保存中...}")}},G=function(b){D(b);r=a.parseParam({uid:"",fnick:"",sex:"m",hasRemark:!0,fromFollow:!1,groupList:[],title:e(m.title),successCb:function(){},cancelCb:function(){}},b);b.tarEl&&(r=a.common.getDiss(r,b.tarEl));z=r.successCb;A=r.cancelCb;t.uid.value=r.uid;if(r.hasRemark){t.remarkInput.removeAttribute("disabled");t.remarkPanel.style.display=""}else{t.remarkInput.setAttribute("disabled","disabled");t.remarkPanel.style.display="none"}r.groupList.length?M(r.groupList):O.request({uid:r.uid});t.message.innerHTML=e(m.message,' <span class="W_fb">'+r.fnick+"</span>");j.setTitle(r.title);j.appendChild(t.group_panel);j.show().setMiddle()},H=function(b){if(!!b){if(r&&r.fromFollow!=!0)return;var c=parseInt(Math.random()*1e4),e=a.C("img");e.src=d+"?n="+b.allGroup+"_"+b.autoSelect+"&gid="+b.gid.join(",")+"&uid="+b.uid+"&rd="+c;document.body.appendChild(e);setTimeout(function(){e.parentNode.removeChild(e)},3e3)}},I=function(a){var a=a||{};j.hide()},J={defVal:e(m.gDefVal),check:function(b){var c="";b===""||b===this.defVal?c=m.gEmpty:a.core.str.bLength(b)>16&&(c=m.gMaxLen);return e(c)},checkRepeat:function(a){var b="";for(var c=o.length;c--;)if(a===o[c].gname){b=m.repeat;break}return e(b)},showError:function(a){t.errorTips.innerHTML='<span class="icon_del"></span>'+a;t.errorTips.style.display=""},hideError:function(){t.errorTips.style.display="none"}},K={defVal:e(m.rDefVal),check:function(b){var c="";b===""?c=m.rEmpty:a.core.str.bLength(b)>16&&(c=m.gMaxLen);return e(c)},showError:function(a){},hideError:function(){}},L=function(b){var c=a.C("li"),d=l.checkBox.replace(/\{value\}/g,b.gid).replace(/\{groupId\}/g,b.gid).replace(/\{name\}/g,b.gname).replace(/\{checked\}/g,b.belong?"checked":"");c.innerHTML=d;return c},M=function(b){o=b;t.addGroupPanel.style.display=b.length>=20?"none":"";a.common.trans.relation.request("checkcloserelation",{onSuccess:function(c,d){var e=c.data.relation||{};q=c.data.close_friends_count||0;var f=e[r.uid]||0;t.closefriendBtn.innerHTML=g[f];if(f>0){t.closefriendBtn.className=h.disable;t.closefriendBtn.setAttribute("action-data","type=remove")}var i={data:b,cftype:f||0,fnick:r.fnick,uid:r.uid};s=a.common.group.groupListPanel(i);t.groupList.appendChild(s.getOuter());t.loading.style.display="none";t.miyou_count.innerHTML="("+q+"/140人)"}},{uid:r.uid})},N={errorCd:function(b,c){if(b.code=="100096"||b.code=="100097"||b.code=="100098"){var d=a.common.layer.vipError(b.code,{info:b.data.html,lbtnFunc:function(){location.href=b.data.gurl}});a.custEvent.add(d,"hide",I)}else a.ui.alert(b&&b.msg||e("#L{保存失败！}"));F("submit","normal")},getGroupSuccess:function(a,b){var c=a.data||[];M(c)},setGroupSuccess:function(b,c){F("submit","normal");a.ui.litePrompt(e(m.okLabel),{type:"succM",timeout:"500"});setTimeout(E,550);I();z(b,c)},setGroupError:function(a,b){J.showError(a.msg)},addGroupSuccess:function(a,b){F("addGroup","normal");var c=a.data,d;t.addGroupPanel.style.display=c.length>=20?"none":"";for(var f in c)if(c[f].belong===1){d=c[f];break}d&&o.push(d);s.add(d);T.hideAddPanel();t.groupInput.value=e(m.gDefVal);s.length()>=20&&(t.addGroupPanel.style.display="none")}},O=a.common.trans.group.getTrans("list",{onSuccess:N.getGroupSuccess,onError:N.errorCd}),P=a.common.trans.group.getTrans("update",{onSuccess:N.setGroupSuccess,onError:N.errorCd,onFail:N.errorCd}),Q=a.common.trans.group.getTrans("batchSet",{onSuccess:N.setGroupSuccess,onError:N.errorCd}),R=a.common.trans.group.getTrans("add",{onSuccess:N.addGroupSuccess,onError:function(b,c){F("addGroup","normal");a.ui.alert(b.msg)}}),S=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},T={showAddPanel:function(){t.showBtnBox.style.display="none";t.addGroupBox.style.display="";t.groupInput.focus()},hideAddPanel:function(){t.showBtnBox.style.display="";t.addGroupBox.style.display="none";J.hideError();t.groupInput.value=J.defVal},addGroup:function(){var b=S(a.trim(t.groupInput.value)),c=J.check(b)||J.checkRepeat(b);if(c)J.showError(c);else{J.hideError();F("addGroup","loading");R.request({name:b})}},submit:function(){var b=S(a.trim(t.groupInput.value)),c=J.checkRepeat(b);if(c)J.showError(c);else{var d={};n=!0;J.hideError();J.check(b)||(d.newgroup=b);d.type="s";var f=s.getData();B=f.isCfInvite;var g=[],h=t.remarkInput.value;h===e(m.rDefVal)&&(h="");d.remark=h;var i=t.uid.value;d.user=i;d.gid=a.jsonToStr(f);if(f.suda_diss&&r.fromFollow==!0){var j=f.suda_diss.suda,k=f.suda_diss.diss;window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("group_aftermark","save:"+j.join(","))}F("submit","loading");P.request(d)}},cancel:function(){n=!1;I()},inputFocus:function(b){return function(c){var c=a.fixEvent(c),d=c.target,e=d.value;b.hideError();e===b.defVal&&(d.value="")}},inputBlur:function(b){return function(c){var c=a.fixEvent(c),d=c.target,e=a.trim(d.value);e||(d.value=b.defVal)}},inputMaxLen:function(c){var c=a.fixEvent(c),d=c.target,e=d.value,f=a.core.str.bLength(e);c.keyCode=="13"?T.submit():f>b&&(d.value=a.core.str.leftB(e,b))},showGroupTips:function(){t.groupTips.style.display=""},hideGroupTips:function(){t.groupTips.style.display="none"},closefriendBtn:function(b){if(b.data.type!="remove"){t.closefriendBtn.className=h.disable;a.common.trans.relation.getTrans("addCloseFriend",{onSuccess:function(a){switch(a.data.cftype){case 1:case"1":t.closefriendBtn.innerHTML=g[1];break;default:t.closefriendBtn.innerHTML=g[2]}t.closefriendBtn.setAttribute("action-data","type=remove");t.miyou_count.innerHTML="("+ ++q+"/140人)"},onError:function(a){t.miyouNotice.style.display="";t.miyouNotice_text.innerHTML=a.msg;t.closefriendBtn.className=h.enable}}).request({uid:[t.uid.value],name:"",inviteid:"",content:""})}}},U=function(){X();V();W()},V=function(){var b=j.getDomList().close[0];b.setAttribute("suda-uatrack","key=group_aftermark&value=close");a.custEvent.define(f,["hide"]);u=a.core.evt.delegatedEvent(t.group_panel);v=T.inputFocus(J);w=T.inputBlur(J);x=T.inputFocus(K);y=T.inputBlur(K);a.addEvent(t.remarkInput,"focus",x);a.addEvent(t.remarkInput,"blur",y);a.addEvent(t.groupInput,"focus",v);a.addEvent(t.groupInput,"blur",w);a.addEvent(t.remarkInput,"keyup",T.inputMaxLen);a.addEvent(t.groupInput,"keyup",T.inputMaxLen);u.add("showBtn","click",T.showAddPanel);u.add("hideBtn","click",T.hideAddPanel);u.add("addGroup","click",T.addGroup);u.add("submit","click",T.submit);u.add("cancel","click",T.cancel);u.add("tipsLayer","mouseover",T.showGroupTips);u.add("tipsLayer","mouseout",T.hideGroupTips);u.add("closefriendBtn","click",T.closefriendBtn)},W=function(){a.custEvent.add(j,"hide",function(){a.custEvent.fire(f,["hide"]);n||A();var b=s.getData();b&&b.suda_diss&&H(b.suda_diss.diss)})},X=function(){var b=a.core.dom.builder(e(l.groupBox));t=a.kit.dom.parseDOM(b.list)},Y=function(){a.custEvent.undefine(f,["hide"]);a.removeEvent(t.remarkInput,"focus",x);a.removeEvent(t.remarkInput,"blur",y);a.removeEvent(t.groupInput,"focus",v);a.removeEvent(t.groupInput,"blur",w);a.removeEvent(t.remarkInput,"keyup",T.inputMaxLen);a.removeEvent(t.groupInput,"keyup",T.inputMaxLen);v=null;w=null;x=null;y=null;u&&u.destroy()};U();f.show=G;f.hide=I;f.destroy=Y;return f}});
STK.register("kit.extra.require",function(a){var b=window.$CONFIG||{},c="loaded",d="waiting",e="loading",f={},g={},h=[],i=[],j=!1,k={maxLine:4,maxRetryTimes:1,baseURL:b.jsPath,version:b.version,timeout:3e4,urlRule:null},l=function(a){var b={},c;for(var d=a.length;d--;){c=a[d];if(b[c])return!1;b[c]=1}return!0},m=function(a){var b=/^http[s]?:\/\//ig;return b.test(a)},n=function(b){var c=a.core.arr.indexOf(b,i);return c!==-1?i.splice(c,1):!1},o=function(a){if(typeof k.urlRule=="function")return k.urlRule(k.baseURL,a,k.version);a=a.replace(/\./ig,"/");return k.baseURL+"home/js/"+a+".js?version="+k.version},p=function(b){i.push(b);g[b].state=e;var h=function(){var a=g[b].depeKeys,d,e,h;n(b);g[b].state=c;j&&s();for(var i=a.length;i--;){e=a[i];d=f[e];d.unReadyNum-=1;if(d.unReadyNum)return;while(f[e].bindFuns.length){h=d.bindFuns.shift();h.func.apply({},[].concat(h.data))}}},l=function(){var a=g[b],c,e,h,i;n(b);a.state=d;if(a.retry<k.maxRetryTimes){a.retry+=1;return p(b)}j&&s();e=a.depeKeys;for(var l=e.length;l--;){h=e[l];c=f[h];while(c.timeoutFuns.length){i=c.timeoutFuns.shift();i.call({},h)}}};a.core.io.scriptLoader({url:m(b)?b:o(b),timeout:k.timeout,onComplete:h,onTimeout:l})},q=function(b,c,e,h){var i=f[b];i||a.log("[STK.kit.extra.require]: The depend "+b+" is undefined!");if(!i.unReadyNum){a.log("依赖关系已加载完成："+b);return c.apply({},[].concat(e))}i.bindFuns.push({func:c,data:e});h&&typeof h.onTimeout=="function"&&i.timeoutFuns.push(h.onTimeout);for(var j=i.urlList.length;j--;){var k=i.urlList[j];if(g[k].state===d){g[k].retry=0;p(k)}}},r=function(b,e,i){(function(){if(a.requirePathMapping){var b=[];for(var c=0,d=e.length;c<d;c++)if(a.requirePathMapping[e[c]]){var f=e[c].split(".");f[f.length-1]=f[f.length-1]+"_"+a.requirePathMapping[e[c]];e[c]=f.join(".");f=null}}})();f[b]!==undefined&&a.log("[STK.kit.extra.require]: "+b+" has been registered!");l(e)||a.log("[STK.kit.extra.require]: The depend URLs is not unique! The depes is ["+e+"]");var j,k=0;i=a.parseParam({activeLoad:!1},i||{});for(var m=e.length;m--;){j=e[m];if(!g[j]){g[j]={depeKeys:[b],state:d,retry:0};i.activeLoad&&h.push(j)}else{g[j].depeKeys.push(b);g[j].state===c&&(k+=1)}}f[b]={urlList:e,bindFuns:[],timeoutFuns:[],unReadyNum:e.length-k};return f[b]},s=function(){if(!h.length)j=!1;else{j=!0;var a=k.maxLine-1-i.length,b;while(a>0&&h.length){b=h.shift();if(g[b].state===d){p(b);a-=1}}}},t=function(b){k=a.core.json.merge(k,b)},u=function(a,b,c){if(typeof b!="function")throw'[STK.kit.extra.require]: The "func" musts be a Function!';return function(d){q(a,b,[].slice.call(arguments),c)}};q.bind=u;q.config=t;q.register=r;q.activeLoad=s;return q});
STK.register("common.depand.asynSendMsg",function(a){var b=a.kit.extra.require;b.register("asyn_sendMsg",["common.dialog.sendMessageMain"],{activeLoad:!0});return b});
STK.register("common.content.message.upload.getExt",function(a){var b={csv:"csv",doc:"word",docx:"word",xls:"excel",xlsx:"excel",ppt:"ppt",pptx:"ppt",pdf:"pdf",rar:"rar",zip:"rar",txt:"txt",mp3:"music",avi:"video",flv:"video",mkv:"video",mp4:"video",mpeg:"video",mpg2:"video",rmvb:"video"};return function(c){var d=a.trim(c.match(/[^\.]+$/)[0]).toLowerCase();return typeof b[d]!="undefined"?b[d]:"default"}});
STK.register("common.content.message.upload.addItem",function(a){var b=a.kit.extra.language;return function(b,c,d){var e=b.getAttribute("swfId")||"",f,g=a.common.content.message.upload.getExt(c),h=c,c=a.core.str.bLength(c)>20?a.core.str.leftB(c,20)+"...":c;d.thumbnail&&d.thumbnail.length!=0?f='<img src="'+d.thumbnail+'" class="img" alt="图片" title="'+h+'">'+c+'<span class="func"><a class="S_link2 del" href="javascript:void(0)" node-type="deleteFile" action-type="deleteFile" action-data="swfId='+e+"&"+STK.core.json.jsonToQuery(d)+'">删除</a></span>':f='<i><img src="'+$CONFIG.imgPath+"style/images/accessory/"+g+'.png" class="doc" alt="附件文件" title="'+h+'"></i>'+c+'<span class="func"><a class="S_link2 del" href="javascript:void(0)" node-type="deleteFile" action-type="deleteFile" action-data="swfId='+e+"&"+STK.core.json.jsonToQuery(d)+'">删除</a></span>';var i="<li>"+f+"</li>";b.style.display="block";b.innerHTML+=i;var j=b.getAttribute("fid")||"";b.setAttribute("fid",j+d.fid+",")}});
STK.register("common.trans.message",function(a){var b=a.kit.io.inter(),c=b.register;c("delete",{url:"/aj/message/del?_wv=5",method:"post"});c("getMsg",{url:"/aj/message/getmessagedetail?_wv=5",method:"get"});c("deleteUserMsg",{url:"/aj/message/destroy?_wv=5",method:"post"});c("create",{url:"/aj/message/add?_wv=5",method:"post"});c("search",{url:"/message",method:"get"});c("attachDel",{url:"/aj/message/attach/del?_wv=5",method:"get"});c("getDetail",{url:"/aj/message/detail?_wv=5",method:"get"});c("getSearchList",{url:"/aj/message/detail?_wv=5",method:"get"});c("getDetailList",{url:"/aj/message/detail?_wv=5",method:"get"});c("noConfirm",{url:"/aj/bubble/closebubble?_wv=5",method:"get"});return b});
STK.register("common.channel.message",function(a){var b=["create","delete"];return a.common.listener.define("common.channel.message",b)});
STK.register("ui.mod.suggest",function(a){var b=null,c=a.custEvent,d=c.define,e=c.fire,f=c.add,g=a.addEvent,h=a.removeEvent,i=a.stopEvent,j=[],k={},l={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9},m=function(b){var c=-1,j=[],k=b.textNode,m=b.uiNode,n=a.core.evt.delegatedEvent(m),o=d(k,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);o.setFlag=p;var p=function(a){b.flag=a},q=function(){return a.sizzle(["[action-type=",b.actionType,"]"].join(""),m)},r=function(){c=-1;h(k,"keydown",s);n.destroy()},s=function(d){var f,g;if(!!(f=d)&&!!(g=f.keyCode)){if(g==l.ENTER){e(o,"onSelect",[c,k,b.flag]);a.preventDefault()}if(g==l.UP){i();var h=q().length;c=c<1?h-1:c-1;e(o,"onIndexChange",[c]);return!1}if(g==l.DOWN){i();var h=q().length;c=c==h-1?0:c+1;e(o,"onIndexChange",[c]);return!1}if(g==l.ESC){i();r();e(o,"onClose");return!1}if(g==l.TAB){r();e(o,"onClose");return!1}}},t=function(c){e(o,"onSelect",[a.core.arr.indexOf(c.el,q()),k,b.flag])},u=function(b){c=a.core.arr.indexOf(b.el,q());e(o,"onIndexChange",[a.core.arr.indexOf(b.el,q())])};f(o,"open",function(a,c){k=c;r();g(c,"keydown",s);n.add(b.actionType,"mouseover",u);n.add(b.actionType,"click",t);e(o,"onOpen",[b.flag])});f(o,"openSetFlag",function(a,b){p(b)});f(o,"close",function(){r();e(o,"onClose",[b.flag])});f(o,"indexChange",function(a,d){c=d;e(o,"onIndexChange",[c,b.flag])});return o},n=function(b){var c=b.textNode,d=a.core.arr.indexOf(c,j);if(!k[d]){j[d=j.length]=c;k[d]=m(b)}return k[d]};return function(c){if(!!c.textNode&&!!c.uiNode){c=a.parseParam({textNode:b,uiNode:b,actionType:"item",actionData:"index",flag:""},c);return n(c)}}});
STK.register("common.trans.global",function(a){var b=a.kit.io.inter(),c=b.register;c("language",{url:"/aj/user/lang?_wv=5",method:"post"});c("followList",{url:"/aj/mblog/attention?_wv=5"});c("topicList",{url:"/aj/mblog/topic?_wv=5"});c("myFollowList",{url:"/aj/relation/attention?_wv=5"});c("closetipsbar",{url:"/aj/tipsbar/closetipsbar?_wv=5",method:"post"});c("weiqunnew",{url:"/ajm/weiqun?action=aj_remindunread"});c("quiet_suggest",{url:"/aj/f/lenovo?ct=10&_wv=5",method:"get"});return b});
STK.register("common.bubble.myFollowSuggest",function(a){var b='<div style="position: absolute; top: -2000px; left: -2000px; z-index: 100001;" node-type="___followListSuggest___" class="layer_menu_list"></div>',c='<#et userlist data><ul><#list data.users as list><li action-type="followItem" action-data="index=${list.uid}"><a href="#" onclick="return false;">${list.screen_name}</a></li></#list></ul>';return function(d){function F(){a.removeEvent(g,"keyup",r);g=null}function E(){h.innerHTML="";a.setStyle(h,"left","-2000px");a.setStyle(h,"top","-2000px");k=null;a.removeEvent(document.body,"click",E)}function D(){y();e||C()}function C(){j=g.value;z();A();B()}function B(){e=a.ui.mod.suggest({textNode:g,uiNode:h,actionType:"followItem",actionData:"index"});a.custEvent.add(e,"onIndexChange",w);a.custEvent.add(e,"onSelect",x);a.custEvent.add(e,"onClose",E);a.addEvent(g,"keyup",r)}function A(){f=a.common.trans.global.getTrans(d.transName||"followList",{onSuccess:t,onError:u,onFail:u})}function z(){var c=a.sizzle('div[node-type="___followListSuggest___"]',document.body);if(a.objIsEmpty(c)&&!h){c=a.builder(b);document.body.appendChild(c.box);c=a.sizzle('div[node-type="___followListSuggest___"]',document.body);!a.objIsEmpty(c)&&(c=c[0])}h=a.isArray(c)?c[0]:c;d.width&&function(){var a=parseInt(d.width,10);h.style.width=d.width+(a==d.width?"px":"")}()}function y(){i=-1}function x(a,b){if(b==null||b<0)b==-1&&d.dontSelectFirst&&p&&p(g.value);else{j=n[b].screen_name;j=j.replace(/\(.*\)/,"");g.value=j;E();p&&p(n[b])}}function w(a,b){if(!!m&&m.length!=0){l!=null&&m[l]&&(m[l].className="");b==null&&(b=0);m[b].className="cur";l=b}}function v(){var b=a.sizzle("li",h);m=b}function u(a,b){E()}function t(b,e){var f;h.innerHTML=a.core.util.easyTemplate(c,{users:b.data||[]});a.addEvent(document.body,"click",E);n=b.data;f=a.position(g);a.setStyle(h,"left",f.l+"px");a.setStyle(h,"top",f.t+g.scrollHeight+"px");v();var i=d.dontSelectFirst?-1:0;a.custEvent.fire(g,"indexChange",i);b.data.length||E()}function s(){f.request(a.parseParam({q:g.value,type:0},d))}function r(){if(!k){a.custEvent.fire(g,"open",g);k=!0}if(a.trim(g.value)!=""&&g.value!=j){j=g.value;s()}else if(a.trim(g.value)==""){E();j=""}}var e,f,g,h,i,j,k,l,m,n,o,p;if(d==null||d!=null&&d.textNode==null)throw new Error("[common.bubble.myFollowSuggest]Required parameter opts.textNode is missing");g=d.textNode;p=d.callback;d.list_template&&(c=d.list_template);if(!a.isNode(g))throw new Error("[common.bubble.myFollowSuggest]Required parameter opts.textNode is NOT a html node.");var q={};q.show=D;q.hide=E;q.destroy=F;return q}});
STK.register("kit.extra.count",function(a){function b(b){var c=41,d=140,e=20,f=b,g=b.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return b(a)}});
STK.register("ui.mod.editor",function(a){var b=a.core.evt.addEvent,c=a.core.evt.custEvent,d=a.core.dom.getStyle,e=a.core.dom.setStyle;return function(b,c){var d={},c=c,e={},f="",g="",h="",i={reset:function(){e.textEl.value="";a.core.evt.custEvent.fire(d,"changed");e.textEl.removeAttribute("extra");f=g=h=""},delWords:function(a){var b=i.getWords();if(!(b.indexOf(a)>-1))return!1;e.textEl.value="";k.textInput(b.replace(a,""))},getWords:function(){return a.core.str.trim(e.textEl.value)},getExtra:function(){var b,c=e.textEl.getAttribute("extra")||"";c!=null&&(b=a.core.str.trim(c));return b},focus:function(b,c){if(typeof b!="undefined")a.kit.extra.textareaUtils.setCursor(e.textEl,b,c);else{var d=e.textEl.value.length;a.kit.extra.textareaUtils.setCursor(e.textEl,d)}j.cacheCurPos()},blur:function(){e.textEl.blur()},addExtraInfo:function(a){typeof a=="string"&&e.textEl.setAttribute("extra",a)},disableEditor:function(b){a.core.evt.removeEvent(e.textEl,"mouseup",j.cacheCurPos);if(b===!0)e.textEl.setAttribute("disabled","disabled");else{a.core.evt.addEvent(e.textEl,"mouseup",j.cacheCurPos);e.textEl.removeAttribute("disabled")}},getCurPos:function(){var a=e.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(e.textEl.value).length==0?a.core.str.trim(e.textEl.value):e.textEl.value;return a.kit.extra.count(b)},addShortUrlLog:function(b){b=b&&a.trim(b);if(b){var c=new RegExp("^"+b+"$|"+"_"+b+"$|^"+b+"_|"+"_"+b+"_");c.test(f)||(f?f=f+"_"+b:f=b)}},getShortUrlLog:function(){return f},setCurrentLogType:function(a){g=a},getCurrentLogType:function(){return g},setImageLogType:function(a){h=a},getImageLogType:function(){return h}},j={textElFocus:function(){e.recommendTopic&&a.core.dom.setStyle(e.recommendTopic,"display","none");a.custEvent.fire(d,"focus");e.num&&a.core.dom.setStyle(e.num,"display","block");i.getWords()==c.tipText&&i.delWords(c.tipText)},textElBlur:function(){setTimeout(function(){if(e.textEl.value.length===0){e.recommendTopic&&a.core.dom.setStyle(e.recommendTopic,"display","block");e.num&&e.recommendTopic&&a.core.dom.setStyle(e.num,"display","none");a.custEvent.fire(d,"blur");typeof c.tipText!="undefined"&&(e.textEl.value=c.tipText)}},50)},cacheCurPos:function(){var b=a.kit.extra.textareaUtils.getSelectedText(e.textEl),c=b==""||b==null?0:b.length,d=a.core.dom.textSelectArea(e.textEl).start,f=d+"&"+c;e.textEl.setAttribute("range",f)}},k={textChanged:function(){a.custEvent.fire(d,"keyUpCount")},textInput:function(b,f){var g=i.getCurPos(),f=g[0],h=g[1];i.getWords()==c.tipText&&b!=c.tipText&&i.delWords(c.tipText);a.kit.extra.textareaUtils.unCoverInsertText(e.textEl,b,{rcs:g[0],rccl:g[1]});j.cacheCurPos();a.core.evt.custEvent.fire(d,"changed")}},l={},m=function(){p();q()},n=function(){r();t();u();o()},o=function(){c.storeWords?e.textEl.value.length==0&&k.textInput(c.storeWords):c.tipText&&(e.textEl.value=c.tipText)},p=function(){if(!b)throw"node is not defined in module editor"},q=function(){var c=a.core.dom.builder(b).list;e=a.kit.dom.parseDOM(c);if(!e.widget)throw"can not find nodes.widget in module editor"},r=function(){a.core.evt.addEvent(e.textEl,"focus",j.textElFocus);a.core.evt.addEvent(e.textEl,"blur",j.textElBlur);a.core.evt.addEvent(e.textEl,"mouseup",j.cacheCurPos);a.core.evt.addEvent(e.textEl,"keyup",j.cacheCurPos)},s=function(){a.core.evt.custEvent.define(d,"changed")},t=function(){s();a.core.evt.custEvent.add(d,"changed",k.textChanged)},u=function(){},v=function(){};m();var w={reset:i.reset,getWords:i.getWords,getExtra:i.getExtra,delWords:i.delWords,focus:i.focus,blur:i.blur,insertText:k.textInput,check:k.textChanged,addExtraInfo:i.addExtraInfo,disableEditor:i.disableEditor,getCurPos:i.getCurPos,count:i.count,textElFocus:j.textElFocus,cacheCurPos:j.cacheCurPos,addShortUrlLog:i.addShortUrlLog,getShortUrlLog:i.getShortUrlLog,setCurrentLogType:i.setCurrentLogType,getCurrentLogType:i.getCurrentLogType,setImageLogType:i.setImageLogType,getImageLogType:i.getImageLogType};d.destroy=v;d.API=w;d.nodeList=e;d.init=n;d.opts=c;return d}});
STK.register("common.editor.plugin.count",function(a){function e(a,b){if(!a.textEl)throw"[editor plugin count]: plz check nodeList"}function d(a){var d=c(a),e=Math.abs(b-d),f;d>b||d<1?f={wordsnum:d,vnum:e,overflow:!0}:d==0?f={wordsnum:d,vnum:e,overflow:!0}:f={wordsnum:d,vnum:e,overflow:!1};return f}function c(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}var b;return function(c){var f=c.nodeList,g,h=c.opts,i=a.kit.extra.language;b=h.limitNum;e(f);a.core.evt.custEvent.define(c,"textNum");a.custEvent.define(c,"keyUpCount");var j=f.textEl,k=f.num;a.addEvent(j,"focus",function(){g=setInterval(function(){l()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var l=function(){var b=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value,e=c&&c.opts&&c.opts.extendText;b=b.replace(/\r\n/g,"\n");var f=d(b,h.limitNum);b.length>=0&&j.focus?f.overflow&&f.wordsnum!=0?k.innerHTML=(e?i(e):"")+i("#L{已经超过%s字}",'<span class="S_error">'+f.vnum+"</span>"):k.innerHTML=(e?i(e):"")+i("#L{还可以输入%s字}","<span>"+f.vnum+"</span>"):b.length===0&&(k.innerHTML=(e?i(e):"")+i("#L{还可以输入%s字}","<span>"+f.vnum+"</span>"));a.core.evt.custEvent.fire(c,"textNum",{count:f.wordsnum,isOver:f.overflow})};STK.core.evt.addEvent(j,"keyup",l);a.custEvent.add(c,"keyUpCount",l)}});
STK.register("kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++)c[b].indexOf(a+":")==0&&c.splice(b,1);return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("kit.dom.isTurnoff",function(a){return function(a){return!a.parentNode||a.parentNode.nodeType==11||!!a.disabled}});
STK.register("ui.mod.at",function(a){var b=window,c=document,d=a.core.util.browser,e="font-family:Tahoma,宋体;",f=a.kit.extra.textareaUtils.selectionStart,g,h,i,j,k,l=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',e,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',e,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}(),m=function(){var b=[],c=g.textEl.style.cssText,d;a.foreach(["margin","padding","border"],function(c){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;c!="border"?e=b.push(c,"-",d.toLowerCase(),":",a.getStyle(g.textEl,c+d),";"):a.foreach(["Style","Width"],function(e){b.push(c,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(g.textEl,[c,d,e].join("")),";")})})});b.push("font-size:"+a.getStyle(g.textEl,"fontSize")+";");return a.kit.dom.cssText([c,b.join(""),e,"\n\t\t\tword-wrap: break-word;\n\t\t\tline-height: 18px;\n\t\t\toverflow-y:auto;\n\t\t\toverflow-x:hidden;\n\t\t\toutline:none;\n\t\t"].join("")).getCss()},n=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,e=b.wrap[0],f=b.flag[0],h=b.after[0],i=b.before[0],j=0,n,o,p,q=function(a){return d.MOZ?-2:d.MOBILE&&d.SAFARI&&(d.IPAD||d.ITOUCH||d.IPHONE)?-2:0};return{bind:function(){if(o!==g.textEl){k=a.position(g.textEl);var b=["left:",k.l,"px;top:",k.t+20,"px;"].join("");o=g.textEl;var d=m();o.style.cssText=d;p=[b,d,"\n\t\t\t\t\tposition:absolute;\n\t\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\t\topacity:0;\n\t\t\t\t\tz-index:-1000;\n\t\t\t\t"].join("");e.style.cssText=p;if(!j){j=1;c.body.appendChild(e)}}},content:function(b,c,d,j){e.style.cssText=[p,"\n\t\t\t\t\twidth:",(parseInt(a.getStyle(o,"width"))||o.offsetWidth)+q(),"px;\n\t\t\t\t\theight:",parseInt(a.getStyle(o,"height"))||o.offsetHeight,"px;\n\t\t\t\t\toverflow-x:hidden;\n\t\t\t\t\toverflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(o,"overflowY"),";\n\t\t\t\t"].join("");i.innerHTML=l(b);f.innerHTML=l(c)||"&thinsp;";h.innerHTML=l([d,j].join(""));clearTimeout(n);n=setTimeout(function(){var b=a.position(f);a.custEvent.fire(g.eId,"at",{t:b.t-o.scrollTop-k.t,l:b.l-k.l,fl:b.l,key:d,flag:c,textarea:g.textEl})},30)},hide:function(){e.style.display="none"},show:function(){e.style.display=""}}}(),o=function(){if(a.kit.dom.isTurnoff(g.textEl))clearInterval(h);else{var b=g.textEl.value.replace(/\r/g,""),c=f(g.textEl);if(c<0||c==j)return;j=c;var d=b.slice(0,c),e=d.match(new RegExp(["(",g.flag,")([a-zA-Z0-9一-龥_-]{0,20})$"].join("")));if(!e){a.custEvent.fire(g.eId,"hidden");return}var i=b.slice(c);d=d.slice(0,-e[0].length);n.content(d,e[1],e[2],i)}};return function(b){if(!!b&&!!b.textEl){b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!!g){clearInterval(h);a.removeEvent(g.textEl,"blur",c);n.hide()}},d=function(){c();g=b;j=null;n.bind();n.show();h=setInterval(o,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b.eId}}});
STK.register("common.channel.at",function(a){var b=["open","close"];return a.common.listener.define("common.channel.at",b)});
STK.register("kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c))throw"kit.dom.layerOutElement need element as first parameter";if(c===document.body)return!1;if(!c.parentNode)return!1;if(c.style.display==="none")return!1;var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed")break;if(k==="true"&&j==="relative")break}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e.pos.split("-");i[0]==="left"?b.style.left=g.l+e.offsetX+"px":i[0]==="right"?b.style.left=g.l+h.w+e.offsetX+"px":i[0]==="center"&&(b.style.left=g.l+h.w/2+e.offsetX+"px");i[1]==="top"?b.style.top=g.t+e.offsetY+"px":i[1]==="bottom"?b.style.top=g.t+h.h+e.offsetY+"px":i[1]==="middle"&&(b.style.top=g.t+h.h/2+e.offsetY+"px");return!0}});
STK.register("common.editor.plugin.at",function(a){var b=a.kit.extra.language,c='<div style="" class="layer_menu_list"><ul node-type="suggestWrap"></ul></div>',d={"@":{normalTitle:b("#L{选择昵称或轻敲空格完成输入}"),moreTitle:b("#L{选择最近@的人或直接输入}"),noTilte:b("#L{轻敲空格完成输入}")},"#":{normalTitle:b("#L{想用什么话题？}")}},e={"@":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.screen_name}" value="${list.screen_name}"><a href="#">${list.screen_name}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'},f,g,h,i,j,k,l=!1,m,n,o={"@":"followList","#":"topicList"},p=0,q=function(){setTimeout(function(){a.custEvent.fire(f,"close")},200)},r=function(){j.style.display="none"},s=function(){a.custEvent.add(f,"onIndexChange",function(a,b){x(b)});a.custEvent.add(f,"onSelect",function(b,c,d,e){p=0;a.core.evt.stopEvent();var g=n[c].getAttribute("value")+"";g=g.replace(/\(.*\)/,"");try{d.focus()}catch(h){}var i=a.kit.extra.textareaUtils.selectionStart(d)*1,j=new RegExp(e+"([a-zA-Z0-9一-龥_-]{0,20})$"),k=d.value.replace(/\r+/g,"").slice(0,i).match(j),l=d.value.slice(i,i+1);k=k&&k[1]?k[1].length:0;var m=a.kit.extra.textareaUtils;e=="#"?typeof l!="undefined"&&l!=e&&(g=g+e+" "):g=g+" ";m.insertText(d,g,i,k);var o=m.getCursorPos(d);if(e=="#"&&l==e){m.setCursor(d,o+1);m.insertText(d," ",o+1,0)}o=m.getCursorPos(d);var q=m.getSelectedText(d),r=q==""||q==null?0:q.length;d.setAttribute("range",o+"&"+r);a.custEvent.fire(f,"close")});a.addEvent(h.textEl,"blur",q);a.custEvent.add(f,"onClose",r);a.custEvent.add(f,"onOpen",function(b,c){i.style.display="";j.style.display="";l=!0;setTimeout(function(){a.custEvent.fire(f,"indexChange",0)},100)})},t=function(b,c,f){b=="@"?c.data&&c.data.length>0?c.title=f==""?d[b].moreTitle:d[b].normalTitle:c.title=d[b].noTilte:c.title=d[b].normalTitle;var g=a.core.util.easyTemplate(e[b],c);return g},u=function(){a.core.evt.custEvent.add(g,"hidden",function(b,c){a.custEvent.fire(f,"close")});a.core.evt.custEvent.add(g,"at",function(b,c){k=c.key;var d=c.flag;if(k.length==0&&d!="@")a.custEvent.fire(f,"close");else var e=a.common.trans.global.getTrans(o[d],{onSuccess:function(b,e){var g=t(d,b,k);a.custEvent.fire(f,"openSetFlag",d);a.custEvent.fire(f,"open",c.textarea);var h=a.core.dom.builder(g),l=h.box;i.innerHTML=l;j.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");a.common.channel.at.fire("open");var m=c.l;document.body.clientWidth<c.fl+a.core.dom.getSize(j).width&&c.fl>a.core.dom.getSize(j).width&&(m=c.l-a.core.dom.getSize(j).width);a.kit.dom.layoutPos(j,c.textarea,{pos:"left-top",offsetX:m,offsetY:c.t})},onError:function(){a.custEvent.fire(f,"close")}}).request({q:k})})},v=function(){m=h.textEl;g=a.ui.mod.at({textEl:m,flag:"@|#"})},w=function(b){p=0;j&&(j.style.display="none");j&&(j.innerHTML="");j=STK.C("div");document.body.appendChild(j);if(j.innerHTML.length==0){j.innerHTML=c;i=a.core.dom.sizzle('[node-type="suggestWrap"]',j)[0];j.style.display="none"}f&&a.custEvent.fire(f,"close");f&&a.custEvent.remove(f);f=a.ui.mod.suggest({textNode:b,uiNode:i,actionType:"item",actionData:"value",flag:"@"});s()},x=function(b){n=a.sizzle("li[class!=suggest_title]",i);n&&n[0]&&a.core.dom.removeClassName(n[p],"cur");a.core.dom.addClassName(n[b],"cur");p=b};return function(a,b){h=a.nodeList;var c={};c.init=function(){v();w(h.textEl);u()};return c}});
STK.register("common.editor.base",function(a){function c(){}var b={limitNum:140};return function(c,d){var e={},f,g,h,i;f=a.kit.extra.merge(b,d);g=a.ui.mod.editor(c,f);h=g.nodeList;i=[];if(typeof d.count=="undefined"||d.count=="enable")var j=a.common.editor.plugin.count(g,f);var k=a.common.editor.plugin.at(g,f);k.init();g.init();g.widget=function(a,b,c){i.push(a);a.init(g,b,c);return g};g.closeWidget=function(){if(i&&i.length!=0)for(var a=0,b=i.length;a<b;a++)i[a].hide()};return g}});
STK.register("ui.mod.bubble",function(a){return function(b,c){var d,e,f,g,h,i,j;e=a.parseParam({width:null,height:null,parent:document.body},c);f=a.ui.mod.layer(b);g=f.getDom("outer");h=f.getDom("inner");f.getDomListByKey("close")&&(i=f.getDom("close"));g.style.display="none";j=!1;var k=function(b){if(j)return!0;var c=a.fixEvent(b);a.contains(g,c.target)||f.hide()};i&&a.addEvent(i,"click",f.hide);a.custEvent.add(f,"show",function(){setTimeout(function(){a.addEvent(document.body,"click",k)},0)});a.custEvent.add(f,"hide",function(){j=!1;a.removeEvent(document.body,"click",k)});d=f;d.setPosition=function(a){g.style.top=a.t+"px";g.style.left=a.l+"px";return d};d.setAlignPos=function(b,c,d){d=a.parseParam({offset:{left:0,top:0},arrowOffset:0,align:"left",fail:a.funcEmpty},d);if(!!a.isNode(b)&&!!a.isNode(c)){var e=b,h;while(e!==document.body){e=e.parentNode;h=a.getStyle(e,"position");if(h==="absolute")break}e.appendChild(g);h=a.position(e);h||(h={l:0,t:0});var i=a.core.dom.getSize,j=a.position(c),k=a.position(b),l=i(b),m=6,n=14,o,p,q,r=d.offset,s=d.arrowOffset,t=i(g),u=i(c),v=2;if(d.align==="left"){if(t.width<k.l-j.l+Math.ceil(l.width/2)){d.fail();return}}else if(j.l+u.width-k.l-Math.ceil(l.width/2)>t.width){d.fail();return}d.align==="left"?o=j.l-v:o=j.l+u.width-t.width+v;p=k.t+l.height+m;q=k.l+Math.ceil((l.width-n)/2)-o;p-=h.t;o-=h.l;p+=r.top;o+=r.left;q+=s;g.style.left=o+"px";g.style.top=p+"px";if(f.getDomListByKey("arrow")){arrow=f.getDom("arrow");arrow.style.left=q+"px"}}};d.setLayout=function(b,c){if(!a.isNode(b))throw"ui.mod.bubble.setDown need element as first parameter";if(f.getDomListByKey("arrow")){arrow=f.getDom("arrow");arrow.style.cssText=""}a.kit.dom.layoutPos(g,b,c);return d};d.setContent=function(b){typeof b=="string"?h.innerHTML=b:a.isNode(b)&&h.appendChild(b);return d};d.setArrow=function(a){var b;if(f.getDomListByKey("arrow")){b=f.getDom("arrow");a.className&&(b.className=a.className||"");a.style&&(b.style.cssText=a.style||"")}};d.clearContent=function(){while(h.children.length)a.removeNode(h.children[0])};d.stopBoxClose=function(){j=!0};d.startBoxClose=function(){j=!1};d.destroy=function(){a.removeEvent(document.body,"click",k);f=null;g=null;h=null;i=null};return d}});
STK.register("ui.bubble",function(a){var b=['<div class="W_layer" node-type="outer">','<div class="bg">','<table cellspacing="0" cellpadding="0" border="0">','<tbody><tr><td><div class="content" node-type="layoutContent">','<a class="W_close" href="javascript:void(0);" node-type="close" title="关闭"></a>','<div node-type="inner"></div>',"</div></td></tr></tbody>","</table>",'<div class="arrow arrow_t" node-type="arrow"></div>',"</div>","</div>"].join(""),c=[];return function(d){var e=a.parseParam({template:b,isHold:!1},d),f={get:function(){return e.isHold?a.ui.mod.bubble(e.template,e):f.checkBob()},checkBob:function(){var a;for(var b=0,d=c.length;b<d;b++)if(!c[b].used){a=c[b].bub;continue}a||(a=f.create());return a},refresh:function(a,b){for(var d=0,e=c.length;d<e;d++)if(a===c[d].bub){c[d].used=b;return}},cevt:function(b){a.custEvent.add(b,"hide",function(){f.refresh(b,!1);b.clearContent()});a.custEvent.add(b,"show",function(){f.refresh(b,!0)})},create:function(){var b=a.ui.mod.bubble(e.template,e);c.push({bub:b,used:!0});f.cevt(b);return b}};return f.get()}});
STK.register("common.trans.editor",function(a){var b=a.kit.io.inter(),c=b.register;c("face",{url:"/aj/mblog/face?type=face&_wv=5"});c("magicFace",{url:"/aj/mblog/face?type=ani&_wv=5"});c("getTopic",{url:"/aj/mblog/trend?_wv=5"});c("cartoon",{url:"/aj/mblog/face?type=cartoon&_wv=5"});c("suggestMusic",{url:"/aj/mblog/music/suggest?_wv=5",requestMode:"jsonp"});c("searchMusic",{url:"http://music.weibo.com/t/port/ajax_search_music_song.php",method:"get",requestMode:"jsonp"});c("addMusic",{url:"/aj/mblog/music/submit?_wv=5",requestMode:"jsonp"});c("parseMusic",{url:"/aj/mblog/music/parse?_wv=5",requestMode:"jsonp"});c("parseVideo",{url:"/aj/mblog/video?_wv=5"});c("waterMark",{url:"/aj/account/watermark?_wv=5"});c("publishToWeiqun",{url:"/aj/weiqun/add?_wv=5",method:"post"});c("rectopic",{url:"/aj/mblog/rectopic?_wv=5"});c("interactive",{url:"/aj/mblog/interactive?_wv=5",method:"post"});c("plugin",{url:"/aj/publishplug/plug?_wv=5",method:"post"});c("favSongSearch",{url:"http://music.weibo.com/yueku/port/sina_t_getcollect.php",method:"get",requestMode:"jsonp"});c("getOutlinkInfo",{url:"http://api.weibo.com/widget/info.json",varkey:"callback",method:"get",requestMode:"jsonp"});c("tabLog",{url:"http://music.weibo.com/t/port/ajax_log_action.php",method:"get",requestMode:"jsonp"});c("getPublish",{url:"/aj/top/usergroup?_wv=5",method:"get"});c("getTvLink",{url:"/aj/proxy/thirdapi?_wv=5",method:"get"});c("getuserlist",{url:"/aj/gift/getuserlist?_wv=5",method:"get"});c("getlist",{url:"/aj/gift/getlist?_wv=5",method:"post"});c("sendGift",{url:"/aj/gift/send?_wv=5",method:"post"});c("newyear",{url:"/aj/publishplug/bainian?_wv=5",method:"get"});return b});
STK.register("ui.mod.mask",function(a){function k(b){var c;(c=b.getAttribute(f))||b.setAttribute(f,c=a.getUniqueKey());return">"+b.tagName.toLowerCase()+"["+f+'="'+c+'"]'}function j(){b=a.C("div");var c='<div node-type="outer">';a.core.util.browser.IE6&&(c+='<div style="position:absolute;width:100%;height:100%;"></div>');c+="</div>";b=a.builder(c).list.outer[0];document.body.appendChild(b);e=!0;d=a.kit.dom.fix(b,"lt");var f=function(){var c=a.core.util.winSize();b.style.cssText=a.kit.dom.cssText(b.style.cssText).push("width",c.width+"px").push("height",c.height+"px").getCss()};i.add(d,"beforeFix",f);f()}var b,c=[],d,e=!1,f="STK-Mask-Key",g=a.core.dom.setStyle,h=a.core.dom.getStyle,i=a.core.evt.custEvent,l={getNode:function(){return b},show:function(c,f){if(e){c=a.core.obj.parseParam({opacity:.3,background:"#000000"},c);b.style.background=c.background;g(b,"opacity",c.opacity);b.style.display="";d.setAlign("lt");f&&f()}else{j();l.show(c,f)}return l},hide:function(){b.style.display="none";c=[];return l},showUnderNode:function(d,e){a.isNode(d)&&l.show(e,function(){g(b,"zIndex",h(d,"zIndex"));var e=k(d),f=a.core.arr.indexOf(c,e);f!=-1&&c.splice(f,1);c.push(e);a.core.dom.insertElement(d,b,"beforebegin")});return l},back:function(){if(c.length<1)return l;var d,e;c.pop();if(c.length<1)l.hide();else if((e=c[c.length-1])&&(d=a.sizzle(e,document.body)[0])){g(b,"zIndex",h(d,"zIndex"));a.core.dom.insertElement(d,b,"beforebegin")}else l.back();return l},resetSize:function(){var c=a.core.util.winSize();b.style.cssText=a.core.dom.cssText(b.style.cssText).push("width",c.width+"px").push("height",c.height+22+"px").getCss();return l},destroy:function(){i.remove(d);b.style.display="none"}};return l});
STK.register("kit.extra.destroyFlash",function(a){var b=a.core.util.browser,c=function(a){if(a){for(var b in a)typeof a[b]=="function"&&(a[b]=null);a.parentNode.removeChild(a)}};return function(d){if(!!a.isNode(d)&&d&&d.nodeName==="OBJECT")if(a.IE&&b.OS==="windows"){d.style.display="none";(function(){d.readyState===4?c(d):setTimeout(arguments.callee,10)})()}else d.parentNode.removeChild(d)}});
STK.register("common.magic",function(a){var b=a.core.util.swf,c=a.ui.mod.mask,d,e,f,g,h,i,j,k=(new Date).getTime()+"",l=(Math.random()+"").replace(".",""),m="STK_flash_"+k+l,n=function(b){if(!d){d=a.C("div");if(!b)d.style.cssText="display:none;width:440px;height:360px;z-index:100000;";else{var c=a.core.util.winSize();d.style.cssText="display:none;width:"+c.width+"px;height:"+c.height+"px;z-index:100000;"}e=a.core.dom.uniqueID(d);h=function(b){b=a.fixEvent(b||window.event);b.target.getAttribute("name")!=e&&o.hide()};document.body.appendChild(d)}},o=function(k,l,p){j=typeof l=="function"?l:a.funcEmpty;p=a.parseParam({isV5update:!1},p);n(p.isV5update);if(!f){f=!0;c.showUnderNode(d);a.addEvent(c.getNode(),"click",h);c.getNode().title="点击关闭";d.style.display="";if(!p.isV5update){g?g.setAlign("c"):g=a.kit.dom.fix(d,"c");d.innerHTML=b.html(k,{id:e,width:440,height:360,paras:{allowScriptAccess:"never",wmode:"transparent"},attrs:{name:e},flashvars:{playMovie:"true"}})}else{g?g.setAlign("lb"):g=a.kit.dom.fix(d,"lb");_closeFun=function(){o.hide()};d.innerHTML=b.html(k,{id:e,width:"100%",height:"100%",paras:{menu:"false",scale:"noScale",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"transparent",base:"http://flashcrossdomain.mps.weibo.com/t5/home/static/upgrade/v5/"},attrs:{name:e},flashvars:{closeAPI:m,v:$CONFIG.version,bgMusic:"http://service.weibo.com/staticjs/v5/bg001.mp3"}})}clearInterval(i);i=setInterval(function(){var a=document[e]||window[e],b=0;if(a&&a.PercentLoaded()==100){clearInterval(i);i=setInterval(function(){var c=a.CurrentFrame(),d;try{d=a.TotalFrames()}catch(e){d=a.TotalFrames}c<0||(c<d&&b<=c?b=c:o.hide())},80)}},100)}};o.hide=function(){clearInterval(i);if(d){d.style.display="none";a.kit.extra.destroyFlash(a.sizzle("embed,object",d)[0]);d.innerHTML=""}a.removeEvent(c.getNode(),"click",h);c.getNode().title="";c.back();f=!1;setTimeout(function(){typeof j=="function"&&j()},0);return o};o.destroy=function(){o.hide();g&&g.destroy();a.removeNode(d);i=d=e=f=g=h};window[m]=function(){o.hide()};return o});
STK.register("common.bubble.face",function(a){var b="",c,d=" pftb_itm_lst ";if($CONFIG&&$CONFIG.brand&&$CONFIG.brand==1){d="";b='<li class="pftb_itm pftb_itm_lst S_line1"><a  href="javascript:void(0);" class="pftb_lk S_line5 S_txt1 S_bg1"  node-type="brand">品牌专区</a></li>';c={init:function(){s.inner.innerHTML=m;a.common.trans.editor.getTrans("face",{onSuccess:function(a,b){c.cache=a.data.brand.norm||{};c.categorys=[q];for(var d in c.cache)c.categorys.push(d);var e=[];for(var f in a.data.brand.norm)e.push(f);c.cache[q]=a.data.brand.norm[e[0]];c.init=function(){c.page=0;c.cPoniter=0;c.currentCategory=q;c.rend();A(c);B(c)};c.init()},onError:function(a,b){}}).request({})},rend:function(){var b=c.currentCategory,d=c.cache[y(b)],e=c.page,f=c.itemNumber;d=d.slice(e*f,e*f+f);d=a.foreach(d,function(b,c){b.phraseB=b.phrase.slice(1,-1);return a.templet(i,b)});s.inner.innerHTML=d.join("")},page:0,cache:null,hotList:null,cPoniter:0,categorys:[],currentCategory:q,itemNumber:72}}var e='<div node-type="outer"><div  class="profile_tab layer_tab S_line5"><ul class="pftb_ul layer_tab S_line1"><li class="pftb_itm S_line1"><a href="javascript:void(0);" class="pftb_lk current S_line5 S_txt1 S_bg5" node-type="general">常用表情</a></li><li class="pftb_itm'+d+' S_line1"><a  href="javascript:void(0);"  node-type="magic">魔法表情</a></li>'+b+"</ul>"+"</div>"+'<div class="layer_faces">'+'<div class="tab_nosep">'+'<span class="right">'+'<a href="javascript:void(0);" node-type="prev" action-type="prev" class="W_btn_c btn_page_prevdis"><span><em class="W_ico12 ico_page_prev"></em></span></a>'+'<a href="javascript:void(0);" node-type="next" action-type="next" class="W_btn_c btn_page_next"><span><em class="W_ico12 ico_page_next"></em></span></a>'+"</span>"+'<ul class="t_ul clearfix"  node-type="categorys"></ul>'+"</div>"+'<div class="detail">'+'<ul class="faces_list faces_list_hot clearfix" node-type="hotFace"></ul>'+'<ul class="faces_list" node-type="inner"></ul>'+'<div class="W_pages_minibtn" node-type="page"></div>'+"</div>"+"</div>"+"</div></div>",f='<li class="t_itm"><a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{itemEncode}" class="t_lk S_txt1">#{item}</a></li>',g='<li class="t_itm current"><a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{itemEncode}" class="t_lk S_txt1 S_bg2">#{item}</a></li>',h='<li action-type="insert" action-data="text=#{phrase}"><img src="#{icon}" alt="#{phraseB}" title="#{phraseB}"/></li>',i='<li action-type="insert" action-data="text=#{value}"><img src="#{icon}" alt="#{phraseB}" title="#{phraseB}"/></li>',j='<li><a action-type="insert" action-data="text=#{value}" class="img" href="javascript:void(0);"><img src="#{icon}" alt="#{phrase}" title="#{phrase}"/></a><a title="表情预览" href="javascript:void(0);" action-type="play" action-data="swf=#{swf}"><span class="W_ico16 icon_toplay"></span></a><span>#{phrase}</span></li>',k='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" class="page S_bg1" onclick="return false;">#{label}</a>',l='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" class="page S_txt1" onclick="return false;">#{label}</a>',m='<div class="W_loading"><span>正在加载，请稍候...</span></div>',n='<li class="clear"></li>',o="",p=5,q="默认",r,s,t,u,v,w;w={};var x=window.encodeURIComponent,y=window.decodeURIComponent,z=function(a,b,c){for(var d=0;b[d];d++)a[b[d]]&&(a[b[d]].style.display="");for(var d=0;c[d];d++)a[c[d]]&&(a[c[d]].style.display="none")},A=function(b){var c=b.cPoniter,d=b.categorys,e=y(b.currentCategory),h=d.slice(c,c+p);h=a.foreach(h,function(b,c){return e===b?a.templet(g,{item:b,itemEncode:x(b)}):a.templet(f,{item:b,itemEncode:x(b)})});s.categorys.innerHTML=h.join(o);c+p>=d.length?s.next.className="W_btn_c_disable btn_page_nextdis":s.next.className="W_btn_c btn_page_next";c<=0?s.prev.className="W_btn_c_disable btn_page_prevdis":s.prev.className="W_btn_c btn_page_prev"},B=function(b){var c=b.page,d=b.cache[y(b.currentCategory)],e=d.length/b.itemNumber,f=[];if(e>1)for(var g=0;g<e;g+=1)c==g?f.push(a.templet(l,{number:g,label:g+1})):f.push(a.templet(k,{number:g,label:g+1}));s.page.innerHTML=f.join("");c===0&&b===H&&y(b.currentCategory)===q?s.hotFace.style.display="":s.hotFace.style.display="none"},C={general:function(a){z(s,["categorys","hotFace","prev","next"],[]);v=H;v.init();s.general.className="pftb_lk current S_line5 S_txt1 S_bg5";s.magic.className="pftb_lk S_line5 S_txt1 S_bg1";s.brand&&(s.brand.className="pftb_lk S_line5 S_txt1 S_bg1");s.inner.className="faces_list clearfix"},magic:function(a){z(s,["categorys","hotFace","prev","next"],[]);v=I;v.init();s.general.className="pftb_lk S_line5 S_txt1 S_bg1";s.magic.className="pftb_lk current S_line5 S_txt1 S_bg5";s.brand&&(s.brand.className="pftb_lk S_line5 S_txt1 S_bg1");s.inner.className="faces_magic_list"},brand:function(a){z(s,[],["categorys","hotFace","prev","next"]);v=c;v.init();s.general.className="pftb_lk S_line5 S_txt1 S_bg1";s.magic.className="pftb_lk S_line5 S_txt1 S_bg1";s.brand&&(s.brand.className="pftb_lk current S_line5 S_txt1 S_bg5");s.inner.className="faces_list clearfix"}},D={category:function(a){v.page=0;v.currentCategory=a.data.category;v.rend();setTimeout(function(){A(v);B(v)},0)},prev:function(a){var b=v.cPoniter,c=v.categorys;if(b<=0)return!1;v.cPoniter-=p;A(v)},next:function(a){var b=v.cPoniter,c=v.categorys;if(b>=c.length-p)return!1;v.cPoniter+=p;A(v)},play:function(b){t.stopBoxClose();a.common.magic(b.data.swf,function(){t.startBoxClose()})},insert:function(b){a.custEvent.fire(w,"insert",{value:b.data.text})},page:function(a){v.page=parseInt(a.data.num,10);v.rend();setTimeout(function(){B(v)},0)}},E=function(b){t=a.ui.bubble();F();G();C[b]();a.custEvent.add(t,"hide",function(b){return function(){a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(w,"hide",{})}}(t))},F=function(){r=a.ui.mod.layer(e);s={};var b=r.getDomList();for(var c in b)s[c]=b[c][0];F=function(){t.setContent(s.outer)};F()},G=function(){a.custEvent.define(w,"insert");a.custEvent.define(w,"hide");a.addEvent(s.general,"click",C.general);a.addEvent(s.magic,"click",C.magic);s.brand&&a.addEvent(s.brand,"click",C.brand);u=a.core.evt.delegatedEvent(s.outer);u.add("category","click",D.category);u.add("prev","click",D.prev);u.add("next","click",D.next);u.add("insert","click",D.insert);u.add("play","click",D.play);u.add("page","click",D.page);G=function(){}},H={init:function(){s.inner.innerHTML=m;a.common.trans.editor.getTrans("face",{onSuccess:function(b,c){H.cache=b.data.more||{};try{H.hotList=b.data.usual.hot.slice(0,12);s.hotFace.innerHTML=a.foreach(H.hotList,function(b,c){b.phraseB=b.phrase.slice(1,-1);return a.templet(h,b)}).join("")}catch(d){}H.categorys=[q];for(var e in H.cache)H.categorys.push(e);H.cache[q]=b.data.usual.norm;H.init=function(){H.page=0;H.cPoniter=0;H.currentCategory=q;H.rend();A(H);B(H)};H.init()},onError:function(a,b){}}).request({})},rend:function(){var b=H.currentCategory,c=H.cache[y(b)],d=H.page,e=H.itemNumber;c=c.slice(d*e,d*e+e);c=a.foreach(c,function(b,c){b.phraseB=b.phrase.slice(1,-1);return a.templet(h,b)});s.inner.innerHTML=c.join("")},page:0,cache:null,hotList:null,cPoniter:0,categorys:[],currentCategory:q,itemNumber:72},I={init:function(){s.inner.innerHTML=m;s.hotFace.style.display="none";a.common.trans.editor.getTrans("magicFace",{onSuccess:function(a,b){I.cache=a.data.more||{};I.categorys=[q];for(var c in I.cache)I.categorys.push(c);I.cache[q]=a.data.usual.norm;I.init=function(){I.page=0;I.cPoniter=0;I.currentCategory=q;I.rend();A(I);B(I)};I.init()},onError:function(a,b){}}).request({type:"ani"})},rend:function(b,c){var d=I.currentCategory,e=I.cache[y(d)],f=I.page,g=I.itemNumber;e=e.slice(f*g,f*g+g);e=a.foreach(e,function(b,c){b.swf=b.icon.slice(0,-4)+".swf";return a.templet(j,b)});e.push(n);s.inner.innerHTML=e.join("")},page:0,cache:null,cPoniter:0,categorys:[],currentCategory:q,itemNumber:12};w.getBub=function(){return t};return function(b,c){if(!a.isNode(b))throw"common.bubble.face need el as first parameter!";E("general");if(c.useAlign){c.fail=function(){t.setLayout(b,{offsetX:-29,offsetY:5})};t.setAlignPos(b,c.refer,c)}else t.setLayout(b,{offsetX:-29,offsetY:5});t.show();return w}});
STK.register("common.editor.widget.face",function(a){return function(b){var c={},d,e,f,g;g=a.parseParam({t:0,l:-15,useAlign:!1},b);var h=function(a,b){d.API.insertText(b.value);e.getBub().hide()},i=function(){a.core.evt.preventDefault();g.refer=d.nodeList.textEl;e=a.common.bubble.face(d.nodeList[f],g);a.custEvent.add(e,"insert",h);a.custEvent.fire(c,"show",e);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"insert",h);a.custEvent.fire(c,"hide",e)})};c.init=function(b,e,g){d=b;f=e;a.addEvent(b.nodeList[f],"click",i);a.custEvent.define(c,"show");a.custEvent.define(c,"hide")};c.clear=function(){};c.show=function(){};c.hide=function(){};c.destroy=function(){d=null;a.custEvent.undefine(c)};return c}});
STK.register("common.content.message.upload.start",function(a){var b=a.kit.extra.language;return function(b,c,d){var e=c,c=a.core.str.bLength(c)>20?a.core.str.leftB(c,20)+"...":c;a.log("[common.content.message.upload.start]: swf",a.sizzle("[swfid="+b+"]"),d);var f='<li node-type="li_'+d+'"><p class="W_loading"><span>'+c+'&nbsp;&nbsp;上传中... <a href="javascript:void(0);" token="'+d+'" node-type="cancelUpload" action-type="cancelUpload" action-data="swfId='+b+'">取消上传</a></span></p></li>',g=a.sizzle("[swfid="+b+"]")[0];g.style.display="block";g.innerHTML+=f}});
STK.register("common.channel.flashUpImg",function(a){var b=["initFun","changeFlashHeightFun","uploadCompleteFun","closePhotoEditorFun","cannelUpload","completeUpload"];return a.common.listener.define("common.channel.flashUpImg",b)});
STK.register("common.content.message.upload.complete",function(a){return function(b,c,d,e){var f,g,h,i=a.common.content.message.upload.getExt(d),j=d,d=a.core.str.bLength(d)>20?a.core.str.leftB(d,20)+"...":d;if(typeof e=="object"){f=e;g=STK.core.json.jsonToQuery(f)}else if(typeof e=="string"){g=e;f=STK.core.json.strToJson(e)}e.thumbnail?h='<img src="'+e.thumbnail+'" class="img" alt="图片" title="'+j+'">'+d+'<span class="func"><a class="S_link2 del" href="javascript:void(0)" node-type="deleteFile" action-type="deleteFile" action-data="swfId='+b+"&"+g+'">删除</a></span>':h='<i><img src="'+$CONFIG.imgPath+"style/images/accessory/"+i+'.png" class="doc" alt="附件文件" title="'+j+'"></i>'+d+'<span class="func"><a class="S_link2 del" href="javascript:void(0)" node-type="deleteFile" action-type="deleteFile" action-data="swfId='+b+"&"+g+'">删除</a></span>';var k=a.sizzle('li[node-type="li_'+c+'"]')[0];k.innerHTML=h;var l=k.parentNode.getAttribute("fid")||"";k.parentNode.setAttribute("fid",l+f.fid+",");a.common.channel.flashUpImg.fire("completeUpload")}});
STK.register("common.content.message.upload.showMsg",function(a){return function(a){STK.ui.alert(a)}});
STK.register("kit.dom.dir",function(a){return function(b,c){c=a.parseParam({dir:"parentNode",expr:undefined,endpoint:document,maxLength:1},c);var d=c.dir,e=c.expr,f=c.endpoint,g=c.maxLength;if(!b||!e)a.log("kit dir: node or opts.expr is undefined.");else{var h=[],i=b[d];while(i){if(i.nodeType==1&&a.sizzle(e,null,null,[i]).length>0){h.push(i);if(h.length==g)break}if(i==f)break;i=i[d]}return h}}});
STK.register("kit.dom.parents",function(a){return function(b,c){c=a.parseParam({expr:undefined,endpoint:document,maxLength:1},c);var d=c.expr;if(!b||!d)a.log("kit parents: node or opts.expr is undefined.");else return a.kit.dom.dir(b,c)}});
STK.register("common.content.message.upload.deleteItem",function(a){return function(b,c,d){var e;e=b;if(b.tagName!="LI")var f=a.kit.dom.parents(b,{expr:"li"}),e=f[0];var g=e.parentNode;a.removeNode(e);if(g.tagName=="UL"){a.sizzle("li",g).length==0&&(g.style.display="none");if(c=="delete"){var h=d.fid,i=g.getAttribute("fid"),j=i.replace(h+",","");g.setAttribute("fid",j)}}}});
STK.register("kit.extra.runFlashMethod",function(a){return function(a,b,c){var d,e,f,g=function(){if(a[b]){e=!0;clearTimeout(d);try{a.TotalFrames()}catch(h){a.TotalFrames}c()}else f=setTimeout(g,100)};g();d=setTimeout(function(){e||clearTimeout(f)},1e4);return{destroy:function(){clearTimeout(d);clearTimeout(f)}}}});
STK.register("common.content.message.upload.getFlash",function(a){return function(b){return a.sizzle('[flashobj="'+b+'"]')[0]}});
STK.register("common.content.message.upload.cancel",function(a){return function(b,c){a.log("cancelUpload",b,c);var d=a.sizzle('li[node-type="li_'+c+'"]')[0];a.common.content.message.upload.deleteItem(d,"cancel");a.common.channel.flashUpImg.fire("cannelUpload");var e=a.common.content.message.upload.getFlash(b);a.kit.extra.runFlashMethod(e,"cancelUpload",function(){try{e.cancelUpload(c)}catch(a){}})}});
STK.register("kit.extra.getFlashVersion",function(a){return function(){var a="1",b=navigator;if(b.plugins&&b.plugins.length){for(var c=0;c<b.plugins.length;c++)if(b.plugins[c]&&b.plugins[c].name&&b.plugins[c].name.indexOf("Shockwave Flash")!=-1){a=b.plugins[c].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var c=10;c>=2;c--)try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);if(d){a=c+".0";break}}catch(e){}return parseInt(a.split(".")[0])}});
STK.register("kit.extra.installFlash",function(a){var b=a.kit.extra.language;return function(c){c=a.parseParam({onHide:a.funcEmpty},c);var d='<div class="layer_version_upgrade"><dl class="point clearfix"><dt><span class="icon_versionup"></span></dt><dd><p class="S_txt1">#L{你的Flash版本过低，请安装更高版本的Flash插件后，再刷新页面重试}</p></dd></dl><div class="versionup_btn"><a class="btn_l" href="http://get.adobe.com/cn/flashplayer/" target="_blank"><img width="16" height="16" class="icon_install" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{安装更新}</span></a><a class="btn_r" href="javascript:void(0);" onclick="window.location.reload()">'+' <img width="16" height="16" class="icon_refreshpage" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{刷新页面}</span></a></div>'+"</div>";a.kit.io.cssLoader("style/css/module/layer/layer_version_upgrade.css","js_style_css_module_layer_layer_version_upgrade",function(){var e=a.ui.dialog();e.setTitle(b("#L{提示}"));var f=a.C("div");f.innerHTML=b(d);e.appendChild(f);f=null;e.show();e.setMiddle();a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);setTimeout(function(){c.onHide()},0)})})}});
STK.register("module.getLang",function(a){return function(a,b){return $CONFIG.lang}});STK.register("common.content.message.upload.loadSwf",function(a){return function(b,c){var d=parseInt(Math.random()*1e4,10),e={width:"110",height:"16",paras:{allowScriptAccess:"always",wmode:"transparent"},flashvars:{space:"17",maxNum:10,width:"18",height:"15",swfid:d,maxSize:52428800,iExt:"*.jpg; *.gif; *.jpeg; *.png",fExt:"",domain:"http://"+document.domain}},f=c&&c.flashvars;if(f)for(var g in f)e.flashvars[g]=f[g];a.log("parrentDom",b,STK.sizzle('[node-type="uploadSwf"]',b));var h=function(){a.kit.extra.installFlash()};if(a.kit.extra.getFlashVersion()>=10){var i=STK.core.util.swf.create(STK.sizzle('[node-type="uploadSwf"]',b)[0],$CONFIG.jsPath+"home/static/swf/upload.swf?ver="+$CONFIG.version,e);i.setAttribute("flashObj",d);i.flashObj=d;a.sizzle('[node-type="uploadList"]',b)[0].setAttribute("swfid",d)}else{var j=STK.sizzle('[node-type="uploadSwf"]',b)[0];j.style.cssText="background:#000;filter:alpha(opacity=0)9;opacity:0;width:110px;";a.addEvent(j,"click",h)}return d}});
STK.register("common.extra.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},d),f=e.start.split(""),g=e.color.split(""),h=[];for(var i=0;i<e.step;i+=1){var j=f[0];for(var k=1;k<e.length;k+=1){var l=parseInt(f[k],16),m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e.step,10)).toString(16)}h.push(j)}for(var i=0;i<e.times;i+=1)h=b(h);var n=!1,o=a.timer.add(function(){if(!h.length)a.timer.remove(o);else{if(n){n=!1;return}n=!0;c.style.backgroundColor=h.pop()}})}});
STK.register("common.content.message.upload.delegateEvt",function(a){var b=a.kit.extra.language;return function(b){var b=b,c={},d=function(b){a.log("cancelUpload",b);var c=b.el,d=b.data,e=c.getAttribute("token"),f=d.swfId;a.common.content.message.upload.deleteItem(c,"cancel",d);var g=a.common.content.message.upload.getFlash(f);a.kit.extra.runFlashMethod(g,"cancelUpload",function(){try{g.cancelUpload(e)}catch(a){}});a.common.channel.flashUpImg.fire("cannelUpload");return!1},e=function(b){var c=b.el,d=b.data,e=d.swfId;a.log(e);a.common.content.message.upload.deleteItem(c,"delete",d);if(d.size){var f=a.common.content.message.upload.getFlash(e);a.kit.extra.runFlashMethod(f,"afterDelete",function(){f.afterDelete(d.size)})}return!1},f=function(){var c=a.kit.dom.parseDOM(a.core.dom.builder(b.parentNode).list);c.uploadList.setAttribute("fid","");c.uploadList.innerHTML="";c.uploadList.style.display="none"},g=a.core.evt.delegatedEvent(b);g.add("cancelUpload","click",d);g.add("deleteFile","click",e);c.reset=f;return c}});
STK.register("common.dialog.sendMessageMain",function(a){var b=a.kit.extra.language,c,d=b("#L{请输入对方昵称}"),e=[d],f=function(a,c){c=="normal"?a.innerHTML=b("#L{发送}"):a.innerHTML=b("#L{提交中...}")};return function(g){var h={};g=g||{};var i,j,k,l,m=0,n=!1,o=!1,p=!1,q=g.touid||0,r=g.style_id||1,s=a.common.dialog.validateCode();a.log("common.dialog.sendMessage data=",g);var t;if(g&&g.mid){t="forward";a.log("initialize message layer",g);var u=g.mid,v=g.is_send}var w=t=="forward"?b("#L{转发私信}"):b("#L{发私信}"),x,y={enableSubmit:function(){B.DOM.submit.isSending=!1;B.DOM.submit.className="W_btn_d btn_noloading";f(B.DOM.btnText,"normal")},disableSubmit:function(){B.DOM.submit.isSending=!0;B.DOM.submit.className="W_btn_a_disable";f(B.DOM.btnText,"loading")},isSending:function(){return B.DOM.submit.isSending}},z=function(){c&&y.enableSubmit()},A=function(){if(c){var b=B.DOM.uploadList.getAttribute("swfid"),d=a.common.content.message.upload.getFlash(b),e=1;if(d&&d.getUploadStatus)try{e=d.getUploadStatus()}catch(f){e=d.getUploadStatus}else e=0;e==0&&window.setTimeout(function(){var b=B.DOM.uploadList.getAttribute("fid")||"";b.length!=0&&(b=b.substring(0,b.length-1));c.fids=b;c=a.common.getDiss(c,B.DOM.submit);B.createTrans.request(c)},0)}},B={DOM:{},objs:{},isShowed:!1,DOM_eventFun:{submitsendMessage:function(b){if(!y.isSending()){if(!n){a.common.extra.shine(i.nodeList.textEl);return}if(a.trim(B.DOM.screen_name.value)==d||a.trim(B.DOM.screen_name.value).length==0){a.ui.alert(d);return}a.log("common.dialog.sendMessage send Message");var e=B.DOM.uploadList.getAttribute("fid")||"";e.length!=0&&(e=e.substring(0,e.length-1));var f={text:i.API.getWords(),screen_name:B.DOM.screen_name.value,id:m,fids:e,touid:q,style_id:r};y.disableSubmit();try{B.DOM.textEl.blur()}catch(g){}c=f;A();a.preventDefault();o=!0}},attachDel:function(){a.log("common.dialog.sendMessage attach del")},initLayer:function(){B.dialogDom.innerHTML="";B.dialogDom.appendChild(B.getDialogHTMLOfsendMessage(g));i=a.common.editor.base(B.dialogDom,{limitNum:300});i.widget(a.common.editor.widget.face(),"smileyBtn");t=="forward"&&a.common.trans.message.getTrans("getDetail",{onSuccess:function(b){i.API.insertText(b.data.content);m=b.data.status_id;var c=0,d=0;for(var e=0,f=b.data.fids.length;e<f;e++)try{a.common.content.message.upload.addItem(B.DOM.uploadList,b.data.fids[e].file_name,b.data.fids[e]);c+=b.data.fids[e].size*1;d+=1}catch(g){}a.log("We had "+d+" files and total file size is ",c);var h=B.DOM.uploadList.getAttribute("swfid"),j=a.common.content.message.upload.getFlash(h);x=a.kit.extra.runFlashMethod(j,"setInitSize",function(){j.setInitSize(d,c)});a.log("setInitSize Done")},onError:function(b){a.ui.alert(b.msg)}}).request({mid:u,is_send:v});k=new a.common.bubble.myFollowSuggest({type:1,textNode:B.DOM.screen_name,list_template:"",callback:function(){}});k.show();var b=a.kit.dom.smartInput(B.DOM.screen_name,{notice:d});a.addEvent(B.DOM.textEl,"focus",function(){j=setInterval(function(){B.custFuns.publishBtn()},200)});a.addEvent(B.DOM.textEl,"blur",function(){clearInterval(j)});setTimeout(function(){a.common.content.message.upload.delegateEvt(B.DOM.uploadList)},100)}},ioEvent:{createSuccess:function(d){a.log("common.dialog.sendMessage createSuccess");c=null;y.enableSubmit();B.actHide();a.ui.litePrompt(b("#L{恭喜，私信发送成功啦。}"),{type:"succM",timeout:"500",hideCallback:function(){a.common.channel.message.fire("create",d.data)}})},createError:function(b){c=null;a.log("common.dialog.sendMessage createError");y.enableSubmit();a.common.layer.ioError(b.code,b)},createFail:function(){a.log("common.dialog.sendMessage createFail");c=null;y.enableSubmit()}},custFuns:{publishBtn:function(){var a=i.API.getWords(),b=i.API.count(a),c=b<=300&&b>0?!0:!1;!c||a.length===0?n=!1:n=!0},filterWords:function(){var a=i.API.getWords();for(var b=0,c=e.length;b<c;b++)var d=a.replace(new RegExp(e[b],"g"),"");return d},checkContent:function(){return B.DOM.uploadList.getAttribute("fid").length!=0?!0:!1}},show:function(){var b=arguments.callee;if(B.isShowed!==!0){b.toDispatchDefaultAct=!0;a.custEvent.fire(h,"showBefore");if(b.toDispatchDefaultAct){a.log("common.dialog.sendMessage => actShow()");B.actShow()}a.custEvent.fire(h,"show")}},hide:function(){var b=arguments.callee;if(B.isShowed===!0){b.toDispatchDefaultAct=!0;a.custEvent.fire(h,"hideBefore");if(b.toDispatchDefaultAct){a.log("common.dialog.sendMessage => actHide()");B.actHide()}a.custEvent.fire(h,"hide")}},actShow:function(){if(g&&g.allowForward&&g.allowForward==0)a.ui.alert(b("#L{不能转发此条私信。}"));else{B.objs.dialog=a.ui.dialog();B.objs.dialog.setTitle(b("#L{"+w+"}"));B.objs.dialog.appendChild(B.dialogDom);B.objs.dialog.show();B.DOM_eventFun.initLayer();B.loadSwf();B.objs.dialog.setMiddle();i.API.focus();B.objs.dialog.setBeforeHideFn(function(){p=!0;if(B.custFuns.checkContent()&&o!=!0){a.ui.confirm(b("#L{你的私信尚未发送，确定要丢弃该条私信吗}?"),{OK:function(){B.objs.dialog.hide(!0);p=!1;B.objs.dialog.clearBeforeHideFn()},cancel:function(){return!0}});return!1}B.DOM.screen_name.blur();B.DOM.textEl.blur();B.DOM.submit.focus();k.hide();k.destroy();return!0})}},actHide:function(){B.objs.dialog.hide()},reset:function(){B.DOM.screen_name.value=d;i.API.reset()},loadSwf:function(){a.common.content.message.upload.loadSwf(B.DOM.uploadTd,{flashvars:{space:"17",width:"18",height:"15"}})},getDialogHTMLOfsendMessage:function(c){var e,f,g=c&&c.userName?c.userName:d;if(c&&c.uid){if(!c.userName)throw new Error("未得到收信人昵称。Cannot retrieve nickname.");e=c.userName+'<input type="hidden" name="'+g+'" value="'+c.uid+'" />'}else e='<input type="text" name="'+g+'" />';c&&(f=c.content||"");var h='<div class="W_private_letter" node-type="outer"><table class="form_private">  <tbody><tr>    <th>#L{发&nbsp;&nbsp;给：}</th>    <td><input node-type="screen_name" type="text" value="'+g+'" class="text"></td>'+"  </tr>"+"  <tr>"+"    <th>#L{内&nbsp;&nbsp;容：}</th>"+'    <td node-type="uploadTd">'+'<p class="num" node-type="num">#L{还可以输入%s字}</p>'+'<textarea class="W_no_outline" name="" node-type="textEl">'+f+'</textarea><div node-type="successTip" style="display: none;" class="send_succpic"></div>'+'      <div class="kind fl" node-type="widget">'+'<a node-type="smileyBtn" onclick="return false;" href="javascript:void(0);" title="表情" class="W_ico16 ico_faces"></a>'+'<a node-type="picBtn" onclick="return false;" href="javascript:void(0);" title="图片" class="W_ico16 icon_sw_img"></a>'+'<a node-type="attachBtn" onclick="return false;" href="#" title="文件" class="W_ico16 icon_sw_accessory"></a>'+'<div id="uploadSwf" node-type="uploadSwf" class="flash" style="background:#000;filter:alpha(opacity=0)9;opacity:0;"></div></div>'+'      <div class="btn_s fr"><a class="W_btn_b btn_noloading" href="javascript:void(0);" diss-data="module=msglayout" node-type="submit" action-type="submit"><span><b class="loading"></b><em node-type="btnText">#L{发送}</em></span></a></div>'+'      <ul class="p_sendlist" node-type="uploadList" style="display:none" fid=""></ul>'+"    </td>"+"  </tr>"+"</tbody></table>"+"</div>",i=a.builder(b(h,"<span>300</span>"));B.DOM=a.kit.dom.parseDOM(i.list);return i.box}},C=function(){D();E();F();G();H();I()},D=function(){},E=function(){},F=function(){B.dialogDom=a.C("div");B.DEvent=a.core.evt.delegatedEvent(B.dialogDom);B.createTrans=a.common.trans.message.getTrans("create",{onComplete:function(a,b){var c={onSuccess:B.ioEvent.createSuccess,onError:B.ioEvent.createError,requestAjax:B.createTrans,param:b,onRelease:function(){y.enableSubmit()}};s.validateIntercept(a,b,c)},onFail:B.ioEvent.createFail})},G=function(){B.DEvent.add("submit","click",B.DOM_eventFun.submitsendMessage);B.DEvent.add("attachDel","click",B.DOM_eventFun.attachDel);B.DEvent.add("attachCancel","click",B.DOM_eventFun.attachCancel);a.core.evt.hotKey.add(B.dialogDom,["ctrl+enter"],B.DOM_eventFun.submitsendMessage)},H=function(){a.custEvent.define(h,"showBefore");a.custEvent.define(h,"show");a.custEvent.define(h,"hideBefore");a.custEvent.define(h,"hide")},I=function(){a.common.channel.flashUpImg.register("completeUpload",A);a.common.channel.flashUpImg.register("cannelUpload",z)},J=function(){c=null;if(B.objs.dialog){B.objs.dialog.hide();B.objs.dialog.clearBeforeHideFn()}B.DOM.dialog=null;x&&x.destroy&&x.destroy()};C();h.destroy=J;h.show=function(){B.show.apply(B,arguments)};h.hide=function(){B.hide()};return h}});
STK.register("common.dialog.sendMessage",function(a){var b=a.common.depand.asynSendMsg;return function(b){var c={},d,e=function(){d=a.common.dialog.sendMessageMain(b);d.show()};c.show=function(){a.preventDefault();e()};c.hide=function(){d&&d.hide()};c.destroy=function(){d&&d.destroy()};c.originShow=e;return c}});
STK.register("common.relation.groupSelector",function(a){var b=16,c=a.kit.extra.language,d=$CONFIG.imgPath+"style/images/common/transparent.gif",e=$CONFIG.miyou=="1";return function(f){var g='<div node-type="outer" style="position:absolute;display:none;overflow-x:hidden;" class="layer_menu_list"><ul node-type="closeFriend" '+(e?"":'style="display:none;"')+">"+'<li class="notetxt">'+'<label class="W_fb" for="groupSelector_clsFrd">'+'<input action-type="cfSelect" node-type="cfSelect" type="checkbox" name="clsfrd" class="W_checkbox" value="closeFriend" id="groupSelector_clsFrd">'+'密友圈<i class="i_conn_close_friend"></i>'+"</label>"+'<p node-type="cfWaiting" style="display:none;" class="edit_followlist">邀请等待批准中</p>'+"</li>"+"</ul>"+'<ul node-type="inner"></ul>'+'<ul node-type="addBar">'+'<li class="line"></li>'+'<li class="opt"><a href="javascript:;" action-type="addGroup">'+'<img width="11" height="11" title="#L{创建分组}" class="iconadd" src="'+d+'">#L{创建分组}</a>'+"</li>"+"</ul>"+'<div node-type="quickForm" style="display:none;" class="quick_form">'+'<p class="row">'+'<input style="color:#939393;" node-type="groupName" defVal="#L{新分组}" value="#L{新分组}" type="text" class="W_input">'+"</p>"+'<div node-type="errMsg" style="display:none;" class="S_error"></div>'+'<p class="row btns">'+'<a action-type="submit" class="W_btn_b" href="javascript:;"><span>#L{保存}</span></a>'+'<a action-type="cancel" class="W_btn_b" href="javascript:;"><span>#L{取消}</span></a>'+"</p>"+"</div>"+"</div>",h=a.core.util.easyTemplate('<#et listItem gList><#list gList as item><li class="notetxt"><label for="${gList.ukey}_${item.gid}"><#if (item.belong==1)><input action-type="select" checked id="${gList.ukey}_${item.gid}" value="${item.gid}" type="checkbox" class="W_checkbox" name="gid">${item.gname}<#else><input action-type="select" id="${gList.ukey}_${item.gid}" value="${item.gid}" type="checkbox" class="W_checkbox" name="gid">${item.gname}</#if></label><i title="'+c("#L{为此分组成员添加说明}")+'" action-type="descIcon" class="icon_edit_s" <#if (item.belong==1)><#else>style="display:none;"</#if>></i>'+'<p class="edit_followlist" style="display:none;"><a action-type="descText" href="javascript:;"></a></p>'+"</li>"+"</#list>"+"</#et>"),i={cfSuc_1:c("#L{密友邀请已经发送，请等待对方接受}"),cfSuc_2:c("#L{你已经成功添加对方为密友，你们彼此已经是密友啦}"),cfSucTit_1:c("#L{需要对方通过邀请才能加为密友}")},j={},k=a.core.dom.builder(c(g)),l=a.kit.dom.parseDOM(k.list),m=a.core.evt.delegatedEvent(l.outer),n=f,o=l.groupName.getAttribute("defVal"),p=a.common.relation.closeFriend,q=a.getUniqueKey(),r,s,t,u,v;l.addBar.style.display=n.length<20?"":"none";var w='<p class="edit_followlist" style="display:none;"><input action-type="descInput" class="W_input" type="text"></p>',x={},y=function(a,b,c){if(!!a){c&&(c=c.toUpperCase());var d=a[b];while(d){if(d.nodeType==1&&(c?d.nodeName==c:!0))break;d=d[b]}return d}},z={check:function(a){if(!a||a===o)return c("#L{请输入分组名称}");for(var b=n.length;b--;)if(n[b].gname===a)return c("#L{此分组名已存在}");return!1},show:function(a){l.errMsg.innerHTML=a;l.errMsg.style.display=""},hide:function(){l.errMsg.innerHTML="";l.errMsg.style.display="none"}},A={show:function(){z.hide();l.groupName.value=o;l.addBar.style.display="none";l.quickForm.style.display="";l.groupName.focus()},hide:function(){setTimeout(function(){l.addBar.style.display=n.length<20?"":"none";l.quickForm.style.display="none"},b)}},B={addGroupSuccess:function(a,b){var c=a.data;for(var d in c)if(c[d].belong===1){j.add(c[d]);C.request({gid:c[d].gid,fuid:r,action:"add"});typeof v=="function"&&v(c[d],b);break}A.hide()},setGroupSuccess:function(a,b){for(var c=n.length;c--;)if(n[c].gid===b.gid){n[c].belong=b.action==="add"?"1":"0";break}typeof u=="function"&&u(a,b)},errorCd:function(b,c){if(b.code=="100096"||b.code=="100097"||b.code=="100098"){j.hide();var d=a.common.layer.vipError(b.code,{info:b.data.html,lbtnFunc:function(){location.href=b.data.gurl}})}else b&&b.msg&&a.ui.alert(b.msg)}},C=a.common.trans.group.getTrans("groupupdate",{onSuccess:B.setGroupSuccess,onError:B.errorCd,onFail:B.errorCd}),D=a.common.trans.group.getTrans("add",{onSuccess:B.addGroupSuccess,onError:B.errorCd,onFail:B.errorCd}),E=function(a){a.ukey=q;return h(a).toString()},F=function(b){if(!b.input){a.insertHTML(b.icon,w,"afterend");b.input=a.sizzle('input[action-type="descInput"]',b.icon.parentNode)[0]}},G=function(b){var c=y(b,"parentNode","li");if(!!c){var d=a.sizzle('input[action-type="select"]',c)[0];if(!x[d.id]){x[d.id]={};var e=x[d.id];e.gid=d.value;e.icon=a.sizzle('>i[action-type="descIcon"]',c)[0];e.input=a.sizzle('input[action-type="descInput"]',c)[0];e.text=a.sizzle('a[action-type="descText"]',c)[0]}return x[d.id]}},H=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},I=function(b){var c=a.fixEvent(b).target;a.bLength(c.value)>16&&(c.value=a.leftB(c.value,16))},J=function(b){if(b.keyCode===13){var c=a.fixEvent(b).target;a.fireEvent(c,"blur")}},K=function(b,c,d){var e,f=G(b);F(f);if(!!f)if(c){f.input.parentNode.style.display="";f.text.parentNode.style.display="none";f.icon.style.display="none";e=d||f.text.innerHTML;e?f.input.value=a.decodeHTML(e):f.input.value="";f.input.select();a.addEvent(f.input,"blur",N.descInputBlur);a.addEvent(f.input,"keyup",I);a.addEvent(f.input,"keypress",J)}else{e=a.trim(f.input.value);if(e){var g=function(b){b&&b.msg&&a.ui.alert(b.msg);f.text.innerHTML="";f.icon.style.display="";f.input.parentNode.style.display="none";f.text.parentNode.style.display="none"};a.common.trans.group.request("editdesc",{onSuccess:function(){f.text.innerHTML=H(e);f.input.parentNode.style.display="none";f.text.parentNode.style.display="";f.icon.style.display=""},onError:g,onFail:g},{gid:f.gid,uid:r,desc:encodeURIComponent(e)})}else{f.text.innerHTML="";f.icon.style.display="";f.input.parentNode.style.display="none";f.text.parentNode.style.display="none"}a.removeEvent(f.input,"blur",N.descInputBlur);a.removeEvent(f.input,"keyup",I);a.removeEvent(f.input,"keypress",J)}},L=function(a){a.icon.style.display="none";a.input&&(a.input.parentNode.style.display="none");a.text.parentNode.style.display="none"},M=function(a,b,c){if(a.value!=="closeFriend"){var d=G(a);if(!d)return;if(b){d.icon.style.display="";if(c){d.text.parentNode.style.display="";d.text.innerHTML=H(c)}else d.text.innerHTML=""}else L(d)}},N={addGroup:function(a){A.show()},setGroup:function(a){},descInputBlur:function(b){var c=a.fixEvent(b).target;K(c,!1)},setDesc:function(b){var c=G(b.el),d=function(a,c){var d=a&&a.data||[];for(var e=d.length;e--;)if(d[e].uid===r){K(b.el,!0,d[e].group_description);break}};a.common.trans.group.request("getGroupDesc",{onSuccess:d,onError:d,onFail:d},{uid:r,gid:c.gid})},submit:function(b){var c=a.trim(l.groupName.value),d=z.check(c);if(d)return z.show(d);D.request({name:c})},cancel:function(a){A.hide()},select:function(a){var b=a.el,c=b.checked;C.request({gid:b.value,fuid:r,action:c?"add":"delete"});M(b,c)},focus:function(b){b=a.fixEvent(b);var c=b.target,d=a.trim(c.value);d===o&&(c.value="")},blur:function(b){b=a.fixEvent(b);var c=b.target,d=a.trim(c.value);d||(c.value=o)},cfSelect:function(b){var c=l.cfSelect.checked?"add":"remove",d=b&&b.data||{};if(c==="add")p.add({uid:r,name:s,successCb:function(b,c){c.action="add";c.gid="miyou";var d=b.data||{},e=i.cfSuc_2,f=!1,g;if(d.cftype==2){e=i.cfSuc_1;g=i.cfSucTit_1;f=!0}l.cfWaiting.style.display=f?"":"none";a.ui.timerNotice(e,{title:g,icon:"success",timer:2e3});u(b,c)}});else{p.remove({uid:r,name:s,sex:t,successCb:function(a,b){b.action="delete";b.gid="miyou";u(a,b)}});l.cfWaiting.style.display="none"}}},O=function(){m.add("addGroup","click",N.addGroup);m.add("submit","click",N.submit);m.add("cancel","click",N.cancel);m.add("select","click",N.select);m.add("descIcon","click",N.setDesc);m.add("descText","click",N.setDesc);m.add("cfSelect","click",N.cfSelect);a.addEvent(l.groupName,"focus",N.focus);a.addEvent(l.groupName,"blur",N.blur)},P=function(){document.body.appendChild(k.box);j.setContent(n);O()},Q,R,S,T=function(b){!a.core.evt.hitTest(l.outer)&&!a.core.evt.hitTest(Q)&&(R=setTimeout(function(){j.hide()},100))};j={open:!1,panel:l.outer,show:function(c){R&&clearTimeout(R);Q=(c||{}).target;u=(c||{}).setGroupCb;v=(c||{}).addGroupCb;if(!j.open){l.outer.style.display="";setTimeout(function(){a.addEvent(document.body,"click",T)},b);j.open=!0}},hide:function(){j.open=!1;l.outer.style.display="none";A.hide();setTimeout(function(){a.removeEvent(document.body,"click",T)},b)},add:function(b){n.push(b);var c=[].concat(b),d=E(c);a.insertHTML(l.inner,d,"BeforeEnd")},setTouid:function(a,b,c){r=a;s=b;t=c},setContent:function(a){n=a;var b=E(a);l.inner.innerHTML=b},setPosition:function(a){l.outer.style.top=a.t+"px";l.outer.style.left=a.l+"px"},setSelector:function(b,c,d){var e=a.sizzle("input[name=gid]",l.inner);b=b||[];c=c||[];for(var f=e.length;f--;){e[f].checked=a.core.arr.indexOf(e[f].value,b)>=0;M(e[f],e[f].checked,c[f])}if(!!l.cfSelect)switch(d||"0"){case"0":l.cfSelect.checked=!1;l.cfWaiting.style.display="none";break;case"1":l.cfSelect.checked=!0;l.cfWaiting.style.display="none";break;case"2":l.cfSelect.checked=!0;l.cfWaiting.style.display=""}},getSelector:function(){var b=[],c=a.sizzle("input[checked]",l.inner);for(var d=0,e=n.length;d<e;d++)for(var f=c.length;f--;)n[d].gid===c[f].id.split("_")[1]&&b.push(n[d]);if(!l.cfSelect.checked)return b;var g={},h=l.cfWaiting.style.display!=="none";if(h){g.gname="密友等待中";g.cftype="2"}else{g.gname="密友";g.cftype="1"}b.unshift(g);return b}};P();return j}});
STK.register("kit.extra.crc32",function(a){return function(a,b){function c(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128)b+=String.fromCharCode(d);else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b}a=c(a);var d="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D",b;typeof b=="undefined"&&(b=0);var e=0,f=0;b=b^-1;for(var g=0,h=a.length;g<h;g++){f=(b^a.charCodeAt(g))&255;e="0x"+d.substr(f*9,8);b=b>>>8^e}var i=b^-1;i<0&&(i=4294967296+i);return i}});
STK.register("common.extra.imageURL",function(a){return function(b,c){function f(a){a=(a+"").replace(/[^a-f0-9]/gi,"");return parseInt(a,16)}var d={size:"small"};if(typeof b=="string"){d=a.core.obj.parseParam(d,c);var e=d.size,g={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690",thumb180:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large",thumb180:"thumb180"}},h=b.charAt(9)=="w",i=b.charAt(21)=="g"?".gif":".jpg",j=h?a.kit.extra.crc32(b)%4+1:f(b.substr(19,2))%16+1,k="http://"+(h?"ww":"ss")+j+".sinaimg.cn/"+(h?g.ww[e]:e)+"/"+b+(h?i:"")+(h?"":g.ss[e]);return k}}});
STK.register("ui.mod.tab",function(a){return function(b,c){function u(b,c){var e={evtType:"click",tNodes:"",dNodes:"",className:"cur",addClassNames:"",removeClassNames:"",cb:function(){},defaultIdx:0};e=a.core.obj.parseParam(e,c);l=e.cb;n=e.className;p=e.defaultIdx;q=e.removeClassNames;r=e.addClassNames;m=e.evtType;j=typeof e.tNodes=="string"?a.sizzle(e.tNodes,b):e.tNodes;o=j.length;if(e.dNodes!==""){k=typeof e.dNodes=="string"?a.sizzle(e.dNodes,b):e.dNodes;t()}for(var f=0;f<o;f++)d(j[f],m,function(a){return function(){h();s(a)}}(f))}function t(){if(!g(j))throw"ui.mod.tab needs tNodes as Array!";if(!g(k))throw"ui.mod.tab needs tNodes as Array!";if(j.length!=k.length)throw"ui.mod.tab needs tNodes'length equal to dNodes'length!"}function s(a){var b=g(l)?l[a]:l,c=j[a],d=g(k)?k[a]:null,h=j[p],m=g(k)?k[p]:null;if(d){i(k[p],"display","none");i(k[a],"display","")}if(!q&&!r){f(j[p],n);e(j[a],n)}else{j[p].className=q;j[a].className=r}if(a!=p){b({idx:a,node:d});p=a}}var d=a.core.evt.addEvent,e=a.core.dom.addClassName,f=a.core.dom.removeClassName,g=a.core.arr.isArray,h=a.core.evt.preventDefault,i=a.core.dom.setStyle,j,k,l,m,n,o,p,q,r,v={};v.initView=function(a){a=a||c.defaultIdx;i(k[a],"display","");e(j[a],n);var b=g(l)?l[a]:l,d=g(k)?k[a]:null;b({idx:a,node:d});p=a};v.refresh=function(b){j[b]&&a.fireEvent(j[b],"click")};u(b,c);return v}});
STK.register("kit.extra.swfobject",function(a){var b=function(){function W(b){var c=/[\\\"<>\.;]/,d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}function V(a,b){if(!!y){var c=b?"visible":"hidden";u&&Q(a)?Q(a).style.visibility=c:U("#"+a,"visibility:"+c)}}function U(b,d,e,f){if(!z.ie||!z.mac){var g=j.getElementsByTagName("head")[0];if(!g)return;var h=e&&typeof e=="string"?e:"screen";if(f){w=null;x=null}if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css");i.setAttribute("media",h);w=g.appendChild(i);z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0&&(w=j.styleSheets[j.styleSheets.length-1]);x=h}z.ie&&z.win?w&&typeof w.addRule==c&&w.addRule(b,d):w&&typeof j.createTextNode!=a&&w.appendChild(j.createTextNode(b+" {"+d+"}"))}}function T(a){var b=z.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function S(a,b,c){a.attachEvent(b,c);p[p.length]=[a,b,c]}function R(a){return j.createElement(a)}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function P(a){var b=Q(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function O(a){var b=Q(a);if(b&&b.nodeName=="OBJECT")if(z.ie&&z.win){b.style.display="none";(function(){b.readyState==4?P(a):setTimeout(arguments.callee,10)})()}else b.parentNode.removeChild(b)}function N(a,b,c){var d=R("param");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}function M(b,d,e){var g,h=Q(e);if(z.wk&&z.wk<312)return g;if(h){typeof b.id==a&&(b.id=e);if(z.ie&&z.win){var i="";for(var j in b)b[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?d.movie=b[j]:j.toLowerCase()=="styleclass"?i+=' class="'+b[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+b[j]+'"'));var k="";for(var l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>";o[o.length]=b.id;g=Q(b.id)}else{var m=R(c);m.setAttribute("type",f);for(var n in b)b[n]!=Object.prototype[n]&&(n.toLowerCase()=="styleclass"?m.setAttribute("class",b[n]):n.toLowerCase()!="classid"&&m.setAttribute(n,b[n]));for(var p in d)d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"&&N(m,p,d[p]);h.parentNode.replaceChild(m,h);g=m}}return g}function L(a){var b=R("div");if(z.win&&z.ie)b.innerHTML=a.innerHTML;else{var d=a.getElementsByTagName(c)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++)(e[g].nodeType!=1||e[g].nodeName!="PARAM")&&e[g].nodeType!=8&&b.appendChild(e[g].cloneNode(!0))}}}return b}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(L(a),b);a.style.display="none";(function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(L(a),a)}function J(b,c,d,e){v=!0;s=e||null;t={success:!1,id:d};var f=Q(d);if(f){if(f.nodeName=="OBJECT"){q=L(f);r=null}else{q=f;r=d}b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k;if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew";l.setAttribute("id",d);f.parentNode.insertBefore(l,f);f.style.display="none";(function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)})()}M(b,c,d)}}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function H(b){var d=null,e=Q(b);if(e&&e.nodeName=="OBJECT")if(typeof e.SetVariable!=a)d=e;else{var f=e.getElementsByTagName(c)[0];f&&(d=f)}return d}function G(){var b=n.length;if(b>0)for(var c=0;c<b;c++){var d=n[c].id,e=n[c].callbackFn,f={success:!1,id:d};if(z.pv[0]>0){var g=Q(d);if(g)if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312)){V(d,!0);if(e){f.success=!0;f.ref=H(d);e(f)}}else if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall;h.width=g.getAttribute("width")||"0";h.height=g.getAttribute("height")||"0";g.getAttribute("class")&&(h.styleclass=g.getAttribute("class"));g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));J(h,i,d,e)}else{K(g);e&&e(f)}}else{V(d,!0);if(e){var m=H(d);if(m&&typeof m.SetVariable!=a){f.success=!0;f.ref=m}e(f)}}}}function F(){var b=j.getElementsByTagName("body")[0],d=R(c);d.setAttribute("type",f);var e=b.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var c=e.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");z.pv=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}else if(g<10){g++;setTimeout(arguments.callee,10);return}b.removeChild(d);e=null;G()})()}else G()}function E(){l?F():G()}function D(b){if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof j.addEventListener!=a)j.addEventListener("load",b,!1);else if(typeof i.attachEvent!=a)S(i,"onload",b);else if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c();b()}}else i.onload=b}function C(a){u?a():m[m.length]=a}function B(){if(!u){try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=!0;var c=m.length;for(var d=0;d<c;d++)m[d]()}}var a="undefined",c="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=!1,m=[E],n=[],o=[],p=[],q,r,s,t,u=!1,v=!1,w,x,y=!0,z=function(){var b=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==c){r=k.plugins[d].description;if(r&&(typeof k.mimeTypes==a||!k.mimeTypes[f]||!!k.mimeTypes[f].enabledPlugin)){l=!0;p=!1;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof i.ActiveXObject!=a)try{var s=new ActiveXObject(e);if(s){r=s.GetVariable("$version");if(r){p=!0;r=r.split(" ")[1].split(",");q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(t){}return{w3:b,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!!z.w3){(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body))&&B();if(!u){typeof j.addEventListener!=a&&j.addEventListener("DOMContentLoaded",B,!1);if(z.ie&&z.win){j.attachEvent(h,function(){if(j.readyState=="complete"){j.detachEvent(h,arguments.callee);B()}});i==top&&function(){if(!u){try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()}}()}z.wk&&function(){if(!u){if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()}}();D(B)}}}(),X=function(){z.ie&&z.win&&window.attachEvent("onunload",function(){var a=p.length;for(var c=0;c<a;c++)p[c][0].detachEvent(p[c][1],p[c][2]);var d=o.length;for(var e=0;e<d;e++)O(o[e]);for(var f in z)z[f]=null;z=null;for(var g in b)b[g]=null;b=null})}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;n[n.length]=e;V(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(z.w3)return H(a)},embedSWF:function(b,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};if(z.w3&&!(z.wk&&z.wk<312)&&b&&d&&e&&f&&g){V(d,!1);C(function(){e+="";f+="";var n={};if(k&&typeof k===c)for(var o in k)n[o]=k[o];n.data=b;n.width=e;n.height=f;var p={};if(j&&typeof j===c)for(var q in j)p[q]=j[q];if(i&&typeof i===c)for(var r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(T(g)){var s=M(n,p,d);n.id==d&&V(d,!0);m.success=!0;m.ref=s}else{if(h&&I()){n.data=h;J(n,p,d,l);return}V(d,!0)}l&&l(m)})}else l&&l(m)},switchOffAutoHideShow:function(){y=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){return z.w3?M(a,b,c):undefined},showExpressInstall:function(a,b,c,d){z.w3&&I()&&J(a,b,c,d)},removeSWF:function(a){z.w3&&O(a)},createCSS:function(a,b,c,d){z.w3&&U(a,b,c,d)},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return W(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return W(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(v){var a=Q(g);if(a&&q){a.parentNode.replaceChild(q,a);if(r){V(r,!0);z.ie&&z.win&&(q.style.display="block")}s&&s(t)}v=!1}}}}();return b});
STK.register("common.flash.imgUpload",function(a){var b=document.documentElement,c=document.body,d={getScroll:function(){var a,d,e,f;if(b&&b.scrollTop){a=b.scrollTop;d=b.scrollLeft;e=b.scrollWidth;f=b.scrollHeight}else if(c){a=c.scrollTop;d=c.scrollLeft;e=c.scrollWidth;f=c.scrollHeight}return{t:a,l:d,w:e,h:f}},getScreen:function(){var c={};if(a.IE){c.w=b.clientWidth;c.h=b.clientHeight}else{c.w=window.innerWidth;c.h=window.innerHeight}return c}},e=function(a){var b={cn:"zh_CN",tw:"zh_TW",en:"en",hk:"zh_HK"};a=a.toLowerCase();a=a.replace(/zh-/g,"");return b[a]};return function(b,f){var g={version:$CONFIG.version,swf_path:$CONFIG.jsPath+"home/static/swf/img/",service:b.service,ed_swf:b.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:b.h||385,w:b.w||528,f_version:"10.0.0",channel:b.id+"_channel",id_panel:b.id+"_panel",id_swf:b.id+"_swf"},h={},i,j,k={init:function(){f.init&&f.init(h,b)},setHeight:function(b){a.IE||(m.getFlash(g.id_swf).height=b)},upComplate:function(a){b.sucess&&b.sucess(a);i.style.display="none";h.destory()},closeEditor:function(){i.style.display="none";h.destory();f.close&&f.close(h,b)},suda:function(a){SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+a)}},l={version:g.version,userid:$CONFIG.uid,language:e($CONFIG.lang),channel:g.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"},m={init:function(){if(!!b.id){i=a.E(g.id_panel);j=a.E(g.id_swf);if(!i){i=a.C("div");i.id=g.id_panel;c.appendChild(i)}if(!j){j=a.C("div");j.id=g.id_swf;i.appendChild(j)}i.style.display="none";m.getFlash(g.id_swf)||m.build()}},checkAction:function(a,b){var c=STK.core.util.listener.list;return!!c[a]&&!!c[a][b]},bindEvt:function(a){for(var b in a)k[a[b]]&&!m.checkAction(g.channel,a[b])&&STK.core.util.listener.register(g.channel,a[b],k[a[b]])},build:function(){var c=b.baseDir?b.baseDir+"/":"",d={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:a.IE?"window":"transparent",base:g.swf_path+c},e={id:b.id};m.bindEvt(l);a.kit.extra.swfobject.embedSWF(g.swf_path+c+g.ed_swf+"?version="+g.version,g.id_swf,g.w,g.h,g.f_version,g.swf_path+g.exp_swf,l,d,e)},getFlash:function(){return a.kit.extra.swfobject.getObjectById(b.id)},setPos:function(){var c,e,f,h,j=d.getScroll(),k=d.getScreen();f=Math.round(g.h>k.h?k.h/5+j.t:(k.h-g.h)/2+j.t);h=Math.round(g.w>k.w?k.w/5+j.l:(k.w-g.w)/2+j.l);c=b.pos.t-1||f;e=b.pos.l||h;i.style.zIndex=b.zIndex||2e4;a.setStyle(i,"position","absolute");a.setStyle(i,"left",e+"px");a.setStyle(i,"top",c+"px");m.autoScroll(j.t,j.t+(c-f))},autoScroll:function(a,b,c){var d,e,f,g=8,h;g=c||g;h=a-b;e=[h];e[g]=0;f=1;for(f;f<g;f++)e[f]=h=h/2;clearInterval(d);d=setInterval(function(){e.length?window.scrollTo(0,b+e.shift()):clearInterval(d)},30)}};h.show=function(a){a&&(b.id=a);i&&(i.style.display="");m.setPos();return this};h.hide=function(){i&&(i.style.display="");return this};h.setPars=function(a){var b={imageURL:a||"",uploadURL:g.service};m.getFlash(g.id_swf).editPhoto(b);return this};h.getSwf=m.getFlash;h.destory=function(){for(var a in l)k[l[a]]&&STK.core.util.listener.remove(g.channel,l[a],k[l[a]]);i.innerHTML=""};m.init();return h}});
STK.register("kit.extra.watermark",function(a){var b={trans:null,conf:null,success:function(a,c){b.conf=a.data}},c=[];return function(d){if(typeof d=="function"){c.push(d);if(b.conf)for(var e=0;e<c.length;e++){c[e]&&c[e](b.conf);c[e]=null}else{b.trans||(b.trans=a.common.trans.editor.getTrans("waterMark",{onSuccess:function(){b.success.apply(null,arguments);for(var a=0;a<c.length;a++){c[a]&&c[a](b.conf);c[a]=null}},onError:a.funcEmpty,onFail:a.funcEmpty}));b.trans.abort();b.trans.request()}}}});
STK.register("common.flash.uploadLog",function(a){return function(){var b={},c=function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),e=window.$CONFIG,f=a.kit.extra.merge(b,{cl:d,rnd:(new Date).getTime(),uid:e?e.uid:0,referer:encodeURIComponent(location),tm:+(new Date),ip:"",t:0});f.ret=="none"&&(f.err="10003");f=a.core.json.jsonToQuery(f);f="http://stats.t.sinaimg.cn/do_not_delete/fc.html?"+f;c.setAttribute("src",f)},d=function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),e=window.$CONFIG,f=a.kit.extra.merge(b,{rnd:(new Date).getTime(),uid:e?e.uid:0,cl:d,tm:+(new Date),ip:"",t:2,sz:0});f=a.core.json.jsonToQuery(f);f="http://stats.t.sinaimg.cn/do_not_delete/fc.html?"+f;c.setAttribute("src",f)};b.sendSucc=d;b.sendError=c;b.destroy=function(){};return b}});
STK.register("kit.extra.upload",function(a){var b=a.kit.extra.language,c="ww1.sinaimg.cn/do_not_delete/fc.html?t=1";return function(c){var d={},e=window.location.href,f,g,h=a.common.flash.uploadLog();c=a.parseParam({type:"common",form:null,base64Str:"",imgName:"",uploadArgs:{},app:""},c);a.custEvent.define(d,["uploadError","uploadSucc"]);var i={base64form:null,upload:function(b){var d,e=b,h="weibo.com/",j=window.$CONFIG,k=c.type;if(k==="common")d=c.form;else if(k==="base64"){d=a.C("form");i.base64form=d;d.method="POST";var l=a.C("input");l.name="b64_data";l.type="hidden";l.value=c.base64Str;d.appendChild(l);document.body.appendChild(d)}var m={marks:1,app:"miniblog",s:"rdxt"};c.type==="common"||c.type==="base64"?m=a.kit.extra.merge({url:e.domain=="1"?h+(j&&j.watermark||j.domain):0,markpos:e.position||"",logo:e.logo||"",nick:e.nickname=="1"?"@"+(j&&j.nick):0},m):c.type==="custom"&&(m=a.kit.extra.merge(c.uploadArgs,m));k==="base64"&&(m=a.kit.extra.merge({mime:"image/jpeg",data:"base64"},m));g=new Date;f=a.core.io.ijax({url:"http://picupload.service.weibo.com/interface/pic_upload.php",form:d,abaurl:"http://"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",timeout:18e5,onComplete:i.handle,onTimeout:i.handle,args:m})},sendError:function(b){var d=new Image,f=encodeURIComponent(navigator.userAgent),g=window.$CONFIG,h=a.kit.extra.merge(b,{cl:f,rnd:(new Date).getTime(),uid:g?g.uid:0,referer:encodeURIComponent(e),tm:+(new Date),ip:"",app:c.app});h.ret=="none"&&(h.err="10003");h=a.core.json.jsonToQuery(h);h="http://ww1.sinaimg.cn/do_not_delete/fc.html?"+h;d.setAttribute("src",h)},sendSucc:function(b){var d=new Date-g,e=new Image,f=encodeURIComponent(navigator.userAgent),h=window.$CONFIG,i=a.kit.extra.merge(b,{ct:"1",rnd:(new Date).getTime(),el:d,uid:h?h.uid:0,cl:f,tm:+(new Date),ip:"",app:c.app});i=a.core.json.jsonToQuery(i);i="http://ww1.sinaimg.cn/do_not_delete/fc.html?"+i;e.setAttribute("src",i)},handle:function(e){a.removeNode(i.base64form);i.base64form=null;var f=Math.abs(e.ret);if(!e||e.ret<0){var j="";switch(f){case 1:j="#L{没有登录}";break;case 4:case 9:j="#L{请上传5M以内的JPG、GIF、PNG图片。}";break;default:j="#L{上传图片超时}"}e?h.sendError({ret:e.ret,app:"1001"}):h.sendError({ret:"none",app:"1001"});a.custEvent.fire(d,"uploadError",{code:f,msg:b(j)})}else{var k=new Date,l=function(a){return a<10?"0"+a:a},m;if(c.type==="common")m=c.imgName;else if(c.type==="base64"){var n=[k.getFullYear(),l(k.getMonth()+1),l(k.getDate()),l(k.getHours()),l(k.getMinutes()),l(k.getSeconds())].join("");m=b("#L{微博桌面截图}")+n+".jpg"}a.custEvent.fire(d,"uploadSucc",{pid:e.pid,imgName:m});var o=new Date-g;h.sendSucc({pids:e.pid,ret:e.ret,app:"1001",el:o,ct:"1"})}},init:function(){c.type==="common"||c.type==="base64"?a.kit.extra.watermark(function(a){i.upload(a)}):i.upload()},destroy:function(){a.custEvent.undefine(d);a.removeNode(i.base64form)}};i.init();d.destroy=i.destroy;d.abort=function(){if(f)try{f.abort()}catch(a){}};return d}});
STK.register("common.plugin.plugInstallState",function(a){return function(b,c,d,e){var f={},g=a.core.util.browser,h=window.navigator,i=a.IE,j=g.MOZ,k=g.OPERA,l=g.SAFARI,m=g.CHROME,n=g.Version,o=c.embedId,p=c.embedType,q=b.pluginName,r=b.activeXName;f.instance=e;var s=function(){var a;for(a=0;a<d.length;a++)if(!(d.param[a]in f.instance))break;return a<d.length-1?!1:!0};f.getInstallState=function(){if(i){var b;if(!f.instance)try{f.instance=new ActiveXObject(r);b=!0}catch(c){f.instance=null}if(f.instance){if(s())return"ieinstalled";if(!b)try{f.instance=new ActiveXObject(r)}catch(c){f.instance=null}return f.instance?s()?"ieinstalled":"ieneedUpdate":"ieneedInstall"}return"ieneedInstall"}var d=h.plugins,e;if(d&&d.length)for(var g=0,j=d.length;g<j;g++){var k=d[g];if(k&&k.name&&k.name===q){e=!0;break}}if(e){if(!f.instance){var l=a.C("embed");l.id=o;l.type=p;l.setAttribute("hidden",!0);document.body.appendChild(l);f.instance=l}return"installed"}f.instance=null;return"needInstall"};return f}});
STK.register("common.plugin.screenCapture",function(a){var b=a.core.util.browser,c=a.kit.extra.language,d=function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},e=a.IE,f=b.MOZ,g=b.OPERA,h=b.SAFARI,i=b.CHROME,j=b.Version,k="weibo_screen_grab_download",l={pluginName:"npScreenGrab Plugin",activeXName:"ScreenGrab.ScreenGrabCom.1"},m={embedId:"weibo_screen_grab_embed",embedType:"application/x-screengrab-sina"},n={param1:"OnGrapContent",param2:"CloseScreenGrabCtrlWnd",param3:"onmsgfireevent"},o,p={spec:null,setCurrentSpec:function(a){p.spec=a},setup:function(){if(typeof o.OnGrapContent!="function"){o.OnGrapContent=function(a,b,c,d){var e=p.spec;q.focusWindow();if(a===2){if(e.captureType==="base64")e.captureSuccess(c);else if(e.captureType==="pid"){e.beforeUpload();e.upload(c)}}else if(a===3){q.focusWindow();e.captureCancel()}};o.onmsgfireevent=function(a,b){if(b===2){q.focusWindow();spec.captureCancel()}};a.addEvent(window,"unload",function(){a.removeEvent(window,"unload",arguments.callee);if(o)try{o.CloseScreenGrabCtrlWnd();o.onmsgfireevent=null;o.OnGrapContent=null;o=null}catch(b){}})}}},q={};q.isSupport=function(){return b.OS==="windows"?e?!0:f?j>=3.6?!0:!1:g?!1:h?!1:i?j>=4?!0:!1:!1:!1};q.focusWindow=function(){window.focus()};q.hide=function(){o&&o.CloseScreenGrabCtrlWnd()};q.screenCapture=function(b){var g,h={uploadSucc:function(a,c){q.focusWindow();b.captureSuccess(c)},uploadErr:function(a,c){b.captureError(c)}},j=function(b){g&&g.destroy();g=a.kit.extra.upload({type:"base64",base64Str:b,app:"1001"});a.custEvent.add(g,"uploadSucc",h.uploadSucc);a.custEvent.add(g,"uploadError",h.uploadErr)},r=function(){b.upload=function(a){j(a)};p.setup();p.setCurrentSpec(b);if(a.isArray(b.showPos)){var c=b.showPos;o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(typeof b.showPos=="function"){var c=b.showPos();a.isArray(c)&&o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(b.showPos==="center"){var d=a.scrollPos(),e=200,f=200,g=a.winSize(),h=Math.floor(d.top+(g.height-e)/2),i=Math.floor(d.left+(g.width-f)/2);o.ShowControlWnd(window.screenLeft+i,window.screenTop+h,f,e)}else b.showPos==="default"&&o.ShowControlWnd(-1,-1,-1,-1)},s=function(b,e){var f="http://desktop.weibo.com/download.php?source=jietu",g='<#et screentip data><div class="layer_screenshot_tips"><p class="tip" style="width:338px"><span class="icon_warnM"></span>${data.titletip}。</p><div><a href="http://desktop.weibo.com" target="_blank"><img src="${data.imgsrc}" width="338" height="147"/></a></div><div class="btn"><a node-type="download" href="javascript:void(0)" class="W_btn_a"><span>${data.downloadTitle}</span></a><a node-type="nodownload" href="javascript:void(0)" class="W_btn_b"><span>#L{取消下载}</span></a></div></div></#et>',h={imgsrc:(window.$CONFIG&&window.$CONFIG.imgPath||"http://img.t.sinajs.cn/t4/")+"style/images/index/pic_screenshot.png?version="+(window.$CONFIG&&window.$CONFIG.version||""),titletip:b==="IE"?"#L{使用此功能，需要先安装微博桌面}":"#L{使用此功能，需要先安装微博桌面插件}"+(b==="FF"?"，#L{并重新启动浏览器才能使用}":""),downloadTitle:"#L{立即下载}"},i=a.ui.dialog();i.setTitle(c("#L{截屏插件安装提示}"));i.setContent(c(a.core.util.easyTemplate(g,h).toString()));i.show();i.setMiddle();var j=a.kit.dom.parseDOM(a.builder(i.getInner()).list),l=function(){i.hide();d("tblog_image_cut","cancel_download")},m=function(b){var c=a.E(k);if(!c){c=a.C("iframe");c.id=k;c.style.display="none";a.core.util.hideContainer.appendChild(c)}c.src=f;d("tblog_image_cut","download");i.hide()};a.addEvent(j.download,"click",m);a.addEvent(j.nodownload,"click",l);a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);a.removeEvent(j.download,"click",m);a.removeEvent(j.nodownload,"click",l);e()})},t=function(){b.beforeSupportTip();a.ui.alert(c("#L{微博截图功能暂未支持你的浏览器，目前微博截图插件支持Windows系统下的以下浏览器：IE浏览器，支持IE6及更新版本。IE内核浏览器，如360安全浏览器，傲游等浏览器。Firefox浏览器，支持3.6及更新版本。Chrome浏览器，支持4.0及更新版本。Chronium内核浏览器，如360急速浏览器，搜狗等浏览器}。"),{title:c("#L{暂不支持当前浏览器}"),OK:function(){setTimeout(function(){b.supportTipOk()},0)}});d("tblog_image_cut","not_support_browser")},u=function(){var c=e?"IE":f?"FF":i?"CHROME":"";b=a.parseParam({captureType:"base64",captureSuccess:a.funcEmpty,captureCancel:a.funcEmpty,captureError:a.funcEmpty,beforeUpload:a.funcEmpty,showPos:"default",beforeSupportTip:a.funcEmpty,supportTip:t,supportTipOk:a.funcEmpty,beforeIeInstallTip:a.funcEmpty,ieInstallTip:function(){b.beforeIeInstallTip();s(c,b.ieInstallTipOk)},ieInstallTipOk:a.funcEmpty,beforeInstallTip:a.funcEmpty,installTip:function(){b.beforeInstallTip();s(c,b.installTipOk)},installTipOk:a.funcEmpty},b||{});var d=q.isSupport();if(!d)b.supportTip();else{var g=a.common.plugin.plugInstallState(l,m,n,o),h=g.getInstallState();o=g.instance;h==="installed"||h==="ieinstalled"?r():h==="ieneedUpdate"||h==="ieneedInstall"?b.ieInstallTip():h==="needInstall"&&b.installTip()}};return{doit:u,hide:q.hide,focusWindow:q.focusWindow,abort:function(){try{g&&g.abort()}catch(a){}}}};return q});
STK.register("common.bubble.image",function(a){var b=window.$CONFIG,c=[];(function(){b&&b.bigpipe==="true"&&a.historyM&&a.historyM.onpopstate(function(b,d){if(d){a.foreach(c,function(a){a()});c=[]}})})();return function(d,e){var f,g=a.common.plugin.screenCapture,h=a.kit.extra.language,i='<div node-type="outer"><div class="layer_send_pic" node-type="wrap"><div node-type="inner"><div class="profile_tab S_line5"><ul class="pftb_ul layer_tab S_line1"><li class="pftb_itm S_line1"><a class="pftb_lk current S_line5 S_txt1 S_bg5" href="javascript:void(0);" node-type="tab">#L{本地上传}</a></li><li class="pftb_itm pftb_itm_lst S_line1"><a  class="pftb_lk S_line5 S_txt1 S_bg1" href="javascript:void(0);" node-type="tab">#L{推荐配图}</a></li></ul></div><div node-type="content"></div></div><div node-type="uploaded" style="display:none"><div class="laPic_tit"><span node-type="pName"></span><span class="right"></span></div><div node-type="picWrap" class="laPic_Pic"></div><div class="lapic_edit"><a class="beautify" href="javascript:void(0);" node-type="beautify" action-type="beautify" suda-data="key=meitu&value=v4||publish||editor"><span class="W_ico12 icon_edit"></span>#L{编辑}</a><a class="delete" href="javascript:void(0);" action-type="delete"><span class="W_ico12 ico_del"></span>#L{删除}</a></div></div></div><div node-type="flashPanel"></div>',j='<#et uppic data><div node-type="uppic">    <div class="laPic_btnBox clearfix">        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" node-type="inputCover">                <span><em class="ico_one"></em>#L{单张图片}</span>                <form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action="">                    <input class="input_f" type="file" hidefoucs="true" style="" node-type="fileBtn" name="pic1"/>                </form></a>        </div>        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="more" suda-data="key=meitu&value=v4||publish||more">                <span><em class="ico_ones"></em>#L{多张图片}</span>            </a>        </div>        <#if (data.supportCapture)><div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="screen_window" suda-data="key=tblog_image_cut&value=open_image_cut">                <span><em class="ico_screenshot"></em>#L{截屏上传}</span>            </a>        </div></#if>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="face_sticker">               <span><em class="ico_bigface"></em>#L{大 头 贴}</span>           </a>       </div>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="upload_album">               <span><em class="ico_toalbum"></em>#L{上传到相册}</span>           </a>       </div>    </div></div><div node-type="loading"  style="width:230px;display:none"><div class="laPic_con"><div class="W_loading"><span>#L{图片正在上传，请等待}...</span></div></div><div class="laPic_btn"><a href="javascript:void(0);" class="W_btn_b" action-type="cancel"><span>#L{取消上传}</span></a></div></div></#et>',k='<p class="tab_kind S_link2"><span class="right"><a class="pre_d" action-type="prev" node-type="prev" href="javascript:void(0);"></a><a class="next" action-type="next" node-type="next" href="javascript:void(0);"></a></span><em node-type="categorys"></em></p><div node-type="loading"></div><div class="detail"><ul node-type="list" class="faces_magic_list clearfix"></ul><div node-type="page" class="W_pages_minibtn"></div></div>',l='<div class="W_loading"><span>正在加载，请稍候...</span></div>',m='<a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{item}">#{item}</a>',n='<a href="javascript:void(0);"  onclick="return false;" action-type="category" action-data="category=#{item}" class="current S_txt1">#{item}</a>',o='<li><a action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}" class="img" href="javascript:void(0);"><img src="#{thumb}" original="#{original}" title="#{value}" alt="#{phrase}" /></a><span title="#{value}"  action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}">#{phrase}</span></li>',p='<a action-type="page" class="page S_bg1" action-data="num=#{number}" href="javascript:void(0);" >#{label}</a>',q='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);"  class="page S_txt1"  onclick="return false;">#{label}</a>',r="",s=h("#L{默认}"),t="#L{分享图片}",u="##L{微博大头贴}#",v=5,w="weibo.com/",x,y,z,A,B,C,D,E,F,G,H,I,J={},K={page:0,cache:null,cPoniter:0,categorys:[],currentCategory:s,itemNumber:10},L,M,N=a.core.dom.position,O=a.core.evt.addEvent,P=a.core.evt.removeEvent,Q=function(){z=R;a.custEvent.define(J,["uploaded","hide","insert","deletePIC","picLoad"]);a.custEvent.add(f,"hide",function(b){return function(){R.abortUpload();R.hideCapture();a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(J,"hide",{});F=0}}(f));a.ui.mod.tab(x,{evtType:"click",tNodes:'[node-type="tab"]',className:"current",removeClassNames:"pftb_lk S_line5 S_txt1 S_bg1",addClassNames:"pftb_lk current S_line5 S_txt1 S_bg5",cb:[R.init,S.init]});I=a.core.evt.delegatedEvent(x);R.bind()},R={abortUpload:function(){C&&C.abort();D&&D.abort()},init:function(){z=R;R.initDom();R.bind()},initDom:function(){var b;L.wrap.className="layer_send_pic";var c={supportCapture:!0};L.content.innerHTML=h(a.core.util.easyTemplate(j,c).toString());L.close=f.getDomList().close[0];b=a.kit.dom.parseDOM(a.core.dom.builder(x).list);L=a.kit.extra.merge(L,b);R.exchangeInput()},bind:function(){O(L.fileBtn,"change",T.upload);O(L.fileBtn,"click",R.hideCapture);I.add("delete","click",R.deletePic);I.add("cancel","click",R.cancelUpload);I.add("more","click",R.morePic);I.add("beautify","click",R.beautify);I.add("screen_window","click",R.captureWindow);I.add("face_sticker","click",R.faceSticker);I.add("upload_album","click",R.uploadAblum)},destroy:function(){L.fileBtn&&P(L.fileBtn,"click",R.hideCapture);L.fileBtn&&P(L.fileBtn,"change",T.upload)},handleError:function(b){R.stopUpload();f.stopBoxClose();R.resetInput();a.ui.alert(h(b.msg),{OK:function(){b.code==1&&window.location.reload();setTimeout(function(){f.startBoxClose()},0)}})},handleSucc:function(a){R.rendSucc(a);R.stopUpload()},rendLoad:function(){f.stopBoxClose();L.uppic.style.display="none";L.loading.style.display=""},rendSucc:function(b){var c=a.common.extra.imageURL(b.pid),d=[],e,f;H=H||b.pid;d=H.split(/\/|\\/);e=d[d.length-1];d=e.split(".");if(d.length>1&&a.bLength(d[0])>20){d[0]=a.leftB(d[0],20);f=[d[0],"...",d[1]].join("")}else f=e;B=b.pid;T.loadPic({url:c,value:f,pid:b.pid});L.beautify&&(L.beautify.style.display="")},deletePic:function(){a.preventDefault();L.close.style.display="";L.inner.style.display="";L.wrap.style.width="";L.uploaded.style.display="none";L.picWrap.innerHTML="";z.destroy();z.init();f.startBoxClose();a.custEvent.fire(J,"deletePIC",{text:h(G)});F=0},stopUpload:function(){L.loading.style.display="none";L.uppic.style.display=""},cancelUpload:function(){R.abortUpload();R.stopUpload();R.resetInput();f.startBoxClose()},exchangeInput:function(){var b=L.fileBtn,c=b.parentNode,d=b.className,e=b.name,f=a.C("input");f.className=d;f.name=e;f.type="file";f.hideFocus="true";L.fileBtn=f;c.removeChild(b);c.appendChild(f)},resetInput:function(){P(L.fileBtn,"click",R.hideCapture);P(L.fileBtn,"change",T.upload);R.exchangeInput();O(L.fileBtn,"change",T.upload);O(L.fileBtn,"click",R.hideCapture)},beautifySucess:function(a){H=a;R.handleSucc({pid:a})},faceStickerSucess:function(a){F=1;H=a;R.handleSucc({pid:a})},morePic:function(){R.uploadWaterMarkFlash({id:"photo_merge",swf:"SinaCollage.swf",width:528,height:470,sucess:R.beautifySucess})},faceSticker:function(){R.uploadWaterMarkFlash({id:"photo_facesticker",swf:"FacePhoto.swf",width:568,height:478,baseDir:"facesticker",sucess:R.faceStickerSucess})},uploadWaterMarkFlash:function(c){a.preventDefault();R.hideCapture();f.stopBoxClose();if(a.kit.extra.getFlashVersion()<10)a.kit.extra.installFlash({onHide:function(){f.startBoxClose()}});else{var d=function(d){var e=d.nickname!="0"||d.logo!="0"||d.domain!="0",g=b&&b.nick||"",h="http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&marks="+(e?"1":"0")+(d.logo=="1"?"&logo=1":"")+(d.nickname=="1"?"&nick="+(g?encodeURIComponent("@"+g):""):"")+(d.domain=="1"?"&url="+w+(b&&b.watermark||b.domain):"")+(d.position?"&markpos="+d.position:"")+"&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",i={id:c.id,pos:f.getPosition(),service:h,sucess:c.sucess,h:c.height,w:c.width,swf:c.swf,baseDir:c.baseDir||""};a.common.flash.imgUpload(i,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){f.startBoxClose()},100)}}).show()};a.kit.extra.watermark(function(a){d(a)})}},beautify:function(){a.preventDefault();if(a.kit.extra.getFlashVersion()<10)a.kit.extra.installFlash();else{var b={id:"photo_editor",pos:f.getPosition(),service:"http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:R.beautifySucess,h:385,w:528,swf:"PhotoEditor.swf"};a.common.flash.imgUpload(b,{init:function(b,c){b.setPars(a.common.extra.imageURL(B,{size:"large"}))},close:function(a,b){}}).show()}},hideCapture:function(){D&&D.hide()},captureWindow:function(){a.preventDefault();if(!D){var b=function(){f.stopBoxClose()},c=function(){f.startBoxClose()};D=g.screenCapture({captureType:"pid",beforeUpload:R.beforeCaptureUpload,captureSuccess:R.captureSuccess,captureError:R.handleError,beforeSupportTip:b,supportTipOk:c,beforeIeInstallTip:b,ieInstallTipOk:c,beforeInstallTip:b,installTipOk:c})}D.doit()},beforeCaptureUpload:function(){R.rendLoad()},captureSuccess:function(a){H=a.imgName;E=1;R.handleSucc(a)},uploadAblum:function(){window.open("http://photo.weibo.com/upload/weibo","","width=650, height=470, top=300, left=400")}},S={init:function(){z=S;R.abortUpload();R.hideCapture();var b;L.wrap.className="layer_faces";R.destroy();L.content.innerHTML=h(k);b=a.kit.dom.parseDOM(a.core.dom.builder(x).list);L=a.kit.extra.merge(L,b);L.loading.innerHTML=h(l);S.cartoonStart();S.bind()},bind:function(){I.add("insertSmiley","click",function(a){STK.core.evt.preventDefault();L.beautify&&(L.beautify.style.display="none");var b=a.data.url,c=a.data.pid,d=a.data.value;T.loadPic({url:b,value:d,pid:c})});I.add("category","click",function(a){K.page=0;K.currentCategory=a.data.category;S.rend();setTimeout(function(){S.rendCategory(K);S.rendPage(K)},0)});I.add("prev","click",function(b){a.preventDefault(b.evt);var c=K.cPoniter;if(c<=0)return!1;K.cPoniter-=v;S.rendCategory(K)});I.add("next","click",function(b){a.preventDefault(b.evt);var c=K.cPoniter,d=K.categorys;if(c>=d.length-v)return!1;K.cPoniter+=v;S.rendCategory(K)});I.add("page","click",function(a){K.page=parseInt(a.data.num,10);S.rend();setTimeout(function(){S.rendPage(K)},0);return STK.preventDefault(a.evt)})},cartoonStart:function(){a.common.trans.editor.getTrans("cartoon",{onSuccess:function(a,b){K.cache=a.data.more||{};K.categorys=[s];for(var c in K.cache)K.categorys.push(c);K.cache[s]=a.data.usual.norm;S.cartoonStart=function(){K.page=0;K.cPoniter=0;K.currentCategory=s;S.rend();S.rendCategory(K);S.rendPage(K)};S.cartoonStart()}}).request({})},rend:function(b,c){var d=K.currentCategory,e=K.cache[d],f=K.page,g=K.itemNumber;e=e.slice(f*g,f*g+g);e=a.foreach(e,function(b,c){a.bLength(b.phrase)>8&&(b.phrase=[a.leftB(b.phrase,6),"..."].join(""));return a.templet(h(o),b)});L.loading.innerHTML="";L.list.innerHTML=e.join("")},rendCategory:function(b){var c=b.cPoniter,d=b.categorys,e=b.currentCategory,f=d.slice(c,c+v);f=a.foreach(f,function(b,c){return e===b?a.templet(h(n),{item:b}):a.templet(h(m),{item:b})});L.categorys.innerHTML=f.join(r);c+6>=d.length?L.next.className="next_d":L.next.className="next";c<=0?L.prev.className="pre_d":L.prev.className="pre"},rendPage:function(b){var c=b.page,d=b.cache[b.currentCategory],e=d.length/b.itemNumber,f=[];for(var g=0;g<e;g+=1)c==g?f.push(a.templet(h(q),{number:g,label:g+1})):f.push(a.templet(h(p),{number:g,label:g+1}));L.page.innerHTML=f.join("")},destroy:function(){}},T={trans:function(){C&&C.destroy();C=a.kit.extra.upload({type:"common",form:L.form,imgName:H,app:1001});a.custEvent.add(C,"uploadSucc",function(a,b){R.handleSucc(b)});a.custEvent.add(C,"uploadError",function(a,b){R.handleError(b)})},upload:function(){H=L.fileBtn.value;if(a.core.str.trim(H)!==""){R.rendLoad();T.trans()}},loadPic:function(b){L.picWrap.innerHTML="";var c=b.url,d=L.close,e=a.C("img");b.value&&(L.pName.innerHTML=b.value);E&&(e.onload=function(){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_image_cut","succeed_image_cut")});E=0;e.src=c;f.stopBoxClose();G=F?u:t;a.core.evt.custEvent.fire(J,"uploaded",{text:h(G),pid:b.pid});L.wrap.style.display="";L.wrap.className="layer_send_pic";L.wrap.style.width="240px";L.inner.style.display="none";L.uploaded.style.display="";d.style.display="none";L.picWrap.appendChild(e)}},U={};J={};J.getBub=function(){return f};if(!a.isNode(d))throw"common.bubble.image need el as first parameter!";M=window.location.href;L=a.kit.dom.parseDOM(a.core.dom.builder(h(i)).list);x=L.outer;f=a.ui.bubble();R.initDom();if(e&&e.pid){var V=a.common.extra.imageURL(e.pid);T.loadPic({url:V,pid:e.pid})}Q();f.setContent(x);e.fail=function(){f.setLayout(d,{offsetX:-24,offsetY:5})};f.setAlignPos(d,e.refer,e);J.bubble=f;f.show();c.push(function(){f&&f.hide()});return J}});
STK.register("common.editor.widget.image",function(a){return function(b){a.log(b);var c={},d,e,f,g,h,i=function(a,b){d.API.insertText(b.value);e.getBub().hide()},j=function(b,c){a.log("upload");var e=d.API.getWords();e.length==0&&d.API.insertText(c.text);d.API.addExtraInfo(c.pid);g=!0},k=function(a,b){d.API.delWords(b.text);d.API.addExtraInfo("");clearInterval(h)},l=function(b){if(!g){a.core.evt.preventDefault();var c=d.nodeList.textEl;if(typeof b=="string"){e=a.common.bubble.image(d.nodeList[f],{pid:b,refer:c,arrowOffset:-5});a.log("has pid");h=setInterval(function(){e.bubble.setLayout(d.nodeList[f],{offsetX:-29,offsetY:5})},200)}else e=a.common.bubble.image(d.nodeList[f],{refer:c,arrowOffset:-5});a.custEvent.add(e,"uploaded",j);a.log(2222);a.custEvent.add(e,"insert",i);a.custEvent.add(e,"deletePIC",k);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"uploaded",j);a.custEvent.remove(e,"insert",i);a.custEvent.remove(e,"deletePIC",k);a.custEvent.remove(e,"changeType");g=!1})}};c.init=function(b,c,e){d=b;f=c;a.addEvent(b.nodeList[f],"click",l);e&&e.pid&&l(e.pid)};c.clear=function(){};c.show=function(){};c.hide=function(){e&&e.getBub().hide()};c.resetBubble=function(a){if(e){var b={fail:function(){e.bubble.setLayout(a,{offsetX:-29,offsetY:5})},arrowOffset:-5};e.bubble.setAlignPos(a,d.nodeList.textEl,b)}};c.destroy=function(){d=null};return c}});
STK.register("common.trans.feed",function(a){var b=a.kit.io.inter(),c=b.register;c("publish",{url:"/aj/mblog/add?_wv=5",method:"post"});c("delete",{url:"/aj/mblog/del?_wv=5",method:"post"});c("forward",{url:"/aj/mblog/forward?_wv=5",method:"post"});c("mediaShow",{url:"http://api.weibo.com/widget/show.jsonp",varkey:"jsonp",method:"get",requestMode:"jsonp"});c("qingShow",{url:"http://api.t.sina.com.cn/widget/show.json?source=3818214747",varkey:"callback",method:"get",requestMode:"jsonp"});c("profileSearch",{url:"/aj/mblog/mbloglist?_wv=5",method:"get"});c("homeSearch",{url:"/aj/mblog/fsearch?_wv=5",method:"get"});c("groupSearch",{url:"/aj/relation/status?_wv=5",method:"get"});c("sendMeSearch",{url:"/aj/mblog/sendme?_wv=5",method:"get"});c("atMeSearch",{url:"/aj/at/mblog/list?_wv=5",method:"get"});c("atMeShield",{url:"/aj/at/mblog/shield?_wv=5",method:"post"});c("widget",{url:"/aj/mblog/showinfo?_wv=5",method:"post"});c("third_rend",{url:"/aj/mblog/renderfeed?_wv=5",method:"post"});c("feedShield",{url:"/aj/user/block?_wv=5",method:"post"});c("feedTagList",{url:"/aj/mblog/tag/mytaglist?_wv=5",method:"post"});c("feedTagListHtml",{url:"/aj/mblog/tag/list?_wv=5",method:"get"});c("feedTagUpdate",{url:"/aj/mblog/tag/updatetags?_wv=5",method:"post"});c("feedTagDel",{url:"/aj/mblog/tag/destroy?_wv=5",method:"post"});c("feedTagEdit",{url:"/aj/mblog/tag/update?_wv=5",method:"post"});c("getAtmeComment",{url:"/aj/at/comment/comment?_wv=5",method:"get"});c("getAtmeBlog",{url:"/aj/at/mblog/mblog?_wv=5",method:"get"});c("getCommonComent",{url:"/aj/commentbox/common?_wv=5",method:"get"});c("getAttiudeList",{url:"/aj/attiudebox/in?_wv=5",method:"get"});c("memberTopFeed",{url:"/aj/mblog/markmembermblog?_wv=5",method:"post"});c("activityDelete",{url:"/aj/activities/del?_wv=5",method:"post"});c("activityShield",{url:"/aj/activities/block?_wv=5",method:"post"});c("common_media",{url:"http://api.weibo.com/widget/object_render.jsonp?source=3818214747",varkey:"callback",method:"get",requestMode:"jsonp"});c("showblock",{url:"/aj/blockword/showblock?_wv=5",method:"get"});c("update",{url:"/aj/blockword/update?_wv=5",method:"get"});c("showfiltermblogs",{url:"/aj/mblog/showfiltermblogs?_wv=5",method:"get"});c("refreshRecommend",{url:"/aj/mblog/recfeed?_wv=5",method:"get"});c("closeRecommend",{url:"/aj/mblog/recfeedclose?_wv=5",method:"get"});c("translate",{url:"/aj/mblog/translation?_wv=5",method:"get"});c("adShield",{url:"/aj/user/blockad?_wv=5",method:"post"});c("recmodlayer",{url:"/aj/photo/recomlayer?_wv=5",method:"get"});return b});
STK.register("common.channel.feed",function(a){var b=["forward","publish","comment","delete","refresh","reply","feedTagUpdate","feedTagMoreUpdate","qfaceAdd","qfaceCount"];return a.common.listener.define("common.channel.feed",b)});
STK.register("kit.extra.actionData",function(a){return function(b){return{set:function(c,d){if(!!a.isNode(b)){var e=a.queryToJson(b.getAttribute("action-data")||"")||{};e[c]=d;b.setAttribute("action-data",a.jsonToQuery(e))}},del:function(c){if(!!a.isNode(b)){var d=a.queryToJson(b.getAttribute("action-data")||"")||{};delete d[c];b.setAttribute("action-data",a.jsonToQuery(d))}},get:function(c){if(!a.isNode(b))return"";var d=a.queryToJson(b.getAttribute("action-data")||"")||{};return d[c]||""}}}});
STK.register("kit.dom.outerHeight",function(a){return function(b){if(!a.core.dom.isNode(b))throw"Parameter must be an HTMLEelement!";return a.core.dom.getSize(b).height+(parseFloat(a.core.dom.getStyle(b,"marginTop"))||0)+(parseFloat(a.core.dom.getStyle(b,"marginBottom"))||0)}});
STK.register("common.extra.keyboardCapture",function(a){var b={13:"enter",27:"esc",32:"space",38:"up",40:"down",9:"tab"};return function(c,d){d=d||{};var e={},f,g={keydown:function(c){d.stopScroll&&a.stopEvent();var f,g;!!(f=c)&&!!(g=f.keyCode)&&b[g]&&a.custEvent.fire(e,b[g])}},h={init:function(){h.pars();h.bind()},pars:function(){},bind:function(){for(var b in g)a.addEvent(c,b,g[b])},getKey:function(a){return b[a]},destroy:function(){for(var b in g)a.removeEvent(c,b,g[b])}};h.init();e.getKey=h.getKey;e.destroy=h.destroy;return e}});
STK.register("common.editor.plugin.publishTo",function(a){var b=a.kit.extra.language,c=a.core.util.templet,d=a.core.util.easyTemplate,e;return function(c){var d,f,g=c&&c.editorWrapEl,h=c&&c.textEl,i={},j=[],k,l={},m,n,o=function(){if(!a.isNode(g))throw"publishTo need a wrapper node to parseDOM"},p=a.getUniqueKey(),q=function(a){var b=[],c;b.push('<div style="position: absolute;display:none;z-index:29999;outline:none;" hideFocus="true" node-type="publishTo" class="layer_menu_list" tabindex="10">');b.push('<ul id="'+p+'">');b.push('<li><a title="#L{公开-你发表的微博可以被大家公开查看哦}" suda-data="key=tblog_edit_exposure&value=edit_public" href="javascript:void(0)" action-data="rank=0&text=#L{公开}&rankid=" action-type="publishTo"><i class="W_ico16 i_conn_public"></i>#L{公开}</a></li>');b.push($CONFIG.miyou===1?'<li><a title="#L{密友圈-发表的微博只有你的密友才能看到}" href="javascript:void(0)" action-data="rank=2&text=#L{密友圈}&rankid=" action-type="publishTo"><i class="W_ico16 i_conn_close_friend"></i>#L{密友圈}</a></li>':"");b.push('<li><a title="#L{仅自己可见-发表的微博只有自己才能看到}" suda-data="key=tblog_edit_exposure&value=edit_private" href="javascript:void(0)" action-data="rank=1&text=#L{仅自己可见}&rankid=" action-type="publishTo"><i class="W_ico16 i_conn_private"></i>#L{仅自己可见}</a></li>');b.push('<li class="line"></li>');b.push('<li><a action-type="more" href="javascript:void(0);"><i class="W_ico16 i_conn_list"></i>#L{分组可见}</a></li>');b.push("</ul></div>");return b.join("")},r=function(a){var b=[],c=a.length,d;c>8?b.push('<ul class="scroll_bar" style="width:110px;" id="'+p+'">'):b.push('<ul class="scroll_bar" style="height:auto;width:110px;" id="'+p+'">');for(var e=0;e<c;e++){d=a[e];b.push('<li><a action-type="publishTo" action-data="rank=3&text='+d.gname+"&rankid="+d.gid+'" title="'+d.gname+'" href="javascript:void(0);" onclick="return false;"><i class="W_ico16 i_conn_list"></i>'+d.gname+"</a></li>")}b.push("</ul>");b.push('<ul><li class="line"></li>');b.push('<li class="opt"><a href="javascript:void(0)" onclick="return false;" action-type="back">#L{返回}</a></li>');b.push("</ul>");return b.join("")},s=function(){f=a.kit.dom.parseDOM(a.builder(g).list);f.wrap||(f.wrap=g);n=f.wrap.className},t=function(){d=function(){var c={},d,i,l,o,s=f.showPublishTo;i=d=s&&s.getAttribute("action-data")&&a.core.json.queryToJson(s.getAttribute("action-data"))||{rank:"all",rankid:""};c.node=a.core.evt.delegatedEvent(g);var t=!1,u={hotKeyChangeRank:function(c,f){var g=f.match(/\d+/);if(g&&g[0]){var h=parseInt(g[0],10)-1,i=[{rank:0,rankid:"",text:b("#L{公开}"),title:b("#L{公开-你发表的微博可以被大家公开查看哦}")},{rank:2,rankid:"",text:b("#L{密友圈}"),title:b("#L{密友圈-发表的微博只有你的密友才能看到}")},{rank:1,rankid:"",text:b("#L{仅自己可见}"),title:b("#L{仅自己可见-发表的微博只有自己才能看到}")}],j=function(){a.foreach(k,function(a){a.rank=3;a.rankid=a.gid;a.text=a.gname;a.title=a.gname});i=i.concat(k);var b=window.$CONFIG&&window.$CONFIG.miyou=="1";b||i.splice(1,1);if(i[h]){d=i[h];z.btnContent(d.text);z.btnTitle(d.title);t=!1;a.custEvent.fire(z,"changeRank",d)}},k=function(){if(e)return a.core.arr.copy(e);A.group.request(function(b){k=a.core.arr.copy(b);j()});return null}();k&&j()}}},v=function(){c.node.add("showPublishTo","click",z.show)},w=function(){A.normal.bind();A.group.bind();x.bind()},x={keyboardManager:null,keyTypes:["up","down","esc","enter"],getIndex:function(b){var c=x.getList(),d=x.lastCur,e;a.foreach(c,function(a,b){if(d===a){e=b;return!1}});b>0?e++:e--;e>=c.length?e=0:e<0&&(e=c.length-1);return e},up:function(){var a=x.getIndex(-1),b=x.getList()[a];x.setCur(b,a)},down:function(){var a=x.getIndex(1),b=x.getList()[a];x.setCur(b,a)},enter:function(){var b=x.lastCur;b.getAttribute("action-type")||(b=a.sizzle("[action-type]",b)[0]);b&&c.layer.fireDom(b,"click",null)},esc:function(){z.hide()},bind:function(){x.keyboardManager=a.common.extra.keyboardCapture(f.publishTo,{stopScroll:!0});a.custEvent.define(x.keyboardManager,x.keyTypes);for(var b=0,c=x.keyTypes.length;b<c;b++){var d=x.keyTypes[b];a.custEvent.add(x.keyboardManager,d,x[d])}},list:null,lastCur:null,focusPublishTo:function(){f.publishTo.focus();var a=this.getList(!0);this.setCur(a[0],0)},setCur:function(b,c){this.lastCur&&a.removeClassName(this.lastCur,"cur");a.addClassName(b,"cur");this.lastCur=b;var d=a.E(p);if(a.contains(d,b)){var e=a.kit.dom.outerHeight,f=c+1,g=Math.max(e(b),e(a.sizzle("a",b)[0]));f>7?d.scrollTop=(f-7)*g:d.scrollTop=0}},getList:function(b){if(b||!this.list){var c=a.sizzle("li",f.publishTo),d=[];a.foreach(c,function(b){a.getStyle(b,"display")!="none"&&b.className!="line"&&d.push(b)});this.list=d}return this.list}},y={setPos:function(){var b=a.core.dom.getSize,c=b(f.showPublishTo).width-b(f.publishTo).width;a.kit.dom.layoutPos(f.publishTo,f.showPublishTo,{offsetX:c+2,offsetY:2})},init:function(){c.layer=a.core.evt.delegatedEvent(f.publishTo);c.closeFriend=a.core.evt.delegatedEvent(f.publishTo)},setArrow:function(a){var b=f.showPublishTo;!b||(a=="up"?b.className="W_arrow_turn":a=="down"&&(b.className=""))},show:function(){a.foreach(a.sizzle("li",f.publishTo),function(b){var c=a.sizzle("a",b)[0];if(c){var e=a.kit.extra.actionData(c),f=e.get("rank"),g=e.get("rankid");d.rank!="3"?d.rank==f&&f!=""&&a.setStyle(b,"display","none"):d.rankid==g&&a.setStyle(b,"display","none")}});y.setPos();a.setStyle(f.publishTo,"display","");x.focusPublishTo();y.setArrow("up");if(!k){k=1;y.bindBodyEvt()}return!1},hide:function(){a.setStyle(f.publishTo,"display","none");t=!1;if(k){k=0;y.removeBodyEvt()}},autoHide:function(b){b=a.core.evt.fixEvent(b);f.showPublishTo!==b.target&&!a.core.dom.contains(f.showPublishTo,b.target)&&!a.core.dom.contains(f.publishTo,b.target)&&z.hide()},content:function(a){if(typeof a=="undefined")return f.publishTo.innerHTML;f.publishTo.innerHTML=a},bindBodyEvt:function(){a.addEvent(document.body,"click",y.autoHide)},removeBodyEvt:function(){a.removeEvent(document.body,"click",y.autoHide)}},z={enable:function(){f.showPublishTo.setAttribute("action-type","showPublishTo")},disable:function(){f.showPublishTo.setAttribute("action-type","")},miYouStyle:function(b,c){var d="2",e=$CONFIG.lang=="zh-cn"?"":"_CHT";d==c.rank?a.core.dom.addClassName(f.wrap,"send_weibo_cf"+e):a.core.dom.removeClassName(f.wrap,"send_weibo_cf"+e)},show:function(){var b=function(){a.custEvent.fire(z,"show");t?A.group.show():A.normal.show()};if(f.publishTo){var c=a.getStyle(f.publishTo,"display");if(c==="none")b();else{a.setStyle(f.publishTo,"display","none");t=!1;y.setArrow("down")}}else b();a.preventDefault()},btnContent:function(a){a&&(l.innerHTML=a)},btnTitle:function(a){a&&f.showPublishTo.setAttribute("title",a)},hide:function(){y.hide();y.setArrow("down")},toggle:function(){t||(f.publishTo.style.display=="none"?z.show():z.hide())},rank:function(){return d},reset:function(){z.enable();f.wrap.className=n;z.btnContent(o.content);z.btnTitle(o.title);d=null;t=!1;d=i},destroy:function(){try{for(var b in c)c[b].destroy()}catch(d){}j.length&&a.hotKey.remove(h,j,u.hotKeyChangeRank);a.removeNode(f.publishTo);a.custEvent.undefine(z);if(x.keyboardManager){x.keyboardManager.destroy();a.custEvent.undefine(x.keyboardManager,x.keyTypes)}},changeRank:function(b){b=b>0?b-1:0;var c=a.sizzle('a[action-type="publishTo"]',f.publishTo)[b];if(c){A.normal.changeRank({el:c,data:a.core.json.queryToJson(c.getAttribute("action-data")||"")});var d=c.getAttribute("suda-data");if(d){var e=d.match(/key=(.+?)&value=(.+)/);e&&e.length===3&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(e[1],e[2])}}},getDomHeight:function(){return f.publishTo.style.display=="none"?{width:0,heigth:0}:a.core.dom.getSize(f.publishTo)},bindAltKey:function(){if(a.isNode(h)){var b=a.core.util.browser.OS==="macintosh";if(b)for(var c=1;c<=9;c++)j.push("ctrl+"+c);else for(var c=1;c<=9;c++)j.push("alt+"+c);a.hotKey.add(h,j,u.hotKeyChangeRank)}}},A={normal:{bind:function(){c.layer.add("publishTo","click",A.normal.changeRank);c.layer.add("more","click",A.normal.more)},getList:function(){y.content(m)},more:function(){A.group.show();t=!0;a.core.evt.stopEvent()},show:function(){var a=function(){if(!f.publishTo){B();y.init();w()}A.normal.getList();y.show()};e?a():A.group.request(a)},changeRank:function(b){try{a.preventDefault(b.evt)}catch(c){}d=b.data;var e=b.data.text;z.btnContent(e);z.btnTitle(b.el.getAttribute("title"));d.rank=="group"?A.group.show():z.hide();a.custEvent.fire(z,"changeRank",d)}},group:{request:function(b){a.common.trans.group.getTrans("list",{onSuccess:function(a){var c=a.data.length;for(var d=0;d<c;d++)a.data[d].index=d+1;e=a.data;b&&b(e)}}).request({})},bind:function(){c.layer.add("back","click",A.group.back)},getList:function(){if(!A.group.cache){var a=b(r(e));A.group.cache=a;y.content(A.group.cache)}else y.content(A.group.cache)},show:function(){A.group.getList();y.show()},back:function(){var b=a.core.evt.fixEvent();a.core.evt.stopEvent(b);t=!1;A.normal.show()}}},B=function(c){var d=b(q(c));f.publishTo=a.insertHTML(document.body,d,"beforeend");m=f.publishTo.innerHTML},C=function(){if(!a.isNode(f.showPublishTo))return 0;l=f.publishTotext;o={content:l.innerHTML,title:f.showPublishTo.getAttribute("title")};v();return 1},D=C();a.custEvent.define(z,["show","hide","changeRank"]);return D?z:null}();d&&d.bindAltKey&&d.bindAltKey()},u=function(){o();s();t()};u();return d}});
STK.register("common.dialog.publish",function(a){var b='<#et temp data><div class="detail" node-type="outer"><div class="send_weibo clearfix" node-type="wrap"><div class="title_area clearfix"><div class="title" node-type="info"></div><div class="num S_txt2" node-type="num"><span>140</span>#L{字}</div><div class="key S_textb"  ></div></div><div class="input clicked" style="width:460px;"><textarea name="" class="input_detail" node-type="textEl"></textarea><div class="send_succpic" style="display:none" node-type="successTip"></div><span class="arrow"></span></div><div class="func_area clearfix"><div class="func"><div class="limits"><a href="javascript:void(0);" node-type="showPublishTo" action-type="showPublishTo" action-data="rank=0"><span node-type="publishTotext" class="W_autocut">#L{公开}</span><span class="W_arrow"><em node-type="publish_to_arrow">◆</em></span></a></div><a href="javascript:void(0)" class="send_btn disable" diss-data="module=shissue" node-type="submit">#L{发布}</a></div><div class="kind S_txt3" node-type="widget"><span class="kind_detail"><#if (data.smileyBtn)><a href="javascript:void(0)" class="W_ico16 icon_sw_face" node-type="smileyBtn">#L{表情}</a></#if><#if (data.picBtn)><a href="javascript:void(0)" class="W_ico16 icon_sw_img" node-type="picBtn">#L{图片}</a></#if></span></div></div></div></div>',c={title:"#L{有什么新鲜事想告诉大家}"},d=a.kit.extra.language,e={limitNum:140,extendText:'<a target="_blank" class="S_txt2" href="http://weibo.com/z/guize/gongyue.html">#L{发言请遵守社区公约}</a>，'};return function(f){var g={},h,i,j,k,l,m,n,o,p,q,r;h=a.parseParam({templete:d(b),appkey:"",styleId:"1",smileyBtn:!0,picBtn:!0,pid:""},f);o=a.custEvent.define(g,"publish");a.custEvent.define(g,"hide");var s=function(){var b=l.textEl;if(i)j==="error"&&a.common.extra.shine(b);else{i=!0;j="loading";var c=a.common.getDiss(t(),l.submit);c.pub_type="dialog";r&&r.disable();n.request(c)}},t=function(){var b=m.API.getWords();p&&b.indexOf(p)===-1&&(b=b+p);var c={};c.appkey=h.appkey;c.style_type=h.styleId;c.text=b;var d=m.API.getExtra();if(d)if(d.indexOf("=")<0)c.pic_id=m.API.getExtra()||"";else{var e=d,f=a.core.json.queryToJson(e);for(var g in f)c[g]=f[g];a.log(c)}if(r&&r.rank){var i=r.rank();c.rank=i.rank;c.rankid=i.rankid}return c},u=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){s();m.API.blur()}},v=function(a,b){var c=b.isOver;if(!c){i=!1;j="";l.submit.className="send_btn";l.num.innerHTML=(e.extendText?d(e.extendText):"")+d("#L{还可以输入%s字}","<span>"+(140-b.count)+"</span>")}else{i=!0;j="error";l.submit.className="send_btn disable"}},w=function(b,c){j="";l.successTip.style.display="";l.textEl.value="";setTimeout(function(){i=!1;l.successTip.style.display="none";k&&k.hide();l.submit&&(l.submit.className="send_btn")},2e3);a.custEvent.fire(o,"publish",[b.data,c]);a.common.channel.feed.fire("publish",[b.data,c]);l.submit.className="send_btn disable";m.API.reset();r&&r.reset&&r.reset()},x=function(b,c){i=!1;j="";b.msg=b.msg||d("操作失败");a.common.layer.ioError(b.code,b);l.submit&&(l.submit.className="send_btn");r&&r.enable()},y=function(a){l.textEl.value="";m.API.insertText(a.content);l.info.innerHTML=a.info;a.appkey&&(h.appkey=a.appkey);if(a.content){i=!1;j="";l.submit.className="send_btn"}else{i=!0;j="error";l.submit.className="send_btn disable"}},z=function(){i=!1},A=function(){m=a.common.editor.base(a.core.util.easyTemplate(a.kit.extra.language(h.templete),h).toString(),e);h.smileyBtn&&m.widget(a.common.editor.widget.face({useAlign:!0}),"smileyBtn");h.picBtn&&m.widget(a.common.editor.widget.image(),"picBtn");l=m.nodeList;r=a.common.editor.plugin.publishTo({editorWrapEl:l.wrap,textEl:l.textEl});q=a.common.dialog.validateCode()},B=function(){a.addEvent(l.submit,"click",s);a.addEvent(l.textEl,"keypress",u)},C=function(){r&&r.miYouStyle.apply(null,arguments)},D=function(){a.custEvent.add(m,"textNum",v);r&&a.custEvent.add(r,"changeRank",C)},E=function(){n=a.common.trans.feed.getTrans("publish",{onComplete:function(a,b){var c={onSuccess:w,onError:x,requestAjax:n,param:t(),onRelease:function(){i=!1;j="";l.submit&&(l.submit.className="send_btn");r&&r.enable()}};q.validateIntercept(a,b,c)},onFail:x,onTimeout:x})},F=function(){A();B();D();E()},G=function(b){m||F();var e=a.parseParam({appkey:"",content:"",defaultValue:"",info:"",title:d(c.title)},b);k=a.ui.dialog();k.setTitle(e.title);k.appendChild(l.outer);k.show();k.setMiddle();y(e);m.API.focus();a.custEvent.add(k,"hide",function(){a.custEvent.remove(k,"hide",arguments.callee);m.closeWidget();z();k=null;a.custEvent.fire(o,"hide")});p=e.defaultValue},H=function(){k.hide()},I=function(a){m.API.addExtraInfo(a)},J=function(a){m.API.disableEditor(a)},K=function(){k&&k.hide();l&&l.submit&&a.removeEvent(l.submit,"click",s);l&&l.textEl&&a.removeEvent(l.textEl,"keypress",u);a.custEvent.remove(m,"textNum",v);r&&a.custEvent.remove(r,"changeRank",C);a.custEvent.undefine(o,"publish");q&&q.destroy&&q.destroy();r&&r.destroy&&r.destroy();l=null;n=null;i=!1;for(var b in g)delete g[b];g=null};g.addExtraInfo=I;g.disableEditor=J;g.show=G;g.hide=H;g.destroy=K;return g}});
STK.register("common.relation.userList",function(a){var b=13;return function(c){var d={},e,f=a.delegatedEvent(c.userListBox),g=a.common.relation.followPrototype,h=a.common.relation.closeFriend,i=a.common.dialog.setGroup(),j=a.kit.extra.language,k=a.getUniqueKey(),l=a.common.dialog.publish(),m=a.common.relation.groupSelector($CONFIG.group||[]),n=a.ui.tipConfirm({info:j("#L{确认取消关注吗？}")}),o=j("#L{添加分组说明}"),p=j("#L{例如：我校校花}"),q=a.ui.tipConfirm({template:j('<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div class="content layer_mini_info"><p class="clearfix" node-type="info"><span node-type="icon" class="icon_ask"></span></p><p class="noicon S_txt2"><input type="checkbox" id="userList_'+k+'" class="ckbox"><label for="userList_'+k+'">#L{同时将此用户加入黑名单}</label></p>'+'<p class="btn"><a node-type="ok" class="W_btn_b" href="javascript:void(0)"><span>#L{确定}</span></a><a class="W_btn_d" node-type="cancel" href="javascript:void(0)"><span>#L{取消}</span></a></p>'+"</div>"+"</td></tr></tbody>"+"</table>")}),r='<em class="CH">…</em><em class="W_moredown_txt"></em>',s='<em class="W_moredown_txt"></em>',t=j('<div class="W_bubtips clearfix"><div node-type="dataContent" class="S_bg1 S_line1"><div class="W_loading"><span>#L{正在加载，请稍候...}</span></div></div></div>'),u='<li><a title="{name}" href="{url}">{name}</a></li>',v=1,w,x=$CONFIG.imgPath+"style/images/common/transparent.gif",y='你已成功添加#{sex}为好友<br/><br/><a href="javascript:;" action-type="go">去看看#{sex}</a><i class="W_vline">|</i><a href="javascript:;" action-type="msg">给#{sex}发私信</a><i class="W_vline">|</i><a href="javascript:;" action-type="at">@#{sex}</a>',z={cfSuc_1:j("#L{密友邀请已经发送，请等待对方接受}"),cfSuc_2:j("#L{你已经成功添加对方为密友，你们彼此已经是密友啦}"),cfSucTit_1:j("#L{需要对方通过邀请才能加为密友}")};a.custEvent.define(d,"empty");a.custEvent.define(d,"removeOne");a.custEvent.define(d,"doRemove");var A=function(b){a.removeNode(b);c.userListBox.children.length||a.custEvent.fire(d,"empty");a.custEvent.fire(d,"doRemove")},B=function(b){var c=a.C("span");c.className="W_btn_c";c.innerHTML=j('<span><em class="W_ico12 icon_addtwo"></em>#L{互相关注}</span>');var d=a.C("span");d.className="W_btn_c";d.innerHTML=j('<span><em class="W_ico12 icon_addone"></em>#L{已关注}</span>');B=function(a){var b=a.relation||{},e=b.following&&b.follow_me,f=e?c:d;return f.cloneNode(!0)};return B(b)},C=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},D=function(b,c){var d=a.trim(b.innerHTML),e=d===o?p:d,f=a.C("input");f.type="text";f.value=a.decodeHTML(e);a.addEvent(f,"blur",c.blur);a.addEvent(f,"keyup",c.keyup);a.replaceNode(f,b);f.select()},E=function(b){var c=a.C("a");c.href="javascript:;";c.className="W_addbtn_es";c.innerHTML=j('<img src="'+x+'" class="addicon">#L{'+b+"}");return c},F={setRemark:function(b,c){var d=j("#L{设置备注}"),e=a.core.str.decodeHTML(c.innerHTML);e===d&&(e="");a.common.dialog.setRemark({uid:b.data.uid,remark:e,callback:function(b){var e=a.trim(b||"")||d;c.innerHTML=C(e)}})},showGroup:function(d,e){var f=a.position(e),g=d.data||{};m.setTouid(g.uid,g.fnick,g.sex);m.setPosition({l:f.l+1,t:f.t+e.offsetHeight});m.setSelector(g.gid&&g.gid.split(","),g.desc&&g.desc.split(","),g.cftype);m.show({target:e,setGroupCb:function(c,f){if($CONFIG.cgid!=="friend"&&$CONFIG.cgid!=="allFollow")if(f.action==="delete"&&f.gid===$CONFIG.cgid||f.action==="add"&&!$CONFIG.cgid){A(d.el);m.hide();return}var g=m.getSelector(),h=[],i=[],k,l;for(var n=0,o=g.length;n<o;n++){k=g[n];k.cftype&&(l=k.cftype);k.gname&&i.push(k.gname);k.gid&&h.push(k.gid)}i=i.join(",")||j("#L{未分组}");e.setAttribute("title",i);i=a.bLength(i)>b?a.leftB(i,b)+r:i+s;e.innerHTML=["<span>",i,"</span>"].join("");e.setAttribute("item-data","gid="+h.join(",")+(l?"&cftype="+l:""))},addGroupCb:function(a,b){var d=u.replace(/\{url\}/i,window.location.pathname+"?gid="+a.gid).replace(/\{name\}/ig,a.gname);c.mGroupInner.innerHTML+=d}})},addFollow:function(b,c){var d=a.parseParam({uid:"",fnick:"",f:1,onSuccessCb:function(b){a.replaceNode(B(b),c);i.show({uid:b.uid,fnick:b.fnick,groupList:b.group,hasRemark:!0})}},b.data||{});g.follow(a.common.getDiss(d,c))},unFollow:function(b,c){var d=b.data||{},e=d.fnick||j("#L{该用户}");n.setInfo(j("#L{确定不再关注}")+e+"?");n.setTipWH();n.setLayerXY(c);n.aniShow();n.okCallback=function(){var e=a.parseParam({uid:"",fnick:"",onSuccessCb:function(a){A(b.el)}},d);g.unFollow(a.common.getDiss(e,c))}},removeFans:function(b,d){var e=b.data||{},f=e.fnick||j("#L{该用户}"),h=a.E("userList_"+k);h.checked=!1;q.setInfo(j("#L{确认要移除}")+f+"?");q.setTipWH();q.setLayerXY(d);q.aniShow();q.okCallback=function(){var f=a.parseParam({uid:"",fnick:"",isblock:h.checked?1:0,onSuccessCb:function(a){A(b.el);c.userList.children.length||window.location.reload()}},e);g.removeFans(a.common.getDiss(f,d))}},sendMsg:function(b,c){var d=b.data,e=a.common.dialog.sendMessage({uid:d.uid,userName:d.fnick||""});e.show()},moreData:function(b,c){var d=a.sizzle("div.detail",b.el)[0],e=d.style.display!=="none";if(!e&&!a.trim(d.innerHTML)){d.innerHTML=t;var f=function(b,c){b&&b.msg&&a.ui.alert(b.msg)};a.common.trans.relation.request("moreData",{onSuccess:function(a,b){d.innerHTML=a.data&&a.data.html},onError:f,onFail:f},{fuid:b.data.uid})}var g=a.sizzle('[node-type="detail_more"]',b.el)[0],h=a.sizzle("em",a.domNext(g))[0];h.className=e?"down":"up";g.innerHTML=e?"更多":"收起";d.style.display=e?"none":"";if(window.SUDA){var i;$CONFIG.pageid=="myfollow"?i=e?"attention_fold":"attention_unfold":$CONFIG.pageid=="myfans"&&(i=e?"fans_fold":"fans_unfold");i&&window.SUDA.uaTrack("tblog_relationship_click",i)}},reportspam:function(a,b){},update_group_desc:function(b,c){var d=b.data.gid,e=b.data.uid,f=c.innerHTML;D(c,{blur:function(b){b=a.fixEvent(b);var g=b.target,h=a.trim(g.value);if(h!==f&&h!==o&&h!==p){var i=function(b,d){c.innerHTML=f;a.replaceNode(c,g);b&&b.msg&&a.ui.alert(b.msg)};a.common.trans.group.request("editdesc",{onSuccess:function(b,d){c.innerHTML=h?C(h):o;a.replaceNode(c,g)},onError:i,onFail:i},{gid:d,uid:e,desc:encodeURIComponent(h)})}else{c.innerHTML=f;a.replaceNode(c,g)}},keyup:function(b){var c=a.fixEvent(b).target,d=a.trim(c.value);a.bLength(d)>16&&(c.value=a.leftB(d,16))}})},removeQuietFollow:function(b,e){var f=function(a){if(a.code=="100000"){A(b.el);c.userList.children.length||window.location.reload()}};a.custEvent.fire(d,"removeOne",{spec:b,callbk:f})},addClsFrd:function(b,c){var d=b&&b.data||{};h.add({uid:d.uid,name:d.fnick,successCb:function(b,d){var e=b.data||{},f=z.cfSuc_2,g="已为密友",h;if(e.cftype==2){f=z.cfSuc_1;h=z.cfSucTit_1;g="密友等待中"}a.ui.timerNotice(f,{title:h,icon:"success",timer:2e3});a.replaceNode(E(g),c)}})}},G=function(b){var d=a.sizzle('li[action-type="itmeClick"]',c.userList),e=[];for(var f=d.length;f--;){var h=d[f],i=h.getAttribute("action-data")||"",k=i.match(/uid=(\w*)/i),l=RegExp.$1;e.push(l)}n.setInfo(j("#L{确认要关注他们吗？}"));n.setTipWH();n.setLayerXY(b.el);n.aniShow();n.okCallback=function(){var c=a.parseParam({uid:e.join(","),onSuccessCb:function(b){var c=a.ui.litePrompt(j("#L{已关注成功}"),{type:"succM",timeout:1e3,hideCallback:function(){a.core.util.scrollTo(document.body,{step:10,top:0});window.location.reload()}})}});g.follow(a.common.getDiss(c,b.el))}},H=function(b){var c=b.el,d=a.fixEvent(b.evt),e=d.target;while(e&&e.nodeType===1&&e!==b.el){var f=e.getAttribute("item-func"),g=F[f];if(typeof g=="function"){var h=e.getAttribute("item-data");b.data=a.core.json.merge(b.data||{},a.queryToJson(h||""));g(b,e)}e=e.parentNode}},I=function(b){a.preventDefault();var c=b.el.getAttribute("action-data"),d=b.el.className.indexOf("S_txt1")>=0?!0:!1;v==1&&!d?window.location.href=c:d||w.show()},J=function(){if(c.activated){var b=a.core.json.queryToJson(c.activated.value);v=b.activated;w=a.common.dialog.authentication()}},K=function(){f.add("itmeClick","click",H);f.add("itemClick","click",H);f.add("followAll","click",G);if(c.pageList){e=a.delegatedEvent(c.pageList);e.add("page","click",I)}},L=function(){J();K()};L();var M=function(){f.destroy();e&&e.destroy&&e.destroy();F=null;f=null;c=null};d.destroy=M;return d}});
STK.register("common.relation.userSearch",function(a){return function(b,c){var d={},e,f,g,h="";c=c||{};c.callback=c.callback||a.funcEmpty;var i={btnClick:function(b){b&&a.preventDefault(b);var d=e.input.value;d!==h&&c.callback(e.input.value,e.submit)},inputFocus:function(){a.addClassName(b.parentNode,"focused")},inputBlur:function(){a.removeClassName(b.parentNode,"focused")}},j=function(){a.addEvent(e.input,"focus",i.inputFocus);a.addEvent(e.input,"blur",i.inputBlur);a.addEvent(e.submit,"click",i.btnClick)},k=function(){},l=function(){m();n();j();k()},m=function(){if(!a.core.dom.isNode(b))throw"[STK.common.relation.userSearch]:node is not a Node!"},n=function(){var d=a.core.dom.builder(b);e=a.kit.dom.parseDOM(d.list);f=a.common.bubble.myFollowSuggest({transName:"myFollowList",type:c.type||0,textNode:e.input,width:c.width||137,dontSelectFirst:c.dontSelectFirst,callback:function(a){c.callback(a,e.submit)}});f.show();h=e.input.getAttribute("notice");g=a.kit.dom.smartInput(e.input,{notice:h,noticeClass:"input_default",maxLength:40})},o=function(){f&&f.hide&&f.hide();f&&f.destroy&&f.destroy();g&&g.destroy&&g.destroy();e.submit&&a.removeEvent(e.submit,"click",i.btnClick);e.input&&a.removeEvent(e.input,"focus",i.inputFocus);e.input&&a.removeEvent(e.input,"blur",i.inputBlur);f=g=i=e=null};l();d.destroy=o;return d}});
STK.register("kit.extra.dynamicInputWidth",function(a){return function(b,c){c=c||{};var d={},e,f,g,h=a.core.dom.getSize,i=a.core.dom.setStyle,j,k;a.custEvent.define(d,"textChange");var l=function(){if(!e){e=1;var b=a.core.dom.cssText("");b.push("width","1000px");b.push("height","55px");b.push("position","absolute");b.push("left","-10000px");b.push("top","-10000px");b.push("visibility","hidden");var c=b.getCss();e=1;var d='<div node-type="wrap" style="'+c+'">'+'<span node-type="before"></span>'+"</div>",h=a.core.dom.builder(d);g=h.box;f=a.kit.dom.parseDOM(h.list);document.body.appendChild(g)}},m={focus:function(){clearTimeout(k);k=setTimeout(m.focusFun,200)},focusFun:function(){var e=b.value;if(c.limitWords){var g=a.bLength(e);g>c.limitWords&&(b.value=e=a.leftB(e,c.limitWords))}if(e==j)m.focus();else{j=e;l();f.before.innerHTML=a.encodeHTML(e);var k=h(f.before),n=k.width+20;c.maxInputWidth&&n>c.maxInputWidth&&(n=c.maxInputWidth);i(b,"width",n+"px");m.focus();a.custEvent.fire(d,"textChange",e)}},blur:function(){clearTimeout(k)}},n=function(){a.addEvent(b,"focus",m.focus);a.addEvent(b,"blur",m.blur)},o=function(){a.removeEvent(b,"focus",m.focus);a.removeEvent(b,"blur",m.blur);d=null},p={custObj:d,destroy:o};n();return p}});
STK.register("common.content.inputTip",function(a){return function(b,c){var d={},e={DOM:{},objs:{},DOM_eventFun:{blurInput:function(){e.checkValueForTips()},focusInput:function(){e.checkValueForInput()}},checkValueForTips:function(){a.log("checkValueForTips:"+(b.value.replace(/\s/g,"")==""));if(b.value.replace(/\s/g,"")==""||b.value==c.text){a.addClassName(b,c.className);b.value=c.text}else a.removeClassName(b,c.className)},checkValueForInput:function(){a.log("checkValueForInput:"+(b.value==c.text));a.removeClassName(b,c.className);b.value==c.text&&(b.value="")}},f=function(){g();h();i();j();k();l()},g=function(){c.text=c.text||"请输入.....";if(!b)throw new Error("common.content.inputTip node没有定义")},h=function(){},i=function(){e.checkValueForTips()},j=function(){a.addEvent(b,"blur",e.DOM_eventFun.blurInput);a.addEvent(b,"focus",e.DOM_eventFun.focusInput)},k=function(){},l=function(){},m=function(){a.removeEvent(b,e.DOM_eventFun.blurInput,"blur");a.removeEvent(b,e.DOM_eventFun.blurInput,"focus")};f();d.destroy=m;return d}});
STK.register("kit.extra.codec",function(a){var b={encode:function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},decode:function(a){var b=document.createElement("div");b.innerHTML=a;var c=b.innerText==undefined?b.textContent:b.innerText;b=null;return c}};return b});
STK.register("common.dialog.contactKit",function(a){return function(b){var c=a.kit.extra.language,d={},e,f,g,h,i,j={},k,l,m,n,o,p,q,r=!1,s,t,u=a.core.str.leftB,v=a.kit.extra.codec,w={},x=0,y,z,A={},B,C=a.core.dom.getSize,D=window.$CONFIG&&window.$CONFIG.cssPath||"http://img.t.sinajs.cn/t4/",E=a.getUniqueKey(),F=!1,G=!1,H="";if(b.custom=="crony"){F=!0;G=!0;H="#L{建议加为密友}"}var I=parseInt(b.friendNum,10)||0,J=140,K=0,L=140,M=!1,N='<div class="W_layer" style="top:0px;left:0px;display:none;" node-type="contactKitNode"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content" node-type="dialogContent"><div class="title">#L{从我关注的人中选择}</div><a href="javascript:void(0)" class="W_close" action-type="close_dialog"></a><div class="layer_attention_choose"><div class="tab_c S_txt2"><p><span class="search"><input type="text" value="#L{输入昵称或备注}" class="input" node-type="searchInput"><a class="btn" href="javascript:void(0)" action-type="search"></a></span><a href="javascript:void(0)" action-type="getAllContact" node-type="getAllContact" '+(G?"":'class="current"')+">#L{全部}</a>"+'<em class="W_vline">|</em>'+(F?'<a href="javascript:void(0)" class="W_moredown" node-type="customHover" action-type="customHover">'+H+'</a><em class="W_vline">|</em>':"")+'<a href="javascript:;" class="W_moredown" node-type="groupHover">#L{按分组筛选}<em class="more"></em></a>'+'<em class="W_vline">|</em>'+'<a href="javascript:void(0)" class="W_moredown" node-type="infoHover">#L{按资料筛选}<em class="more"></em></a>'+"<em "+(G?'style="display:none;"':"")+' class="W_vline">|</em>'+'<a class="S_txt1" href="javascript:void(0)" '+(G?'style="display:none;"':"")+'>#L{已选}(<em node-type="chooseCount">0</em>/<em node-type="totalCount">0</em>)</a>'+"</p>"+"</div>"+'<div class="person_list">'+'<ul class="list" node-type="contactContent">'+"</ul>"+'<div class="func"><label for="'+E+'"><input type="checkbox" class="W_checkbox" action-type="selectAll" node-type="selectAll" id="'+E+'"/>#L{全选}</label></div>'+"</div>"+'<div class="btn"><span node-type="cronyTip">'+(G?'#L{还可以再选择}<span node-type="cronyCount" class="miyou">'+(J-I)+"</span>#L{位密友}":"")+'</span><a class="W_btn_d" href="javascript:void(0)" action-type="close_dialog"><span>#L{确认}</span></a></div>'+'<div class="layer_menu_list" style="position: absolute;display:none;z-index:10000;" node-type="groupHoverLayer">'+'<ul node-type="layerContent"><li><a href="javascript:void(0)">#L{正在加载，请稍候...}</a></li></ul>'+"</div>"+'<div class="layer_menu_list" style="position: absolute; display:none;z-index:10000;" node-type="infoHoverLayer">'+'<ul node-type="infoLayerContent"><li><a href="javascript:void(0)">#L{正在加载，请稍候...}</a></li></ul>'+"</div>"+"</div>"+"</div>"+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>",O='<#et list data><#if (data.length)><#list data as list><li <#if (list.isChoose)> class="current" </#if> action-type="addRemoveItem" action-data="uid=${list.uid}&name=${list.name}" uid="${list.uid}"><img width="50" height="50" alt="" src="${list.img}" class="face" /><p class="info"><span>${list.name_s}<#if (list.type_p=="orange")><a href="javascript:void(0)"><img class="approve" alt="#L{认证用户}" title="#L{认证用户}" src="'+D+'style/images/common/transparent.gif" /></a></#if><#if (list.type_p=="blue")><a href="javascript:void(0)"><img class="approve_co" alt="#L{认证用户}" title="#L{认证用户}" src="'+D+'style/images/common/transparent.gif" /></a></#if><#if (list.type_p=="daren")><a href="javascript:void(0)"><img class="ico_club" alt="#L{微博达人}" title="#L{微博达人}" src="'+D+'style/images/common/transparent.gif" /></a></#if></span><span></span><span class="S_txt2 region"><#if (list.remark)>${list.remark}<#else>${list.location}</#if></span></p><span class="icon_succ"></span></li>'+"</#list>"+"<#if (data.length<=6 && data.rendGroupAll)>"+'<li class="personList_tips W_tips clearfix">'+'<div class="tipscon tips_warn">'+'<div class="icon"><img class="icon_error" alt="" src="'+D+'style/images/common/transparent.gif"></div>'+'<p class="txt">#L{微博的乐趣，在于关注一批有趣的人，}<a href="/f/find">#L{快来找找更多有趣的人吧。}</a></p>'+"</div>"+"</li>"+"</#if>"+"<#else>"+"<#if (data.rendGroupAll)>"+'<li class="no_person">#L{还没找到要关注的人？}<a href="/f/find">#L{快去找找朋友吧}</a></li>'+'<#elseif (data.noDataType=="common")>'+'<li class="no_person">#L{该分组没有关注人。想和朋友分享新鲜事}？<a href="/f/find">#L{邀请他们加入吧}</a></li>'+'<#elseif (data.noDataType=="closefriends")>'+'<li class="no_person2">#L{唉呀你太低调了，连微博小助手也无法为你寻找到经常混迹在一起的密友~}<br>#L{没有密友的微博好寂寞，快去试试}<a href="javascript:;" action-type="groupSearch">#L{分组查找}</a>、<a href="javascript:;" action-type="nickSearch">#L{昵称查找}</a>#L{等其他方法，找出隐藏的知己吧！}</li>'+"<#else>"+'<li class="no_person">#L{抱歉没有找到昵称或备注含}“${data.q}”#L{的人，试试搜索其他词吧}</li>'+"</#if>"+"</#if>"+"</#et>",P='<#et layergroup data><#if (data.length)><#list data as list><li action-type="showGroup" action-data="type=${data.type}&gid=${list.gid}&gname=${list.gname}"><a href="javascript:void(0)" onclick="return false;">${list.shortWord}</a></li></#list><#else><li><a href="javascript:void(0)">#L{没有可以筛选的资料哟}</a></li></#if></#et>',Q={},R={},S=function(){T();U();V();Y();bc();bd()},T=function(){if(!a.isNode(b.accordTo))throw"accordTo must be a node , please check!"},U=function(){g=b.accordTo;p=b.pushedMap;q=b.inputCustObj;s=b.closeBtn;a.core.dom.insertHTML(document.body,c(N));h=a.sizzle('>div[node-type="contactKitNode"]',document.body)[0];f=a.kit.dom.parseDOM(a.builder(h).list)},V=function(){l=a.common.trans.group.getTrans("infolist",{onSuccess:W.getGroupsSuccess,onError:W.getGroupsError});m=a.common.trans.group.getTrans("listbygroup",{onSuccess:W.listByGroupSuccess,onError:W.listByGroupError})},W={getGroupsSuccess:function(a,b){n=a.data.group||[];bi.delegateGroup();bi.setLayerContent();W.getInfoSuccess(a,b)},getGroupsError:function(){},getInfoSuccess:function(a,b){o={};o.comp=a.data.comp;o.scho=a.data.scho;o.tag=a.data.tag;bi.setInfoContent()},getInfoError:function(){},listByGroupSuccess:function(a,b){var c;b.type=="group"?c="group":b.type=="search"?c="search":b.type=="closefriends"?c="closefriends":c="common";a.data&&bi.setSpecial(a.data);bi.listData(c,a,b)},listByGroupError:function(){}},X={groupMousever:function(){bi.setHoverPosition("groupHover");f.groupHoverLayer.style.display=""},groupMouseout:function(){f.groupHoverLayer.style.display="none"},infoMouseover:function(){bi.setHoverPosition("infoHover");f.infoHoverLayer.style.display=""},infoMouseout:function(){f.infoHoverLayer.style.display="none"},bodyClick:function(b){if(r){var c=a.fixEvent(b),d=c.target;if(d!=s&&!a.contains(s,d)&&!a.contains(h,d)&&d&&d.getAttribute("action-type")!="groupSearch"){bi.hideContactKit();a.custEvent.fire(q,"hide");bi.clearAllData()}}},contentScroll:function(){clearTimeout(y);y=setTimeout(X.contentScrollImpl,300)},contentScrollImpl:function(){var a=f.contactContent.scrollHeight,b=f.contactContent.scrollTop+z;b/a>.8&&bi.loadPageData()}},Y=function(){B=a.common.content.inputTip(f.searchInput,{text:c("#L{输入昵称或备注}"),className:"default"});i=a.delegatedEvent(h);i.add("close_dialog","click",bb.close_dialog);i.add("addRemoveItem","click",bb.addRemoveItem);i.add("getAllContact","click",bb.getAllContact);i.add("selectAll","click",bb.selectAllCheckbox);i.add("search","click",bb.searchSubmit);i.add("customHover","click",bb.customHover);i.add("groupSearch","click",bb.groupSearch);i.add("nickSearch","click",bb.nickSearch);a.addEvent(f.groupHover,"mouseover",X.groupMousever);a.addEvent(f.groupHover,"mouseout",X.groupMouseout);a.addEvent(f.infoHover,"mouseover",X.infoMouseover);a.addEvent(f.infoHover,"mouseout",X.infoMouseout);a.addEvent(document.body,"click",X.bodyClick);z=parseInt(a.getStyle(f.contactContent,"height"))||0;Z()},Z=function(){a.addEvent(f.contactContent,"scroll",X.contentScroll)},_=function(){a.removeEvent(f.contactContent,"scroll",X.contentScroll)},ba=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},bb={searchSubmit:function(){var b=a.trim(f.searchInput.value)||"";b=ba(b);if(b==c("#L{输入昵称或备注}"))f.searchInput.focus();else{var d="search:"+b;if(w[d])bi.rendGroupContents(d,"search",b);else{x=d;try{m.abort()}catch(e){}m.request({type:"search",q:b,page:1})}}},selectAllCheckbox:function(b){var c=b.el,d=c.checked,e=w[x].concat([]);!e.length||a.timedChunk(e,{process:function(a){bi.timeChunkForeach(a,d)},execTime:100})},close_dialog:function(){bi.hideContactKit();a.custEvent.fire(q,"hide");bi.clearAllData()},addRemoveItem:function(b){var c=b.el,d=b.data,e=a.core.dom.hasClassName(c,"current");if(e){bi.removeOneItem(c,d);bi.setChooseNum(-1);G&&bi.setCronyNum(-1)}else{bi.addOneItem(c,d);bi.setChooseNum(1);G&&bi.setCronyNum(1)}bi.setCheckbox()},showGroup:function(b){var c=b.data.type;bi.setTabCurrent("group",b.el,b.data.type);var d=b.data.gid,e=a.core.arr.indexOf(d,["comp","scho","tag"])>=0;if(e){var g=b.data.gname,h=d+":"+g;if(w[h])bi.rendGroupContents(h,"common");else{x=h;try{m.abort()}catch(i){}m.request({type:d,q:g,page:1})}}else if(w[d])bi.rendGroupContents(d,"common");else{x=d;try{m.abort()}catch(i){}m.request({gid:d,page:1,type:"group"})}t&&a.removeClassName(t,"cur");a.addClassName(b.el,"cur");t=b.el;f[c+"HoverLayer"].style.display="none";try{a.fixEvent(b.evt).target.blur()}catch(i){}},getAllContact:function(){if(w[0])bi.rendGroupContents("0","common");else{x="0";try{m.abort()}catch(b){}m.request({gid:"0",page:1,type:"group"})}bi.setTabCurrent("all");t&&a.removeClassName(t,"cur")},customHover:function(b){bi.setTabCurrent("group",f.customHover,"custom");var c="closefriends";if(w[c])bi.rendGroupContents(c,"common");else{x=c;try{m.abort()}catch(d){}m.request({gid:c,page:1,type:"closefriends"})}t&&a.removeClassName(t,"cur")},groupSearch:function(){var b=a.sizzle('li[action-type="showGroup"]',f.layerContent)[0];if(b){var c={};c.el=b;c.data=a.queryToJson(b.getAttribute("action-data"));bb.showGroup(c)}},nickSearch:function(b){a.common.channel.closeFriend.fire("changeTab","nick")}},bc=function(){a.custEvent.define(j,"resetPosition");a.custEvent.add(j,"resetPosition",bi.setPos);a.custEvent.define(j,"removeItem");a.custEvent.add(j,"removeItem",bi.custRemoveItem);a.custEvent.define(j,"addItem");a.custEvent.add(j,"addItem",bi.custAddItem);a.custEvent.define(j,"clearAllData");a.custEvent.add(j,"clearAllData",bi.clearAllData)},bd=function(){},be=function(){i&&i.destroy&&i.destroy();B&&B.destroy&&B.destroy();if(f){f.groupHover&&a.removeEvent(f.groupHover,"mouseover",X.groupMousever);f.groupHover&&a.removeEvent(f.groupHover,"mouseout",X.groupMouseout);f.infoHover&&a.removeEvent(f.infoHover,"mouseover",X.infoMouseover);f.infoHover&&a.removeEvent(f.infoHover,"mouseout",X.infoMouseout);f.groupHoverLayer&&a.removeEvent(f.groupHoverLayer,"mouseover",X.groupMousever);f.groupHoverLayer&&a.removeEvent(f.groupHoverLayer,"mouseout",X.groupMouseout);f.infoHoverLayer&&a.removeEvent(f.infoHoverLayer,"mouseover",X.infoMouseover);f.infoHoverLayer&&a.removeEvent(f.infoHoverLayer,"mouseout",X.infoMouseout);f.contactContent&&a.removeEvent(f.contactContent,"scroll",X.contentScroll)}a.removeEvent(document.body,"click",X.bodyClick);j&&a.custEvent.undefine(j)},bf=function(){if(!e){S();e=!0}},bg=function(){var b=C(g),c=a.core.dom.position(g),d=c.l,e=c.t+b.height;a.setStyle(h,"left",d+"px");a.setStyle(h,"top",e+"px")},bh=function(){bf();h.style.display="none"},bi={clearAllData:function(){f.searchInput.value=c("#L{输入昵称或备注}");f.searchInput.className="input default";G?bb.customHover():bb.getAllContact()},setHoverPosition:function(b){var c=f[b],d=f[b+"Layer"],e=a.position(f.dialogContent),g=a.position(c),h=C(c),i=g.l-e.l,j=g.t+h.height-e.t-7;a.setStyle(d,"left",i+"px");a.setStyle(d,"top",j+"px")},setSpecial:function(b){if(b.length)for(var c=0,d=b.length;c<d;c++){var e=b[c],f="",g="";e.verified===!0?e.verified_type==0?f="orange":e.verified_type>0&&(f="blue"):e.verified_type==220&&(f="daren");e.type_p=f;g=v.decode(e.name);e.name_s=v.encode(a.bLength(g)>10?a.leftB(g,10):g)}},listData:function(b,d,e){var g;b=="group"||b=="closefriends"?g=e.gid:b=="search"?g="search:"+e.q:g=e.type+":"+e.q;var h=b!="search"?"common":"search";b=="closefriends"&&(h="closefriends");var i=h==="common"&&e.gid==="0";if(e.page==1){w[g]=d.data;var j=d.data.concat([]);bi.addCurrentAttribute(j);j.noDataType=h;j.rendGroupAll=i;h=="search"&&(j.q=e.q);var m=a.core.util.easyTemplate(c(O),j);f.contactContent.innerHTML=m;f.contactContent.scrollTop=0;bi.showContactKit();n||l.request();k=!0;f.totalCount.innerHTML=d.data.length;bi.setChooseNum();bi.setCheckbox();j.length!=0?A[g]=1:A[g]=!0}else{if(d.data.length){w[g]=w[g].concat(d.data);var j=d.data.concat([]);bi.addCurrentAttribute(j);j.noDataType=h;j.rendGroupAll=i;h=="search"&&(j.q=e.q);var m=a.core.util.easyTemplate(c(O),j);a.insertHTML(f.contactContent,m);f.totalCount.innerHTML=w[g].length}var j=d.data;j.length==0&&(A[g]=!0);bi.setCheckbox();setTimeout(Z,300)}bi.setChooseNum()},timeChunkForeach:function(b,c){var d=b.uid;if(c){if(!p[d]){var b=a.sizzle("li[uid='"+d+"']",f.contactContent)[0];bb.addRemoveItem({el:b,data:a.queryToJson(b.getAttribute("action-data"))})}}else if(p[d]){var b=a.sizzle("li[uid='"+d+"']",f.contactContent)[0];bb.addRemoveItem({el:b,data:a.queryToJson(b.getAttribute("action-data"))})}},setCheckbox:function(){var b=!0,c=w[x];!c||!c.length?b=!1:a.foreach(c,function(a,c){var d=a.uid;if(!p[d]){b=!1;return!1}});f.selectAll.removeAttribute("disabled");f.selectAll.checked=b;!c||!c.length?f.selectAll.setAttribute("disabled","disabled"):f.selectAll.removeAttribute("disabled")},addCurrentAttribute:function(b){a.foreach(b,function(a,b){a.uid=a.id;a.name=u(a.screen_name,12);a.img=a.profile_image_url;p[a.uid]?a.isChoose=1:a.isChoose=0})},timeChunkHtml:function(b){if(!b.length){var d=a.core.util.easyTemplate(c(O),b);f.contactContent.innerHTML=d}else{f.contactContent.innerHTML="";var e=[];while(e.length>=50)e.push(function(){var a=b.splice(0,50);return function(){bi.tenItemHtml(a)}}());b.length&&e.push(function(){return function(){bi.tenItemHtml(b)}}());a.timedChunk(e)}},tenItemHtml:function(b){var d=a.core.util.easyTemplate(c(O),b);a.insertHTML(f.contactContent,d)},rendGroupContents:function(a,b,c){a=="closefriends"&&(b="closefriends");x=a;var d=w[a].concat([]);d.noDataType=b;d.rendGroupAll=b==="common"&&a==="0";d.q=c;var e=d.length;bi.addCurrentAttribute(d);bi.timeChunkHtml(d);f.contactContent.scrollTop=0;f.totalCount.innerHTML=e;bi.setChooseNum();bi.setCheckbox()},setCronyNum:function(b){K+=b;L=J-I-K;f.cronyCount.innerHTML=L;if(L<0){if(!M){M=!0;f.cronyTip.innerHTML=c('#L{已经超过了}<span node-type="cronyCount" class="miyou">'+ -L+"</span>#L{位密友}");f.cronyCount=a.sizzle('span[node-type="cronyCount"]')[0]}f.cronyCount.innerHTML=-L}else{if(M){M=!1;f.cronyTip.innerHTML=c('#L{还可以再选择}<span node-type="cronyCount" class="miyou">'+L+"</span>#L{位密友}");f.cronyCount=a.sizzle('span[node-type="cronyCount"]')[0]}f.cronyCount.innerHTML=L}},setChooseNum:function(a){var b=w[x],c=0,d;for(var e=0;e<b.length;e++){d=b[e].uid;p[d]&&c++}f.chooseCount.innerHTML=c},setPos:function(){bi.isVisible(h)&&bg()},isVisible:function(a){return a.offsetHeight&&a.offsetWidth},checkPrepared:function(){return k},showContactKit:function(){r=!0;h.style.display=""},hideContactKit:function(){r=!1;h.style.display="none"},delegateGroup:function(){i.add("showGroup","click",bb.showGroup)},setShortWord:function(b){if(b&&b.length)for(var c=0,d=b.length;c<d;c++){var e=b[c],f=v.decode(e.gname);b[c].shortWord=v.encode(a.bLength(f)>16?a.leftB(f,16)+"...":f)}},setLayerContent:function(){n&&(n.type="group");bi.setShortWord(n);var b=a.core.util.easyTemplate(c(P),n);f.layerContent.innerHTML=b;a.addEvent(f.groupHoverLayer,"mouseover",X.groupMousever);a.addEvent(f.groupHoverLayer,"mouseout",X.groupMouseout)},rendInfo:function(a){var b=[];for(var c in a){var d=a[c];if(d){for(var e=0,f=d.length;e<f;e++)d[e]={gid:c,gname:d[e]};b=b.concat(d)}}return b},setInfoContent:function(){o=bi.rendInfo(o);o&&(o.type="info");bi.setShortWord(o);var b=a.core.util.easyTemplate(c(P),o);f.infoLayerContent.innerHTML=b;a.addEvent(f.infoHoverLayer,"mouseover",X.infoMouseover);a.addEvent(f.infoHoverLayer,"mouseout",X.infoMouseout)},removeOneItem:function(b,c){a.core.dom.removeClassName(b,"current");a.custEvent.fire(q,"removeItem",c)},addOneItem:function(b,c){a.core.dom.addClassName(b,"current");a.custEvent.fire(q,"addItem",c)},custRemoveItem:function(b,c){var d=a.sizzle("li[uid='"+c+"']",f.contactContent)[0];a.core.dom.removeClassName(d,"current");bi.setChooseNum(-1);G&&bi.setCronyNum(-1);bi.setCheckbox()},custAddItem:function(b,c){var d=a.sizzle("li[uid="+c+"]",f.contactContent)[0];d&&a.core.dom.addClassName(d,"current");bi.setChooseNum(1);G&&bi.setCronyNum(1);bi.setCheckbox()},setTabCurrent:function(b,c,d){if(b=="all"){a.addClassName(f.getAllContact,"current");a.removeClassName(f.groupHover,"current");a.removeClassName(f.infoHover,"current");F&&a.removeClassName(f.customHover,"current")}else if(b=="group"){a.removeClassName(f.getAllContact,"current");a.removeClassName(f.groupHover,"current");a.removeClassName(f.infoHover,"current");F&&a.removeClassName(f.customHover,"current");a.addClassName(f[d+"Hover"],"current")}},loadPageData:function(){if(A[x]!==!0){var a={};A[x]++;a.page=A[x];a.gid=x;x=="closefriends"?a.type="closefriends":a.type="group";_();try{m.abort()}catch(b){}m.request(a)}}},bj=function(){bf();bg();var a=bi.checkPrepared();if(a)bi.showContactKit();else{x=0;try{m.abort()}catch(b){}G?bb.customHover():m.request({gid:"0",page:1,type:"group"})}};d.destroy=be;d.show=bj;d.hide=bh;d.contactKitCustObj=j;return d}});
STK.register("common.relation.friendSelector",function(a){return function(b,c){var d={},e,f,g,h,f,i,j,c=c||{},k={},l={},m='<#et suggestItem data><span class="W_btn_deltags" href="javascript:void(0)" node-type="addedItem">${data.text}<img class="delicon" src="${data.imgPath}style/images/common/transparent.gif" action-type="delSuggestItem" action-data="value=${data.value}"/></span> </#et>',n=$CONFIG.imgPath||"http://img.t.sinajs.cn/t4/",o={focusFakeInput:function(){e.fakeInput.focus();p.showInputTip()},deleteFollowItemClick:function(b){o.deleteFollowItem(b);a.custEvent.fire(j,"removeItem",b.data.value);return a.preventDefault(b.evt)},deleteFollowItem:function(b,c){var d=b.data.value;delete l[d];var e=b.el.parentNode;e.style.display="none";c===!0?e.parentNode.removeChild(e):setTimeout(function(){e.parentNode.removeChild(e)},0);p.resetTipPos();a.custEvent.fire(j,"resetPosition",{})},toggleContactKit:function(b){var c=b.el.arrow=="arrowdown";if(c){b.el.arrow="";f.hide();a.custEvent.fire(j,"clearAllData");a.core.dom.removeClassName(b.el,"on")}else{b.el.arrow="arrowdown";f.show();a.core.dom.addClassName(b.el,"on")}}},p={clickDelete:function(){var b=a.sizzle("img[action-type='delSuggestItem']:last",e.peopleList);if(b.length){var c=b[0],d=c.getAttribute("action-data").replace("value=",""),f={el:c,data:{value:d}};o.deleteFollowItem(f,!0);a.custEvent.fire(j,"removeItem",d)}},keyHandler:function(a){a=a||window.event;var b=a.keyCode||a.which;e.fakeInput.value==""&&(b==8?p.clickDelete():p.hideFocusTip())},showInputTip:function(){e.focusTip.style.display=""},hideInputTip:function(){e.fakeInput.value="";p.hideFocusTip()},hideFocusTip:function(){e.focusTip.style.display!=="none"&&(e.focusTip.style.display="none")},showFocusTip:function(){e.focusTip.style.display=""},clickSelectSuggest:function(b){var c=b.uid,d=b.screen_name;if(!l[c]){l[c]=d;var f=a.core.util.easyTemplate(m,{imgPath:n,value:c,text:d});a.insertHTML(e.fakeInput,f,"beforebegin");p.resetTipPos();a.custEvent.fire(j,"addItem",c)}e.fakeInput.value="";e.fakeInput.focus();p.showFocusTip()},resetTipPos:function(){p.setFocusTipPos()},setFocusTipPos:function(){var b=a.position(e.placeHolder),c=a.position(e.fakeInput),d=c.l-b.l,f=c.t-b.t+20;a.setStyle(e.focusTip,"left",d+"px");a.setStyle(e.focusTip,"top",f+"px")},custFunAddItem:function(b,c){var d=a.core.util.easyTemplate(m,{imgPath:n,value:c.uid,text:c.name});a.insertHTML(e.fakeInput,d,"beforebegin");p.resetTipPos();a.custEvent.fire(j,"resetPosition",{});l[c.uid]=c.name;e.fakeInput.focus()},custFunRemoveItem:function(b,c){var d=a.sizzle("img[action-data='value="+c.uid+"']",e.peopleList)[0],f={data:{value:c.uid},el:d};o.deleteFollowItem(f);delete l[c.uid]},hideContactKit:function(){e.toggleContactKit.arrow="";a.core.dom.removeClassName(e.toggleContactKit,"on")},hide:function(){f.hide()},show:function(){e.toggleContactKit.arrow="arrowdown";f.show();a.core.dom.addClassName(e.toggleContactKit,"on")},getUids:function(){var a=[];for(var b in l)a.push(b);return a.join(",")},getUserMap:function(){return l}},q=function(){g=a.core.evt.delegatedEvent(b);g.add("peopleList","click",o.focusFakeInput);g.add("contactkit","click",o.toggleContactKit);g.add("delSuggestItem","click",o.deleteFollowItemClick);a.addEvent(e.fakeInput,"blur",p.hideInputTip);a.addEvent(e.fakeInput,"keydown",p.keyHandler);i=a.common.bubble.myFollowSuggest({transName:"myFollowList",type:0,textNode:e.fakeInput,callback:function(a){p.clickSelectSuggest(a)}});i.show()},r=function(){a.custEvent.define(k,"addItem");a.custEvent.define(k,"removeItem");a.custEvent.define(k,"hide");a.custEvent.add(k,"addItem",p.custFunAddItem);a.custEvent.add(k,"removeItem",p.custFunRemoveItem);a.custEvent.add(k,"hide",p.hideContactKit)},s=function(){},t=function(){},u=function(){v();w();s();q();t();r()},v=function(){if(!a.core.dom.isNode(b))throw"[STK.common.relation.friendSelector]:node is not a Node!"},w=function(){var d=a.core.dom.builder(b);e=a.kit.dom.parseDOM(d.list);h=a.kit.extra.dynamicInputWidth(e.fakeInput);f=a.common.dialog.contactKit({inputCustObj:k,accordTo:e.peopleList,pushedMap:l,closeBtn:e.toggleContactKit,custom:c.custom,friendNum:b.getAttribute("num")});j=f.contactKitCustObj},x=function(){a.custEvent.undefine(k);e.fakeInput&&a.removeEvent(e.fakeInput,"blur",p.hideInputTip);e.fakeInput&&a.removeEvent(e.fakeInput,"keydown",p.keyHandler);i.hide();i.destroy();g&&g.destroy&&g.destroy();f&&f.destroy&&f.destroy();h&&h.destroy&&h.destroy();g=k=f=i=e=null};u();d.destroy=x;d.getUids=p.getUids;d.getUserMap=p.getUserMap;d.show=p.show;d.hide=p.hide;return d}});
STK.register("pl.relation.closeFriends.source.init",function(a){var b=$CONFIG.imgPath+"style/images/common/transparent.gif";return function(c){var d={},e=a.kit.extra.language,f=a.common.trans.relation,g=a.common.relation.closeFriend,h=a.common.channel.closeFriend,i,j,k,l,m,n,o,p,q=function(){window.location.reload()},r={unfollow:e("#L{加密友之后也会同时关注对方哦}"),cfSuc_1:e("#L{密友邀请已经发送，请等待对方接受}"),cfSuc_2:e("#L{你已经成功添加对方为密友，你们彼此已经是密友啦}"),cfSucTit_1:e("#L{需要对方通过邀请才能加为密友}")},s=e('<div class="zero_tips S_txt1"><img class="icon_warn" alt="#L{提示}" src="'+b+'">'+"#L{没有找到}"+"</div>"),t=function(a,b){var c=a;while(c&&c!==document.body&&c.nodeType===1){if(c.tagName.toLowerCase()===b)break;c=c.parentNode}return c},u=function(a){var b,c,d;for(var e=j.itemPanel.length;e--;){d="none";b=j.itemPanel[e];c=b.getAttribute("panel-name");if(c===a){d="";k=b}b.style.display=d}},v=function(b){typeof b!="string"&&(b=b.screen_name);b&&g.add({name:b,type:"input",successCb:function(b,c){var d=b.data||{},e=r.cfSuc_2,f;if(d.cftype==2){e=r.cfSuc_1;f=r.cfSucTit_1}a.ui.timerNotice(e,{title:f,icon:"success",timer:2e3,OK:q})}})},w=a.common.trans.relation.getTrans("searchByTel",{noQueue:!0,onSuccess:function(b,d){var e=b&&b.data,f=e.html||s,g=a.sizzle('[action-type="commentFilter"]',c)[0];j.userListBox.innerHTML=f;j.zeroCloseFriend&&a.removeNode(j.zeroCloseFriend);g&&a.removeNode(g)},onError:function(a,b){j.userListBox.innerHTML=a.msg||s},onFail:function(){j.userListBox.innerHTML=s}}),x=a.common.trans.relation.getTrans("cfInviteUnread",{onSuccess:function(a,b){var c=a.data||{},d=isNaN(c.close_friend)?0:c.close_friend;if(!(d<=0)){j.cfInvite.innerHTML='<a href="/invite/recv?type=2">'+d+"个密友邀请</a>";j.cfInvite.style.display=""}}}),y={getUserNames:function(a,b){var c=[];for(var d=0,e=b.length;d<e;d++){var f=a[b[d]];f&&c.push(f)}return c.join(" @")},combineMsg:function(a,b,c){var d="";c.length&&(d=e(a,y.getUserNames(b,c)));return d},getErrorUserMsg:function(a,b){var c="";for(var d in b)switch(d){case"20508":c+=y.combineMsg("#L{抱歉，根据对方的设置，你暂时无法向@%s 发送密友邀请。}",a,b[d]);break;case"20038":c+=y.combineMsg("#L{你已经向@%s 发送了多次密友邀请，请明天再试吧。}",a,b[d]);break;default:}return c},toplimitTip:function(){a.ui.alert(e("#L{您的密友数量已经达到140上限啦~~}"),{icon:"warn",textSmall:e('<a href="/'+$CONFIG.uid+'/closefriend">#L{去整理我的密友列表}</a>'),OKText:e("#L{知道了}")})},multiAdd:function(b,c){g.add({nick:$CONFIG.nick,sex:$CONFIG.sex,uid:b,successCb:function(b,c){a.ui.timerNotice(r.cfSuc_1,{title:r.cfSucTit_1,icon:"success",timer:2e3,OK:q})},errorCb:function(b,d){if(b.code=="100090"){var e=b.data,f=y.getErrorUserMsg(c,e);a.ui.alert(f,{OK:q})}else a.ui.alert(b.msg,{OK:q})}})}},z={clearInvalidUsers:function(b){a.ui.confirm(e("#L{确认要解除与他们的密友关系？}"),{OK:function(){a.preventDefault();f.request("clearInvalidUsers",{onSuccess:q,onError:function(b,c){b&&b.msg&&a.ui.alert(b.msg)}})}})},changePanel:function(a){var b=a.data.panel,c,d,e;for(var f=j.itemTag.length;f--;){d=j.itemTag[f];c=d==a.el;d.className=c?"S_txt1":"";e=t(d,"li");e&&(e.className=c?"current":"")}u(b)},nickSubmite:function(b){var c=j.nickInput.value,d=j.nickInput.getAttribute("notice");c=a.trim(c||"");!!c&&c!==d&&v(c)},telSubmite:function(b){var c=j.telInput.value,d=j.telInput.getAttribute("notice"),c=a.trim(c||""),e=/^\d{6,14}$/.test(c);j.mobileError.style.display=e?"none":"";!!c&&c!==d&&!!e&&w.request({tel:j.country.value+c})},countrySelect:function(a){var b=j.country.value;j.countryNum.innerHTML=b},addContact:function(a){var b=p.getUserMap(),c=[];for(var d in b)c.push(d);if(!!c.length){var e=parseInt(j.friendSelect.getAttribute("num"),10)||0;c.length>140-e?y.toplimitTip():y.multiAdd(c,b)}}},A=function(){i=a.core.evt.delegatedEvent(c);i.add("clearInvalidUsers","click",z.clearInvalidUsers);i.add("changePanel","click",z.changePanel);i.add("telSubmite","click",z.telSubmite);i.add("nickSubmite","click",z.nickSubmite);i.add("addContact","click",z.addContact);a.addEvent(j.country,"change",z.countrySelect)},B=function(){h.register("changeTab",function(b){var c=a.sizzle('a[action-data="panel='+b+'"]')[0];p.hide();c&&z.changePanel({data:{panel:b},el:c})})},C=function(){D();E();A();F();B();x.request()},D=function(){if(!a.core.dom.isNode(c))throw"[STK.comp.relation.closeFriend]:node is not a Node!"},E=function(){var b=a.core.dom.builder(c);j=a.kit.dom.parseDOM(b.list)},F=function(){j.topSearch&&(n=a.common.relation.userSearch(j.topSearch,{type:2,callback:function(a,b){typeof a!="string"&&(a=a.screen_name);a=encodeURIComponent(a||"");b&&(window.location.href=b.href+"?search="+a)}}));if(j.nickInput){m=a.kit.dom.smartInput(j.nickInput,{notice:j.nickInput.getAttribute("notice"),noticeClass:"input_default",maxLength:40});l=a.common.bubble.myFollowSuggest({transName:"myFollowList",type:0,textNode:j.nickInput});l.show()}if(j.userListBox){o=a.common.relation.userList(j);a.custEvent.add(o,"empty",q)}if(j.friendSelect){p=a.common.relation.friendSelector(j.friendSelect,{custom:"crony"});var b=window.location.hash||"";b.indexOf("isshow=1")>=0&&p.show()}},G=function(){i&&i.destroy();j=null};C();d.destroy=G;return d}});
STK.pageletM.register("pl.relation.closeFriends.index",function(a){var b=a.E("pl_relation_closeFriends"),c=a.pl.relation.closeFriends.source.init(b);return c});
